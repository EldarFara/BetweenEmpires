# -*- coding: utf-8 -*-
from header_common import *
from header_operations import *
from header_parties import *
from header_items import *
from header_skills import *
from header_triggers import *
from header_troops import *
from ID_troops import *
from header_music import *
from header_terrain_types import *

from module_constants import *

####################################################################################################################
# Simple triggers are the alternative to old style triggers. They do not preserve state, and thus simpler to maintain.
#
#  Each simple trigger contains the following fields:
# 1) Check interval: How frequently this trigger will be checked
# 2) Operation block: This must be a valid operation block. See header_operations.py for reference. 
####################################################################################################################



simple_triggers = [

# This trigger is deprecated. Use "script_game_event_party_encounter" in module_scripts.py instead  
  (ti_on_party_encounter,
   [
    ]),


# This trigger is deprecated. Use "script_game_event_simulate_battle" in module_scripts.py instead 
  (ti_simulate_battle,
   [
    ]),


  (1,
   [
      (try_begin),
        (eq, "$training_ground_position_changed", 0),
        (assign, "$training_ground_position_changed", 1),
		(set_fixed_point_multiplier, 100),
        (position_set_x, pos0, 7050),
        (position_set_y, pos0, 7200),
        (party_set_position, "p_training_ground_3", pos0),
      (try_end),
	  
      (gt,"$auto_besiege_town",0),
      (gt,"$g_player_besiege_town", 0),
      (ge, "$g_siege_method", 1),
      (store_current_hours, ":cur_hours"),
      (eq, "$g_siege_force_wait", 0),
      (ge, ":cur_hours", "$g_siege_method_finish_hours"),
      (neg|is_currently_night),
      (rest_for_hours, 0, 0, 0), #stop resting
    ]),


  (0,
   [
      (try_begin),
        (eq, "$bug_fix_version", 0),     
      
        #fix for hiding test_scene in older savegames
        (disable_party, "p_test_scene"),
        #fix for correcting town_1 siege type
        (party_set_slot, "p_town_1", slot_center_siege_with_belfry, 0),
        #fix for hiding player_faction notes
        (faction_set_note_available, "fac_player_faction", 0),
        #fix for hiding faction 0 notes
        (faction_set_note_available, "fac_no_faction", 0),
        #fix for removing kidnapped girl from party
        (try_begin),
          (neg|check_quest_active, "qst_kidnapped_girl"),
          (party_remove_members, "p_main_party", "trp_kidnapped_girl", 1),
        (try_end),
        #fix for not occupied but belong to a faction lords
        (try_for_range, ":cur_troop", lords_begin, lords_end),
          (try_begin),                
            (troop_slot_eq, ":cur_troop", slot_troop_occupation, slto_inactive),
            (store_troop_faction, ":cur_troop_faction", ":cur_troop"),
            (is_between, ":cur_troop_faction", "fac_kingdom_1", kingdoms_end),          
            (troop_set_slot, ":cur_troop", slot_troop_occupation, slto_kingdom_hero),          
          (try_end),
        (try_end),  
        #fix for an error in 1.105, also fills new slot values
        (call_script, "script_initialize_item_info"),  
        
        (assign, "$bug_fix_version", 1),     
      (try_end),  

      (eq,"$g_player_is_captive",1),
      (gt, "$capturer_party", 0),
      (party_is_active, "$capturer_party"),
      (party_relocate_near_party, "p_main_party", "$capturer_party", 0),
    ]),


#Auto-menu
  (0,
   [          
     (try_begin),
       (gt, "$g_last_rest_center", 0),
       (party_get_battle_opponent, ":besieger_party", "$g_last_rest_center"),
       (gt, ":besieger_party", 0),
       (store_faction_of_party, ":encountered_faction", "$g_last_rest_center"),
       (store_relation, ":faction_relation", ":encountered_faction", "fac_player_supporters_faction"),
       (store_faction_of_party, ":besieger_party_faction", ":besieger_party"),
       (store_relation, ":besieger_party_relation", ":besieger_party_faction", "fac_player_supporters_faction"),
       (ge, ":faction_relation", 0),
       (lt, ":besieger_party_relation", 0),
       (start_encounter, "$g_last_rest_center"),
       (rest_for_hours, 0, 0, 0), #stop resting
     (else_try),
       (store_current_hours, ":cur_hours"),
       (assign, ":check", 0),
       (try_begin),
         (neq, "$g_check_autos_at_hour", 0),
         (ge, ":cur_hours", "$g_check_autos_at_hour"),
         (assign, ":check", 1),
         (assign, "$g_check_autos_at_hour", 0),
       (try_end),
       (this_or_next|eq, ":check", 1),
       (map_free),
       (try_begin),
         (ge,"$auto_menu",1),
         (jump_to_menu,"$auto_menu"),
         (assign,"$auto_menu",-1),
       (else_try),
         (ge,"$auto_enter_town",1),
         (start_encounter, "$auto_enter_town"),
       (else_try),
         (ge,"$auto_besiege_town",1),
         (start_encounter, "$auto_besiege_town"),
       (else_try),
         (ge,"$g_camp_mode", 1),
         (assign, "$g_camp_mode", 0),
         (assign, "$g_infinite_camping", 0),
         (assign, "$g_player_icon_state", pis_normal),
         
         (rest_for_hours, 0, 0, 0), #stop camping
                  
         (display_message, "@Breaking camp..."),
       (try_end),
     (try_end),
     ]),


#Notification menus
  (0,
   [
     (troop_slot_ge, "trp_notification_menu_types", 0, 1),
     (troop_get_slot, ":menu_type", "trp_notification_menu_types", 0),
     (troop_get_slot, "$g_notification_menu_var1", "trp_notification_menu_var1", 0),
     (troop_get_slot, "$g_notification_menu_var2", "trp_notification_menu_var2", 0),
     (jump_to_menu, ":menu_type"),
     (assign, ":end_cond", 2),
     (try_for_range, ":cur_slot", 1, ":end_cond"),
       (try_begin),
         (troop_slot_ge, "trp_notification_menu_types", ":cur_slot", 1),
         (val_add, ":end_cond", 1),
       (try_end),
       (store_sub, ":cur_slot_minus_one", ":cur_slot", 1),
       (troop_get_slot, ":local_temp", "trp_notification_menu_types", ":cur_slot"),
       (troop_set_slot, "trp_notification_menu_types", ":cur_slot_minus_one", ":local_temp"),
       (troop_get_slot, ":local_temp", "trp_notification_menu_var1", ":cur_slot"),
       (troop_set_slot, "trp_notification_menu_var1", ":cur_slot_minus_one", ":local_temp"),
       (troop_get_slot, ":local_temp", "trp_notification_menu_var2", ":cur_slot"),
       (troop_set_slot, "trp_notification_menu_var2", ":cur_slot_minus_one", ":local_temp"),
     (try_end),
    ]),

  #Music,
  (1,
   [
       (map_free),
       (call_script, "script_music_set_situation_with_culture", mtf_sit_travel),
	    ]),	

  (0,
	[
	  #escort caravan quest auto dialog trigger
	  (try_begin),
        (eq, "$caravan_escort_state", 1),
        (party_is_active, "$caravan_escort_party_id"),
		
        (store_distance_to_party_from_party, ":caravan_distance_to_destination","$caravan_escort_destination_town","$caravan_escort_party_id"),
        (lt, ":caravan_distance_to_destination", 2),
        
        (store_distance_to_party_from_party, ":caravan_distance_to_player","p_main_party","$caravan_escort_party_id"),
        (lt, ":caravan_distance_to_player", 5),

        (assign, "$talk_context", tc_party_encounter),
        (assign, "$g_encountered_party", "$caravan_escort_party_id"),
        (party_stack_get_troop_id, ":caravan_leader", "$caravan_escort_party_id", 0),     
        (party_stack_get_troop_dna, ":caravan_leader_dna", "$caravan_escort_party_id", 0),    
        
        (start_map_conversation, ":caravan_leader", ":caravan_leader_dna"),
      (try_end),
      
      (try_begin),
        (gt, "$g_reset_mission_participation", 1),
        
        (try_for_range, ":troop", active_npcs_begin, kingdom_ladies_end),
          (troop_set_slot, ":troop", slot_troop_mission_participation, 0),
        (try_end),
      (try_end),
	]),
	
(24, 
[
    (try_for_range, ":kingdom_no", npc_kingdoms_begin, npc_kingdoms_end),
      (faction_get_slot, ":faction_morale", ":kingdom_no",  slot_faction_morale_of_player_troops),

	  (store_sub, ":divisor", 140, "$player_right_to_rule"),
	  (val_div, ":divisor", 14),
	  (val_max, ":divisor", 1),
	  
      (store_div, ":faction_morale_div_10", ":faction_morale", ":divisor"), #10 is the base, down to 2 for 100 rtr     
      (val_sub, ":faction_morale", ":faction_morale_div_10"),           

      (faction_set_slot, ":kingdom_no",  slot_faction_morale_of_player_troops, ":faction_morale"),
    (try_end),
]),

	
 (0.001, #Locate kingdom ladies
    [
(val_clamp, "$async_simple_trigger1", kingdom_ladies_begin, kingdom_ladies_end),
(val_add, "$async_simple_trigger1", 1),
	(try_begin),	
	(ge, "$async_simple_trigger1", kingdom_ladies_end),
	(assign, "$async_simple_trigger1", kingdom_ladies_begin),
	(try_end),
      #change location for all ladies
      (assign, ":troop_id", "$async_simple_trigger1"),
        (neg|troop_slot_ge, ":troop_id", slot_troop_prisoner_of_party, 0),
        (call_script, "script_get_kingdom_lady_social_determinants", ":troop_id"),
        (assign, ":location", reg1),
        (troop_set_slot, ":troop_id", slot_troop_cur_center, ":location"),
	]),

	
 (2, #Error check for multiple parties on the map
	[
	(eq, "$cheat_mode", 1),
	(assign, ":debug_menu_noted", 0),
	(try_for_parties, ":party_no"),
		(gt, ":party_no", "p_spawn_points_end"),
		(party_stack_get_troop_id, ":commander", ":party_no", 0),
		(is_between, ":commander", active_npcs_begin, active_npcs_end),
		(troop_get_slot, ":commander_party", ":commander", slot_troop_leaded_party),
		(neq, ":party_no", ":commander_party"),
		(assign, reg4, ":party_no"),
		(assign, reg5, ":commander_party"),
		
		(str_store_troop_name, s3, ":commander"),
		(display_message, "@{!}{s3} commander of party #{reg4} which is not his troop_leaded party {reg5}"), 
		(str_store_string, s65, "str_party_with_commander_mismatch__check_log_for_details_"),

		(try_begin),
			(eq, ":debug_menu_noted", 0),
			(call_script, "script_add_notification_menu", "mnu_debug_alert_from_s65", 0, 0),
			(assign, ":debug_menu_noted", 1),
		(try_end),
	(try_end),
	]),	
	
   
 (24, #Kingdom ladies send messages
 [ 
	(try_begin),
		(neg|check_quest_active, "qst_visit_lady"),
		(neg|troop_slot_ge, "trp_player", slot_troop_prisoner_of_party, 1),
		(neg|troop_slot_ge, "trp_player", slot_troop_spouse, active_npcs_begin),
		
		(assign, ":lady_not_visited_longest_time", -1),
		(assign, ":longest_time_without_visit", 120), #five days
		
		(try_for_range, ":troop_id", kingdom_ladies_begin, kingdom_ladies_end),
		
			#set up message for ladies the player is courting
			(troop_slot_ge, ":troop_id", slot_troop_met, 2),
			(neg|troop_slot_eq, ":troop_id", slot_troop_met, 4),
			
			(troop_slot_eq, ":troop_id", slot_lady_no_messages, 0),
			(troop_slot_eq, ":troop_id", slot_troop_spouse, -1),
			
			(troop_get_slot, ":location", ":troop_id", slot_troop_cur_center),
			(is_between, ":location", walled_centers_begin, walled_centers_end),
			(call_script, "script_troop_get_relation_with_troop", "trp_player", ":troop_id"),
			(gt, reg0, 1),
			
			(store_current_hours, ":hours_since_last_visit"),
			(troop_get_slot, ":last_visit_hour", ":troop_id", slot_troop_last_talk_time),
			(val_sub, ":hours_since_last_visit", ":last_visit_hour"),
			
			(gt, ":hours_since_last_visit", ":longest_time_without_visit"),
			(assign, ":longest_time_without_visit", ":hours_since_last_visit"),
			(assign, ":lady_not_visited_longest_time", ":troop_id"),
			(assign, ":visit_lady_location", ":location"),
		
		(try_end),
		
		(try_begin),
			(gt, ":lady_not_visited_longest_time", 0),
			(call_script, "script_add_notification_menu", "mnu_notification_lady_requests_visit", ":lady_not_visited_longest_time", ":visit_lady_location"),
		(try_end),
		
	(try_end),	
	]),
   
   
#Player raiding a village
# This trigger will check if player's raid has been completed and will lead control to village menu.
  (1,
   [
      (ge,"$g_player_raiding_village",1),
      (try_begin),
        (neq, "$g_player_is_captive", 0),
        #(rest_for_hours, 0, 0, 0), #stop resting - abort
        (assign,"$g_player_raiding_village",0),
      (else_try),
        (map_free), #we have been attacked during raid
        (assign,"$g_player_raiding_village",0),
      (else_try),
        (this_or_next|party_slot_eq, "$g_player_raiding_village", slot_village_state, svs_looted),
        (party_slot_eq, "$g_player_raiding_village", slot_village_state, svs_deserted),
        (start_encounter, "$g_player_raiding_village"),
        (rest_for_hours, 0),
        (assign,"$g_player_raiding_village",0),
        (assign,"$g_player_raid_complete",1),
      (else_try),
        (party_slot_eq, "$g_player_raiding_village", slot_village_state, svs_being_raided),
        (rest_for_hours, 3, 5, 1), #rest while attackable
      (else_try),
        (rest_for_hours, 0, 0, 0), #stop resting - abort
        (assign,"$g_player_raiding_village",0),
        (assign,"$g_player_raid_complete",0),
      (try_end),
    ]),

  #Pay day.
  (24 * 7,
   [
     (assign, "$g_presentation_lines_to_display_begin", 0),
     (assign, "$g_presentation_lines_to_display_end", 15),
     (assign, "$g_apply_budget_report_to_gold", 1),
     (try_begin),
       (eq, "$g_infinite_camping", 0),
       (start_presentation, "prsnt_budget_report"),
     (try_end),
    ]),

  # Oath fulfilled -- ie, mercenary contract expired?
  (24,
   [
      (le, "$auto_menu", 0),
      (gt, "$players_kingdom", 0),
      (neq, "$players_kingdom", "fac_player_supporters_faction"),
      (eq, "$player_has_homage", 0),
	  
	  (troop_get_slot, ":player_spouse", "trp_player", slot_troop_spouse),
	  
	  #A player bound to a kingdom by marriage will not have the contract expire. This should no longer be the case, as I've counted wives as having homage, but is in here as a fallback
	  (assign, ":player_has_marriage_in_faction", 0),
	  (try_begin),
		(is_between, ":player_spouse", active_npcs_begin, active_npcs_end),
		(store_faction_of_troop, ":spouse_faction", ":player_spouse"),
		(eq, ":spouse_faction", "$players_kingdom"),
	    (assign, ":player_has_marriage_in_faction", 1),
	  (try_end),
	  (eq, ":player_has_marriage_in_faction", 0),
	  
      (store_current_day, ":cur_day"),
      (gt, ":cur_day", "$mercenary_service_next_renew_day"),
    #  (jump_to_menu, "mnu_oath_fulfilled"),
    ]),

  # Reducing luck by 1 in every 180 hours
  (180,
   [
     (val_sub, "$g_player_luck", 1),
     (val_max, "$g_player_luck", 0),
    ]),

	#courtship reset
  (72,
   [
     (assign, "$lady_flirtation_location", 0),
    ]),

	#reset time to spare
  (4,
   [
     (assign, "$g_time_to_spare", 1),

    (try_begin),
		(troop_slot_ge, "trp_player", slot_troop_spouse, active_npcs_begin),
		(assign, "$g_player_banner_granted", 1),
	(try_end),

	 ]),

	
  # Banner selection menu
  (24,
   [
    (eq, "$g_player_banner_granted", 1),
    (troop_slot_eq, "trp_player", slot_troop_banner_scene_prop, 0),
    (le,"$auto_menu",0),
#normal_banner_begin
   # (start_presentation, "prsnt_banner_selection"), #parabellum cut
#custom_banner_begin
#    (start_presentation, "prsnt_custom_banner"),
    ]),

  # Party Morale: Move morale towards target value.
  (24,
   [
      (call_script, "script_get_player_party_morale_values"),
      (assign, ":target_morale", reg0),
      (party_get_morale, ":cur_morale", "p_main_party"),
      (store_sub, ":dif", ":target_morale", ":cur_morale"),
      (store_div, ":dif_to_add", ":dif", 5),
      (store_mul, ":dif_to_add_correction", ":dif_to_add", 5),
      (try_begin),#finding ceiling of the value
        (neq, ":dif_to_add_correction", ":dif"),
        (try_begin),
          (gt, ":dif", 0),
          (val_add, ":dif_to_add", 1),
        (else_try),
          (val_sub, ":dif_to_add", 1),
        (try_end),
      (try_end),
      (val_add, ":cur_morale", ":dif_to_add"),
      (party_set_morale, "p_main_party", ":cur_morale"),      
    ]),
  

#Party AI: pruning some of the prisoners in each center (once a week)
  (0.1,
   [
(val_clamp, "$async_simple_trigger2", centers_begin, centers_end),
(val_add, "$async_simple_trigger2", 1),
	(try_begin),	
	(ge, "$async_simple_trigger2", centers_end),
	(assign, "$async_simple_trigger2", centers_begin),
	(try_end),
       (assign, ":center_no", "$async_simple_trigger2"),
         (party_get_num_prisoner_stacks, ":num_prisoner_stacks",":center_no"),
         (try_for_range_backwards, ":stack_no", 0, ":num_prisoner_stacks"),
           (party_prisoner_stack_get_troop_id, ":stack_troop",":center_no",":stack_no"),
           (neg|troop_is_hero, ":stack_troop"),
           (party_prisoner_stack_get_size, ":stack_size",":center_no",":stack_no"),
           (store_random_in_range, ":rand_no", 0, 40),
           (val_mul, ":stack_size", ":rand_no"),
           (val_div, ":stack_size", 100),
           (party_remove_prisoners, ":center_no", ":stack_troop", ":stack_size"),
         (try_end),
    ]),

  #Adding net incomes to heroes (once a week)
  #Increasing debts to heroes by 1% (once a week)
  #Adding net incomes to centers (once a week)
  (0.5,
   [
(val_clamp, "$async_simple_trigger3", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger3", 1),
	(try_begin),	
	(ge, "$async_simple_trigger3", active_npcs_end),
	(assign, "$async_simple_trigger3", active_npcs_begin),
	(try_end),
       (try_begin),
       (assign, ":troop_no", "$async_simple_trigger3"),
         (troop_get_slot, ":cur_debt", ":troop_no", slot_troop_player_debt),#Increasing debt
         (val_mul, ":cur_debt", 101),
         (val_div, ":cur_debt", 100),
         (troop_set_slot, ":troop_no", slot_troop_player_debt, ":cur_debt"),
         (call_script, "script_calculate_hero_weekly_net_income_and_add_to_wealth", ":troop_no"),#Adding net income
       (try_end),
	   
(val_clamp, "$async_simple_trigger4", walled_centers_begin, walled_centers_end),
(val_add, "$async_simple_trigger4", 1),
	(try_begin),	
	(ge, "$async_simple_trigger4", walled_centers_end),
	(assign, "$async_simple_trigger4", walled_centers_begin),
	(try_end),
       (try_begin),
       (assign, ":center_no", "$async_simple_trigger4"),
         #If non-player center, adding income to wealth
         (neg|party_slot_eq, ":center_no", slot_town_lord, "trp_player"), #center does not belong to player.
         (party_slot_ge, ":center_no", slot_town_lord, 1), #center belongs to someone.
         (party_get_slot, ":cur_wealth", ":center_no", slot_town_wealth),
         (party_get_slot, ":prosperity", ":center_no", slot_town_prosperity),
         (store_mul, ":added_wealth", ":prosperity", 15),
         (val_add, ":added_wealth", 700),
         (try_begin),
           (party_slot_eq, ":center_no", slot_party_type, spt_town),
           (val_mul, ":added_wealth", 3),
           (val_div, ":added_wealth", 2),
         (try_end),
         (val_add, ":cur_wealth", ":added_wealth"),
         (call_script, "script_calculate_weekly_party_wage", ":center_no"),
         (val_sub, ":cur_wealth", reg0),
         (val_max, ":cur_wealth", 0),
         (party_set_slot, ":center_no", slot_town_wealth, ":cur_wealth"),
       (try_end),
    ]),

  #Hiring men with hero wealths (once a day)
  #Hiring men with center wealths (once a day)
  (0.01,
   [
(val_clamp, "$async_simple_trigger5", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger5", 1),
	(try_begin),	
	(ge, "$async_simple_trigger5", active_npcs_end),
	(assign, "$async_simple_trigger5", active_npcs_begin),
	(try_end),
		(try_begin),
     (assign, ":troop_no", "$async_simple_trigger5"),
       (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
       (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
       (ge, ":party_no", 1),
       (party_is_active, ":party_no"),
       (party_get_attached_to, ":cur_attached_party", ":party_no"),
       (is_between, ":cur_attached_party", centers_begin, centers_end),
       (party_slot_eq, ":cur_attached_party", slot_center_is_besieged_by, -1), #center not under siege
                       
       (store_faction_of_party, ":party_faction", ":party_no"),
       (try_begin),
         (this_or_next|eq, ":party_faction", "fac_player_supporters_faction"),
         (eq, ":party_faction", "$players_kingdom"),        
         (assign, ":num_hiring_rounds", 1), 
         (store_random_in_range, ":random_value", 0, 2),         
         (val_add, ":num_hiring_rounds", ":random_value"),
       (else_try),
         (game_get_reduce_campaign_ai, ":reduce_campaign_ai"),
         (try_begin),
           (eq, ":reduce_campaign_ai", 0), #hard (2x reinforcing)
           (assign, ":num_hiring_rounds", 2),
         (else_try),
           (eq, ":reduce_campaign_ai", 1), #medium (1x or 2x reinforcing)
           (assign, ":num_hiring_rounds", 1), 
           (store_random_in_range, ":random_value", 0, 2),         
           (val_add, ":num_hiring_rounds", ":random_value"),
         (else_try),
           (eq, ":reduce_campaign_ai", 2), #easy (1x reinforcing)
           (assign, ":num_hiring_rounds", 1),          
         (try_end),                
       (try_end), 
       
       (try_begin),
         (faction_slot_eq,  ":party_faction", slot_faction_marshall, ":troop_no"),
         (val_add, ":num_hiring_rounds", 1),
       (try_end),
                
       # (try_for_range, ":unused", 0, ":num_hiring_rounds"),          # parabellum disabled
         # (call_script, "script_hire_men_to_kingdom_hero_party", ":troop_no"), #Hiring men with current wealth        
       # (try_end),  
     (try_end),

(val_clamp, "$async_simple_trigger6", walled_centers_begin, walled_centers_end),
(val_add, "$async_simple_trigger6", 1),
	(try_begin),	
	(ge, "$async_simple_trigger6", walled_centers_end),
	(assign, "$async_simple_trigger6", walled_centers_begin),
	(try_end),
		(try_begin),
     (assign, ":center_no", "$async_simple_trigger6"),
     (party_is_active, ":center_no"),
		(try_begin),
		(store_faction_of_party, ":faction", ":center_no"),
		(party_get_slot, ":official_faction", ":center_no", slot_center_official_faction),
		(neq, ":faction", ":official_faction"),
		(faction_slot_eq, ":official_faction", slot_faction_state, sfs_inactive),
		(party_set_slot, ":center_no", slot_center_official_faction, ":faction"),
		(call_script, "script_faction_change_infamy", ":faction", 1),
		(try_end),
	 
       (neg|party_slot_eq, ":center_no", slot_town_lord, "trp_player"), #center does not belong to player.
       (party_slot_ge, ":center_no", slot_town_lord, 1), #center belongs to someone.       
       (party_slot_eq, ":center_no", slot_center_is_besieged_by, -1), #center not under siege
		 
       (store_faction_of_party, ":center_faction", ":center_no"),
       (assign, ":num_hiring_rounds", 0),
       (try_begin),
         (this_or_next|eq, ":center_faction", "fac_player_supporters_faction"),
         (eq, ":center_faction", "$players_kingdom"),        
         (assign, ":reinforcement_cost", reinforcement_cost_moderate),
       (assign, ":num_hiring_rounds", 1),
       (else_try),
         (options_get_campaign_ai, ":reduce_campaign_ai"),
         (assign, ":reinforcement_cost", reinforcement_cost_moderate),
         (try_begin), 
           (eq, ":reduce_campaign_ai", 0), #hard (1x or 2x reinforcing)
           (assign, ":reinforcement_cost", reinforcement_cost_hard),
           (store_random_in_range, ":num_hiring_rounds", 0, 2),
           (val_add, ":num_hiring_rounds", 1),
         (else_try), 
           (eq, ":reduce_campaign_ai", 1), #moderate (1x reinforcing)
           (assign, ":reinforcement_cost", reinforcement_cost_moderate),
           (assign, ":num_hiring_rounds", 1),
         (else_try), 
           (eq, ":reduce_campaign_ai", 2), #easy (none or 1x reinforcing)
           (assign, ":reinforcement_cost", reinforcement_cost_easy),
           (store_random_in_range, ":num_hiring_rounds", 0, 2),
         (try_end),           
       (try_end),
       
       (try_for_range, ":unused", 0, ":num_hiring_rounds"), 	
         (party_get_slot, ":cur_wealth", ":center_no", slot_town_wealth),
         (assign, ":hiring_budget", ":cur_wealth"),
         (val_div, ":hiring_budget", 2),
         (gt, ":hiring_budget", ":reinforcement_cost"),       
       #  (call_script, "script_cf_reinforce_party", ":center_no"),       
         (val_sub, ":cur_wealth", ":reinforcement_cost"),
         (party_set_slot, ":center_no", slot_town_wealth, ":cur_wealth"),
       (try_end),  
     (try_end),

(val_clamp, "$async_simple_trigger7", centers_begin, centers_end),
(val_add, "$async_simple_trigger7", 1),
	(try_begin),	
	(ge, "$async_simple_trigger7", centers_end),
	(assign, "$async_simple_trigger7", centers_begin),
	(try_end),
		(try_begin),
     #this is moved up from below , from a 24 x 15 slot to a 24 slot
     (assign, ":center_no", "$async_simple_trigger7"),
       #(neg|is_between, ":center_no", castles_begin, castles_end),
       (store_random_in_range, ":random", 0, 30),
       (le, ":random", 10),
	   
       (call_script, "script_get_center_ideal_prosperity", ":center_no"),
       (assign, ":ideal_prosperity", reg0),
       (party_get_slot, ":prosperity", ":center_no", slot_town_prosperity),       
       (try_begin),
	     (eq, ":random", 0), #with 3% probability it will gain +10/-10 prosperity even it has higher prosperity than its ideal prosperity.
         (try_begin),
           (store_random_in_range, ":random", 0, 2),
           (try_begin),
             (eq, ":random", 0),
             (neg|is_between, ":center_no", castles_begin, castles_end), #castles always gain positive prosperity from surprise income to balance their prosperity.
             (call_script, "script_change_center_prosperity", ":center_no", -10),
             (val_add, "$newglob_total_prosperity_from_convergence", -10),
           (else_try),     
             (call_script, "script_change_center_prosperity", ":center_no", 10),
             (val_add, "$newglob_total_prosperity_from_convergence", 10),
           (try_end),
         (try_end),
	   (else_try),
         (gt, ":prosperity", ":ideal_prosperity"),		 
         (call_script, "script_change_center_prosperity", ":center_no", -1),
         (val_add, "$newglob_total_prosperity_from_convergence", -1),
       (else_try),
         (lt, ":prosperity", ":ideal_prosperity"),		 
         (call_script, "script_change_center_prosperity", ":center_no", 1),
         (val_add, "$newglob_total_prosperity_from_convergence", 1),
	   (try_end),
     (try_end),	   	   	   
    ]),

  #Converging center prosperity to ideal prosperity once in every 15 days
  (24*15,
   []),

  #Checking if the troops are resting at a half payment point
  (6,
   [(store_current_day, ":cur_day"),
    (try_begin),
      (neq, ":cur_day", "$g_last_half_payment_check_day"),
      (assign, "$g_last_half_payment_check_day", ":cur_day"),
      (try_begin),
        (eq, "$g_half_payment_checkpoint", 1),
        (val_add, "$g_cur_week_half_daily_wage_payments", 1), #half payment for yesterday
      (try_end),
      (assign, "$g_half_payment_checkpoint", 1),
    (try_end),
    (assign, ":resting_at_manor_or_walled_center", 0),
    (try_begin),
      (neg|map_free),
      (ge, "$g_last_rest_center", 0),
      (this_or_next|party_slot_eq, "$g_last_rest_center", slot_center_has_manor, 1),
      (is_between, "$g_last_rest_center", walled_centers_begin, walled_centers_end),
      (assign, ":resting_at_manor_or_walled_center", 1),
    (try_end),
    (eq, ":resting_at_manor_or_walled_center", 0),
    (assign, "$g_half_payment_checkpoint", 0),
    ]),

#diplomatic indices
  (0.65,
   [
   #(call_script, "script_randomly_start_war_peace_new", 1),
   # (try_begin),
		# (store_random_in_range, ":acting_village", villages_begin, villages_end),
		# (store_random_in_range, ":target_village", villages_begin, villages_end),
		# (store_faction_of_party, ":acting_faction", ":acting_village"),
		# (store_faction_of_party, ":target_faction", ":target_village"), #target faction receives the provocation
		# (neq, ":acting_village", ":target_village"),
		# (neq, ":acting_faction", ":target_faction"),
		
		# (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":target_faction", ":acting_faction"),
		# (eq, reg0, 0),

		# (try_begin),
			# (party_slot_eq, ":acting_village", slot_center_original_faction, ":target_faction"),
			
			# (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":acting_village", -1),
		# (else_try),
			# (party_slot_eq, ":acting_village", slot_center_ex_faction, ":target_faction"),
			
			# (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":acting_village", -1),
			
		# (else_try),
			# (set_fixed_point_multiplier, 1),
			# (store_distance_to_party_from_party, ":distance", ":acting_village", ":target_village"),
			# (lt, ":distance", 25),
			
			# #(call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":acting_village", ":target_village"),
		# (try_end),
   # (try_end),

(val_clamp, "$async_simple_trigger8", kingdoms_begin, kingdoms_end),
(val_add, "$async_simple_trigger8", 1),
	(try_begin),	
	(ge, "$async_simple_trigger8", kingdoms_end),
	(assign, "$async_simple_trigger8", kingdoms_begin),
	(try_end),
		(try_begin),
   (assign, ":faction_1", "$async_simple_trigger8"),
		(faction_slot_eq, ":faction_1", slot_faction_state, sfs_active),
		(try_for_range, ":faction_2", kingdoms_begin, kingdoms_end),
			(neq, ":faction_1", ":faction_2"),
			(faction_slot_eq, ":faction_2", slot_faction_state, sfs_active),
			
			#remove provocations
			(store_add, ":slot_truce_days", ":faction_2", slot_faction_truce_days_with_factions_begin),
			(val_sub, ":slot_truce_days", kingdoms_begin),
			(faction_get_slot, ":truce_days", ":faction_1", ":slot_truce_days"),
			(try_begin),
				(ge, ":truce_days", 1),
				(try_begin),
					(eq, ":truce_days", 1),
					(call_script, "script_update_faction_notes", ":faction_1"),
					(lt, ":faction_1", ":faction_2"),
					(call_script, "script_add_notification_menu", "mnu_notification_truce_expired", ":faction_1", ":faction_2"),
				(try_end),
				(val_sub, ":truce_days", 1),
				(faction_set_slot, ":faction_1", ":slot_truce_days", ":truce_days"),
			(try_end),
		
			(store_add, ":slot_provocation_days", ":faction_2", slot_faction_provocation_days_with_factions_begin),
			(val_sub, ":slot_provocation_days", kingdoms_begin),
			(faction_get_slot, ":provocation_days", ":faction_1", ":slot_provocation_days"),
			(try_begin),
			(ge, ":provocation_days", 1),
				(try_begin),#factions already at war
					(store_relation, ":relation", ":faction_1", ":faction_2"),
					(lt, ":relation", 0),
					(faction_set_slot, ":faction_1", ":slot_provocation_days", 0),
				(else_try), #Provocation expires
					(eq, ":provocation_days", 1),
					#(call_script, "script_add_notification_menu", "mnu_notification_casus_belli_expired", ":faction_1", ":faction_2"),
					(faction_set_slot, ":faction_1", ":slot_provocation_days", 0),
				(try_end),
			(else_try),
			(lt, ":provocation_days", -1),
			(val_add, ":provocation_days", 1), 
			(faction_set_slot, ":faction_1", ":slot_provocation_days", ":provocation_days"),
			(try_end),

			(try_begin), #at war
				(store_relation, ":relation", ":faction_1", ":faction_2"),
				(lt, ":relation", 0),
				(store_add, ":slot_war_damage", ":faction_2", slot_faction_war_damage_inflicted_on_factions_begin),
				(val_sub, ":slot_war_damage", kingdoms_begin),
				(faction_get_slot, ":war_damage", ":faction_1", ":slot_war_damage"),
				(val_add, ":war_damage", 1),
				(faction_set_slot, ":faction_1", ":slot_war_damage", ":war_damage"),
				
				(store_add, ":slot_days_of_war_with_faction_before_pressure", ":faction_2", slot_faction_days_of_war_with_faction_before_pressure_begin),
				(val_sub, ":slot_days_of_war_with_faction_before_pressure", kingdoms_begin),
				(faction_get_slot, ":days", ":faction_1", ":slot_days_of_war_with_faction_before_pressure"),
					(try_begin),
					(gt, ":days", 1),
					(val_add, ":days", -1),
					(faction_set_slot, ":faction_1", ":slot_days_of_war_with_faction_before_pressure", ":days"),
					(try_end),
					(try_begin),
					(eq, ":days", 1),
					(call_script, "script_faction_change_infamy", ":faction_1", 1),
					(str_store_faction_name_link, s31, ":faction_1"),
					(str_store_faction_name_link, s32, ":faction_2"),
					(display_message, "@The {s31} gets 1 infamy because of the prolonged war with {s32}."),
					(try_end),
			(try_end),	
			
		(try_end),
		(call_script, "script_update_faction_notes", ":faction_1"),
	(try_end),
    ]),
		
  # Give some xp to hero parties
   (0.16,
   [      
(val_clamp, "$async_simple_trigger9", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger9", 1),
	(try_begin),	
	(ge, "$async_simple_trigger9", active_npcs_end),
	(assign, "$async_simple_trigger9", active_npcs_begin),
	(try_end),
		(try_begin),
       (assign, ":troop_no", "$async_simple_trigger9"),
         (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),	     	     
	              
         (troop_get_slot, ":hero_party", ":troop_no", slot_troop_leaded_party),
         (gt, ":hero_party", centers_end),
         (party_is_active, ":hero_party"),
         
         (store_skill_level, ":trainer_level", skl_trainer, ":troop_no"),                  
         (val_add, ":trainer_level", 5), #average trainer level is 3 for npc lords, worst : 0, best : 6
         (store_mul, ":xp_gain", ":trainer_level", 1000), #xp gain in two days of period for each lord, average : 8000.
         
         (assign, ":max_accepted_random_value", 30),
         (try_begin),               
           (store_troop_faction, ":cur_troop_faction", ":troop_no"),
           (neq, ":cur_troop_faction", "$players_kingdom"),
           
           (game_get_reduce_campaign_ai, ":reduce_campaign_ai"),
           (try_begin),
             (eq, ":reduce_campaign_ai", 0), #hard (1.5x)
             (assign, ":max_accepted_random_value", 35),
             (val_mul, ":xp_gain", 3),
             (val_div, ":xp_gain", 2),
           (else_try),
             (eq, ":reduce_campaign_ai", 2), #easy (0.5x)
             (assign, ":max_accepted_random_value", 25),
             (val_div, ":xp_gain", 2),
           (try_end),
         (try_end),
         
         (store_random_in_range, ":rand", 0, 100),
         (le, ":rand", ":max_accepted_random_value"),

         (party_upgrade_with_xp, ":hero_party", ":xp_gain"),
       (try_end),
       
(val_clamp, "$async_simple_trigger24", walled_centers_begin, walled_centers_end),
(val_add, "$async_simple_trigger24", 1),
	(try_begin),	
	(ge, "$async_simple_trigger24", walled_centers_end),
	(assign, "$async_simple_trigger24", walled_centers_begin),
	(try_end),
		(try_begin),
       (assign, ":center_no", "$async_simple_trigger24"),         
         (party_get_slot, ":center_lord", ":center_no", slot_town_lord),
         (neq, ":center_lord", "trp_player"),
         
         (assign, ":xp_gain", 3000), #xp gain in two days of period for each center, average : 3000.
         
         (assign, ":max_accepted_random_value", 30),
         (try_begin),            
           (assign, ":cur_center_lord_faction", -1),
           (try_begin),
             (ge, ":center_lord", 0),
             (store_troop_faction, ":cur_center_lord_faction", ":center_lord"),
           (try_end),             
           (neq, ":cur_center_lord_faction", "$players_kingdom"),
           
           (game_get_reduce_campaign_ai, ":reduce_campaign_ai"),
           (try_begin),
             (eq, ":reduce_campaign_ai", 0), #hard (1.5x)
             (assign, ":max_accepted_random_value", 35),
             (val_mul, ":xp_gain", 3),
             (val_div, ":xp_gain", 2),
           (else_try),
             (eq, ":reduce_campaign_ai", 2), #easy (0.5x)
             (assign, ":max_accepted_random_value", 25),
             (val_div, ":xp_gain", 2),
           (try_end),
         (try_end),

         (store_random_in_range, ":rand", 0, 100),
         (le, ":rand", ":max_accepted_random_value"),
         
         (party_upgrade_with_xp, ":center_no", ":xp_gain"),
       (try_end),
    ]),

  # Process sieges
   (0.08,
   [
       (call_script, "script_process_sieges"),
    ]),

  # Process village raids
   (0.003,
   [
       (call_script, "script_process_village_raids"),
    ]),


  # Decide vassal ai
   (0.001,
    [
      (call_script, "script_async_init_ai_calculation"),
(val_clamp, "$async_simple_trigger10", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger10", 1),
	(try_begin),	
	(ge, "$async_simple_trigger10", active_npcs_end),
	(assign, "$async_simple_trigger10", active_npcs_begin),
	(try_end),
		(try_begin),
      (assign, ":troop_no", "$async_simple_trigger10"),
        (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
      #  (call_script, "script_calculate_troop_ai", ":troop_no"),
      (try_end),
      ]),

  # Hold regular marshall elections for players_kingdom
   (24, #Disabled in favor of new system
    []),

   (0.08,
    [	  
(val_clamp, "$async_simple_trigger11", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger11", 1),
	(try_begin),	
	(ge, "$async_simple_trigger11", active_npcs_end),
	(assign, "$async_simple_trigger11", active_npcs_begin),
	(try_end),
		(try_begin),
	(assign, ":kingdom_hero", "$async_simple_trigger11"),
		(troop_get_slot, ":impatience", ":kingdom_hero", slot_troop_intrigue_impatience),
		(val_sub, ":impatience", 5),
		(val_max, ":impatience", 0),
		(troop_set_slot, ":kingdom_hero", slot_troop_intrigue_impatience, ":impatience"),
	(try_end),
	
	(store_random_in_range, ":controversy_deduction", 1, 3),
	(val_min, ":controversy_deduction", 2),
#	(assign, ":controversy_deduction", 1),
	
	#This reduces controversy by one each round
(val_clamp, "$async_simple_trigger12", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger12", 1),
	(try_begin),	
	(ge, "$async_simple_trigger12", active_npcs_end),
	(assign, "$async_simple_trigger12", active_npcs_begin),
	(try_end),
		(try_begin),
	(assign, ":active_npc", "$async_simple_trigger12"),
		(troop_get_slot, ":controversy", ":active_npc", slot_troop_controversy),
		(ge, ":controversy", 1),
		(val_sub, ":controversy", ":controversy_deduction"),
		(val_max, ":controversy", 0),
		(troop_set_slot, ":active_npc", slot_troop_controversy, ":controversy"),
	(try_end),
	
	(troop_get_slot, ":controversy", "trp_player", slot_troop_controversy),
	(val_sub, ":controversy", ":controversy_deduction"),
	(val_max, ":controversy", 0),
	(troop_set_slot, "trp_player", slot_troop_controversy, ":controversy"),
	
	]),
		
    #POLITICAL TRIGGERS
	#POLITICAL TRIGGER #1`
   (8, #increased from 12
    [	  
	(call_script, "script_cf_random_political_event"),
	
	#Added Nov 2010 begins - do this twice
#	(call_script, "script_cf_random_political_event"),
	#Added Nov 2010 ends
	
	#This generates quarrels and occasional reconciliations and interventions	
	]),
	
    #Individual lord political calculations
    #Check for lords without fiefs, auto-defections, etc
    (0.5,	
     [
        # (val_add, "$g_lord_long_term_count", 1),
        # (try_begin),
          # (neg|is_between, "$g_lord_long_term_count", "trp_kingdom_heroes_including_player_begin", active_npcs_end),
          # (assign, "$g_lord_long_term_count", "trp_kingdom_heroes_including_player_begin"),
        # (try_end),

        # (assign, ":troop_no", "$g_lord_long_term_count"),
	
        # (try_begin),
          # (eq, ":troop_no", "trp_kingdom_heroes_including_player_begin"),	
          # (assign, ":troop_no", "trp_player"),
        # (try_end),

        # (try_begin),
          # (eq, "$cheat_mode", 1),
          # (str_store_troop_name, s9, ":troop_no"),
          # (display_message, "@{!}DEBUG -- Doing political calculations for {s9}"),
        # (try_end),
	
        # #Penalty for no fief
        # (try_begin),
          # (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          # (neq, ":troop_no", "trp_player"),
		  
          # (assign, ":fief_found", -1),
          # (try_for_range, ":center", centers_begin, centers_end),
            # (party_slot_eq, ":center", slot_town_lord, ":troop_no"),
            # (assign, ":fief_found", ":center"),
          # (try_end),
		
          # (try_begin),
            # (eq, ":fief_found", -1),
                        			
            # (store_faction_of_troop, ":original_faction", ":troop_no"),
            # (faction_get_slot, ":faction_leader", ":original_faction", slot_faction_leader),
            # (troop_get_slot, ":troop_reputation", ":troop_no", slot_lord_reputation_type),
			
            # (try_begin),
              # (neq, ":faction_leader", ":troop_no"),
              # (try_begin),
                # (this_or_next|eq, ":troop_reputation", lrep_quarrelsome),
                # (this_or_next|eq, ":troop_reputation", lrep_selfrighteous),
                # (this_or_next|eq, ":troop_reputation", lrep_cunning),
                # (eq, ":troop_reputation", lrep_debauched),
                # (call_script, "script_troop_change_relation_with_troop", ":troop_no", ":faction_leader", -4),
                # (val_add, "$total_no_fief_changes", -4),
              # (else_try),
                # (eq, ":troop_reputation", lrep_martial),
                # (call_script, "script_troop_change_relation_with_troop", ":troop_no", ":faction_leader", -2),
                # (val_add, "$total_no_fief_changes", -2),
              # (try_end),
            # (try_end),
          # (try_end),
        # (try_end),	
		
        # #Auto-indictment or defection
        # (try_begin),
          # (this_or_next|troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          # (eq, ":troop_no", "trp_player"),		
          # (try_begin),
            # (eq, ":troop_no", "trp_player"),
            # (assign, ":faction", "$players_kingdom"),
          # (else_try),
            # (store_faction_of_troop, ":faction", ":troop_no"),
          # (try_end),

          # (faction_get_slot, ":faction_leader", ":faction", slot_faction_leader),
          # (neq, ":troop_no", ":faction_leader"),
			
          # #I don't know why these are necessary, but they appear to be
          # (neg|is_between, ":troop_no", "trp_kingdom_1_lord", "trp_knight_1_1"),
          # (neg|is_between, ":troop_no", pretenders_begin, pretenders_end),
		  
		  # (assign, ":num_centers", 0),		  
		  # (try_for_range,":cur_center", walled_centers_begin, walled_centers_end),		    
		    # (store_faction_of_party, ":faction_of_center", ":cur_center"),
			# (eq, ":faction_of_center", ":faction"),			
			# (val_add, ":num_centers", 1),
		  # (try_end),

		  # #we are counting num_centers to allow defection although there is high relation between faction leader and troop. 
		  # #but this rule should not applied for player's faction and player_supporters_faction so thats why here 1 is added to num_centers in that case.
		  # (try_begin), 
		    # (this_or_next|eq, ":faction", "$players_kingdom"),
			# (eq, ":faction", "fac_player_supporters_faction"),
			# (val_add, ":num_centers", 1),
		  # (try_end),
			
          # (call_script, "script_troop_get_relation_with_troop", ":troop_no", ":faction_leader"),
          # (this_or_next|le, reg0, -50), #was -75
		  # (eq, ":num_centers", 0), #if there is no walled centers that faction has defection happens 100%.

          # (call_script, "script_cf_troop_can_intrigue", ":troop_no", 0), #Should include battle, prisoner, in a castle with others 
          # (store_random_in_range, ":who_moves_first", 0, 2),
			
          # (try_begin),
            # (this_or_next|eq, ":num_centers", 0), #Thanks Caba`drin & Osviux
            # (neq, ":who_moves_first", 0),
            # (neq, ":troop_no", "trp_player"),
				
                        # #do a defection
                        # (try_begin), 
                          # (neq, ":num_centers", 0), 
                          # (assign, "$g_give_advantage_to_original_faction", 1), 
                        # (try_end),
			# #(assign, "$g_give_advantage_to_original_faction", 1),
        
			# (store_faction_of_troop, ":orig_faction", ":troop_no"),
			# (call_script, "script_lord_find_alternative_faction", ":troop_no"),
			# (assign, ":new_faction", reg0),			
			# (assign, "$g_give_advantage_to_original_faction", 0),
			# (try_begin),
			  # (neq, ":new_faction", ":orig_faction"),			  
            
              # (is_between, ":new_faction", kingdoms_begin, kingdoms_end),
              # (str_store_troop_name_link, s1, ":troop_no"),
              # (str_store_faction_name_link, s2, ":new_faction"),	
              # (str_store_faction_name_link, s3, ":faction"),
              # (call_script, "script_change_troop_faction", ":troop_no", ":new_faction"),
              # (try_begin),
                # (ge, "$cheat_mode", 1),
                # (str_store_troop_name, s4, ":troop_no"),
                # (display_message, "@{!}DEBUG - {s4} faction changed in defection"), 
              # (try_end),	
              # (troop_get_type, reg4, ":troop_no"),
              # (str_store_string, s4, "str_lord_defects_ordinary"),
              # (display_log_message, "@{!}{s4}"),
              # (try_begin),
                # (eq, "$cheat_mode", 1),
                # (this_or_next|eq, ":new_faction", "$players_kingdom"),
                # (eq, ":faction", "$players_kingdom"),
                # (call_script, "script_add_notification_menu", "mnu_notification_lord_defects", ":troop_no", ":faction"),
              # (try_end),				
			# (try_end),
          # (else_try),	
            # (neq, ":faction_leader", "trp_player"),
			# (call_script, "script_troop_get_relation_with_troop", ":troop_no", ":faction_leader"),
			# (le, reg0, -50), #was -75
            # (call_script, "script_indict_lord_for_treason", ":troop_no", ":faction"),
          # (try_end),		  
        # (else_try),  #Take a stand on an issue
          # (neq, ":troop_no", "trp_player"),
          # (store_faction_of_troop, ":faction", ":troop_no"),
          # (faction_slot_ge, ":faction", slot_faction_political_issue, 1),
          # #This bit of complication is needed for savegame compatibility -- if zero is in the slot, they'll choose anyway			
          # (neg|troop_slot_ge, ":troop_no", slot_troop_stance_on_faction_issue, 1), 
          # (this_or_next|troop_slot_eq, ":troop_no", slot_troop_stance_on_faction_issue, -1),
          # (neq, "$players_kingdom", ":faction"),
          # (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          # (call_script, "script_npc_decision_checklist_take_stand_on_issue", ":troop_no"),
          # (troop_set_slot, ":troop_no", slot_troop_stance_on_faction_issue, reg0),
        # (try_end),

        # (try_for_range, ":active_npc", active_npcs_begin, active_npcs_end),
          # (call_script, "script_troop_get_relation_with_troop", ":troop_no", ":active_npc"),
          # (lt, reg0, 0),
          # (assign, ":relation", reg0),
          # (store_sub, ":chance_of_convergence", 0, ":relation"),
          # (store_random_in_range, ":random", 0, 300),
          # (lt, ":random", ":chance_of_convergence"),
          # (call_script, "script_troop_change_relation_with_troop", ":troop_no", ":active_npc", 1),
          # (val_add, "$total_relation_changes_through_convergence", 1),
        # (try_end),				
        ]),
	  
  # Process vassal ai
   (2,
   [
     #(call_script, "script_process_kingdom_parties_ai"), #moved to below trigger (per 1 hour) in order to allow it processed more frequent.
   ]),

  # Process alarms - perhaps break this down into several groups, with a modula
   (0.001,
   [
      (call_script, "script_async_process_alarms"),

      (call_script, "script_async_allow_vassals_to_join_indoor_battle"),
     
      (call_script, "script_async_process_kingdom_parties_ai"),
   ]),

  # Process siege ai
   (3,
   [
      (store_current_hours, ":cur_hours"),
      (try_for_range, ":center_no", walled_centers_begin, walled_centers_end),
        (party_get_slot, ":besieger_party", ":center_no", slot_center_is_besieged_by),
        (gt, ":besieger_party", 0),
        (party_is_active, ":besieger_party"),
        (store_faction_of_party, ":besieger_faction", ":besieger_party"),
        (party_slot_ge, ":center_no", slot_center_is_besieged_by, 1),
        (party_get_slot, ":siege_begin_hours", ":center_no", slot_center_siege_begin_hours),
        (store_sub, ":siege_begin_hours", ":cur_hours", ":siege_begin_hours"),
        (assign, ":launch_attack", 0),
        (assign, ":call_attack_back", 0),
        (assign, ":attacker_strength", 0),
        (assign, ":marshall_attacking", 0),
        (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
          (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
          (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
          (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
          (gt, ":party_no", 0),
          (party_is_active, ":party_no"),
		  
          (store_troop_faction, ":troop_faction_no", ":troop_no"),
          (eq, ":troop_faction_no", ":besieger_faction"),
          (assign, ":continue", 0),
          (try_begin),
            (party_slot_eq, ":party_no", slot_party_ai_state, spai_besieging_center),
            (party_slot_eq, ":party_no", slot_party_ai_object, ":center_no"),
            (assign, ":continue", 1),
          (else_try),
            (party_slot_eq, ":party_no", slot_party_ai_state, spai_accompanying_army),
            (party_get_slot, ":commander_party", ":party_no", slot_party_ai_object),
            (gt, ":commander_party", 0),
            (party_is_active, ":commander_party"),
            (party_slot_eq, ":commander_party", slot_party_ai_state, spai_besieging_center),
            (party_slot_eq, ":commander_party", slot_party_ai_object, ":center_no"),
            (assign, ":continue", 1),
          (try_end),
          (eq, ":continue", 1),
          (party_get_battle_opponent, ":opponent", ":party_no"),
          (this_or_next|lt, ":opponent", 0),
          (eq, ":opponent", ":center_no"),
          (try_begin),
            (faction_slot_eq, ":besieger_faction", slot_faction_marshall, ":troop_no"),
            (assign, ":marshall_attacking", 1),
          (try_end),
          (call_script, "script_party_calculate_regular_strength", ":party_no"),
          (val_add, ":attacker_strength", reg0),
        (try_end),
        (try_begin),
          (gt, ":attacker_strength", 0),
          (party_collect_attachments_to_party, ":center_no", "p_collective_enemy"),
          (call_script, "script_party_calculate_regular_strength", "p_collective_enemy"),
          (assign, ":defender_strength", reg0),
          (try_begin),
            (eq, "$auto_enter_town", ":center_no"),
            (eq, "$g_player_is_captive", 0),
            (call_script, "script_party_calculate_regular_strength", "p_main_party"),
            (val_add, ":defender_strength", reg0),
            (val_mul, ":attacker_strength", 2), #double the power of attackers if the player is in the campaign
          (try_end),
          (party_get_slot, ":siege_hardness", ":center_no", slot_center_siege_hardness),
          (val_add, ":siege_hardness", 100),
          (val_mul, ":defender_strength", ":siege_hardness"),
          (val_div, ":defender_strength", 100),
          (val_max, ":defender_strength", 1),
          (try_begin),
            (eq, ":marshall_attacking", 1),
            (eq, ":besieger_faction", "$players_kingdom"),
            (check_quest_active, "qst_follow_army"),
            (val_mul, ":attacker_strength", 2), #double the power of attackers if the player is in the campaign
          (try_end),
          (store_mul, ":strength_ratio", ":attacker_strength", 100),
          (val_div, ":strength_ratio", ":defender_strength"),
          (store_sub, ":random_up_limit", ":strength_ratio", 250), #was 300 (1.126)
                    
          (try_begin),
            (gt, ":random_up_limit", -100), #never attack if the strength ratio is less than 150%
            (store_div, ":siege_begin_hours_effect", ":siege_begin_hours", 2), #was 3 (1.126)
            (val_add, ":random_up_limit", ":siege_begin_hours_effect"),
          (try_end),

          (val_div, ":random_up_limit", 5),
          (val_max, ":random_up_limit", 0),
          (store_sub, ":random_down_limit", 175, ":strength_ratio"), #was 200 (1.126)
          (val_max, ":random_down_limit", 0),
          (try_begin),
            (store_random_in_range, ":rand", 0, 100),
            (lt, ":rand", ":random_up_limit"),
            (gt, ":siege_begin_hours", 24),#initial preparation
            (assign, ":launch_attack", 1),
          (else_try),
            (store_random_in_range, ":rand", 0, 100),
            (lt, ":rand", ":random_down_limit"),            
            (assign, ":call_attack_back", 1),
          (try_end),
        (else_try),
          (assign, ":call_attack_back", 1),
        (try_end),

        #Assault the fortress
        (try_begin),
          (eq, ":launch_attack", 1),
          (call_script, "script_begin_assault_on_center", ":center_no"),
        (else_try),
          (eq, ":call_attack_back", 1),
          (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
            (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
            (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
            (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
            (gt, ":party_no", 0),
            (party_is_active, ":party_no"),
			
            (party_slot_eq, ":party_no", slot_party_ai_state, spai_besieging_center),
            (party_slot_eq, ":party_no", slot_party_ai_object, ":center_no"),
            (party_slot_eq, ":party_no", slot_party_ai_substate, 1),
            (call_script, "script_party_set_ai_state", ":party_no", spai_undefined, -1),
            (call_script, "script_party_set_ai_state", ":party_no", spai_besieging_center, ":center_no"),
            #resetting siege begin time if at least 1 party retreats
            (party_set_slot, ":center_no", slot_center_siege_begin_hours, ":cur_hours"),
          (try_end),
        (try_end),
      (try_end),
    ]),

    # Decide faction ais
    (0.01, #it was 23
    [
   #   (call_script, "script_async_recalculate_ais"),
    ]),
	
    
  # Decide faction ai flag check
   (0,
   [
   (set_relation, "fac_player_faction", "fac_no_faction", 0),
   (set_relation, "fac_player_supporters_faction", "fac_no_faction", 0),

    (try_begin),
		(ge, "$cheat_mode", 1),
	
		(try_for_range, ":king", "trp_kingdom_1_lord", "trp_knight_1_1"),		
			(store_add, ":proper_faction", ":king", "fac_kingdom_1"),
			(val_sub, ":proper_faction", "trp_kingdom_1_lord"),
			(store_faction_of_troop, ":actual_faction", ":king"),
			
			(neq, ":proper_faction", ":actual_faction"),
			(neq, ":actual_faction", "fac_commoners"),
			(ge, "$cheat_mode", 2),
			(neq, ":king", "trp_kingdom_2_lord"),
			
			(str_store_troop_name, s4, ":king"),
			(str_store_faction_name, s5, ":actual_faction"),
			(str_store_faction_name, s6, ":proper_faction"),
			(str_store_string, s65, "@{!}DEBUG - {s4} is in {s5}, should be in {s6}, disabling political cheat mode"),
#			(display_message, "@{s65}"),
			(rest_for_hours, 0, 0, 0),
			
			#(assign, "$cheat_mode", 1),
			(jump_to_menu, "mnu_debug_alert_from_s65"),
		(try_end),
	
	
	(try_end),
   
     (eq, "$g_recalculate_ais", 1),
     (assign, "$g_recalculate_ais", 0),
     (call_script, "script_recalculate_ais"),
   ]),
	
    # Count faction armies
    (0.7,
    [
(val_clamp, "$async_simple_trigger13", kingdoms_begin, kingdoms_end),
(val_add, "$async_simple_trigger13", 1),
	(try_begin),	
	(ge, "$async_simple_trigger13", kingdoms_end),
	(assign, "$async_simple_trigger13", kingdoms_begin),
	(try_end),
		(try_begin),
       (assign, ":faction_no", "$async_simple_trigger13"),
         (call_script, "script_faction_recalculate_strength", ":faction_no"),
       (try_end),
    ]),

    (24,
    [
	   (try_for_range, ":active_npc", active_npcs_begin, active_npcs_end),
		(store_faction_of_troop, ":active_npc_faction", ":active_npc"),
		(neg|faction_slot_eq, ":active_npc_faction", slot_faction_ai_state, sfai_default),
		(neg|faction_slot_eq, ":active_npc_faction", slot_faction_ai_state, sfai_feast),
		(neg|faction_slot_eq, ":active_npc_faction", slot_faction_ai_state, sfai_gathering_army),
		
		(troop_get_slot, ":active_npc_party", ":active_npc", slot_troop_leaded_party),
		(party_is_active, ":active_npc_party"),
		
		(val_add, "$total_vassal_days_on_campaign", 1),
		
	    (party_slot_eq, ":active_npc_party", slot_party_ai_state, spai_accompanying_army),
		(val_add, "$total_vassal_days_responding_to_campaign", 1),
		
	   
	   (try_end),
	   
    ]),

  # Reset hero quest status
  # Change hero relation
   (36,
   [
     (try_for_range, ":troop_no", heroes_begin, heroes_end),
       (troop_set_slot, ":troop_no", slot_troop_does_not_give_quest, 0),
     (try_end),
     
     (try_for_range, ":troop_no", village_elders_begin, village_elders_end),
       (troop_set_slot, ":troop_no", slot_troop_does_not_give_quest, 0),
     (try_end),
    ]),

  # Refresh merchant inventories
   (0.2,
   [
(val_clamp, "$async_simple_trigger14", villages_begin, villages_end),
(val_add, "$async_simple_trigger14", 1),
	(try_begin),	
	(ge, "$async_simple_trigger14", villages_end),
	(assign, "$async_simple_trigger14", villages_begin),
	(try_end),
		(try_begin),
      (assign, ":village_no", "$async_simple_trigger14"),
        (call_script, "script_refresh_village_merchant_inventory", ":village_no"),
      (try_end),
    ]),

  #Refreshing village defenders
  #Clearing slot_village_player_can_not_steal_cattle flags
   (0.07,
   [
(val_clamp, "$async_simple_trigger15", villages_begin, villages_end),
(val_add, "$async_simple_trigger15", 1),
	(try_begin),	
	(ge, "$async_simple_trigger15", villages_end),
	(assign, "$async_simple_trigger15", villages_begin),
	(try_end),
		(try_begin),
      (assign, ":village_no", "$async_simple_trigger15"),
        (call_script, "script_refresh_village_defenders", ":village_no"),
        (party_set_slot, ":village_no", slot_village_player_can_not_steal_cattle, 0),
      (try_end),
    ]),

  # Refresh number of cattle in villages
  (0.168,
   [
(val_clamp, "$async_simple_trigger16", centers_begin, centers_end),
(val_add, "$async_simple_trigger16", 1),
	(try_begin),	
	(ge, "$async_simple_trigger16", centers_end),
	(assign, "$async_simple_trigger16", centers_begin),
	(try_end),
		(try_begin),
     (assign, ":village_no", "$async_simple_trigger16"),
	   (neg|is_between, ":village_no", castles_begin, castles_end),
	   (party_get_slot, ":num_cattle", ":village_no", slot_center_head_cattle),
	   (party_get_slot, ":num_sheep", ":village_no", slot_center_head_sheep),
	   (party_get_slot, ":num_acres", ":village_no", slot_center_acres_pasture),
	   (val_max, ":num_acres", 1),
	   
	   (store_mul, ":grazing_capacity", ":num_cattle", 400),
	   (store_mul, ":sheep_addition", ":num_sheep", 200),
	   (val_add, ":grazing_capacity", ":sheep_addition"),
	   (val_div, ":grazing_capacity", ":num_acres"),
	   
	   (store_random_in_range, ":random_no", 0, 100),
	   (try_begin), #Disaster
	     (eq, ":random_no", 0),#1% chance of epidemic - should happen once every two years
		 (val_min, ":num_cattle", 10),
		 
       (else_try), #Overgrazing
         (gt, ":grazing_capacity", 100),
		
         (val_mul, ":num_sheep", 90), #10% decrease at number of cattles
         (val_div, ":num_sheep", 100),
		
         (val_mul, ":num_cattle", 90), #10% decrease at number of sheeps
         (val_div, ":num_cattle", 100),
		 
       (else_try), #superb grazing
         (lt, ":grazing_capacity", 30),

         (val_mul, ":num_cattle", 120), #20% increase at number of cattles
         (val_div, ":num_cattle", 100),
         (val_add, ":num_cattle", 1),
		
         (val_mul, ":num_sheep", 120), #20% increase at number of sheeps
         (val_div, ":num_sheep", 100),
         (val_add, ":num_sheep", 1),
		
       (else_try), #very good grazing
         (lt, ":grazing_capacity", 60),

         (val_mul, ":num_cattle", 110), #10% increase at number of cattles
         (val_div, ":num_cattle", 100),
         (val_add, ":num_cattle", 1),
		
         (val_mul, ":num_sheep", 110), #10% increase at number of sheeps
         (val_div, ":num_sheep", 100),
         (val_add, ":num_sheep", 1),

       (else_try), #good grazing
         (lt, ":grazing_capacity", 100),
         (lt, ":random_no", 50),

         (val_mul, ":num_cattle", 105), #5% increase at number of cattles
         (val_div, ":num_cattle", 100),
         (try_begin), #if very low number of cattles and there is good grazing then increase number of cattles also by one
           (le, ":num_cattle", 20),
           (val_add, ":num_cattle", 1),
         (try_end),
		
         (val_mul, ":num_sheep", 105), #5% increase at number of sheeps
         (val_div, ":num_sheep", 100),
         (try_begin), #if very low number of sheeps and there is good grazing then increase number of sheeps also by one
           (le, ":num_sheep", 20),
           (val_add, ":num_sheep", 1),
         (try_end),		
       (try_end),

       (party_set_slot, ":village_no", slot_center_head_cattle, ":num_cattle"),
       (party_set_slot, ":village_no", slot_center_head_sheep, ":num_sheep"),	  	  	  
     (try_end),
    ]),

   #Accumulate taxes
   (24 * 7,
   [
	  #Collect taxes for another week
      (try_for_range, ":center_no", centers_begin, centers_end),
        (try_begin),
          (party_slot_ge, ":center_no", slot_town_lord, 0), #unassigned centers do not accumulate rents	  
        
          (party_get_slot, ":accumulated_rents", ":center_no", slot_center_accumulated_rents),		  
		
          (assign, ":cur_rents", 0),
          (try_begin),
            (party_slot_eq, ":center_no", slot_party_type, spt_village),
            (try_begin),
              (party_slot_eq, ":center_no", slot_village_state, svs_normal),
              (assign, ":cur_rents", 1200),
            (try_end),
          (else_try),
            (party_slot_eq, ":center_no", slot_party_type, spt_castle),
            (assign, ":cur_rents", 1200),
          (else_try),  
            (party_slot_eq, ":center_no", slot_party_type, spt_town),
            (assign, ":cur_rents", 2400),
          (try_end),
		
          (party_get_slot, ":prosperity", ":center_no", slot_town_prosperity), #prosperty changes between 0..100     
          (store_add, ":multiplier", 20, ":prosperity"), #multiplier changes between 20..120
          (val_mul, ":cur_rents", ":multiplier"), 
          (val_div, ":cur_rents", 120),#Prosperity of 100 gives the default values
          
          (try_begin),
            (party_slot_eq, ":center_no", slot_town_lord, "trp_player"),
            
            (game_get_reduce_campaign_ai, ":reduce_campaign_ai"),
            (try_begin),
              (eq, ":reduce_campaign_ai", 0), #hard (less money from rents)
              (val_mul, ":cur_rents", 3),
              (val_div, ":cur_rents", 4),
            (else_try),
              (eq, ":reduce_campaign_ai", 1), #medium (normal money from rents)
              #same
            (else_try),
              (eq, ":reduce_campaign_ai", 2), #easy (more money from rents)
              (val_mul, ":cur_rents", 4),
              (val_div, ":cur_rents", 3),
            (try_end),                
          (try_end),  
                    
          (val_add, ":accumulated_rents", ":cur_rents"), #cur rents changes between 23..1000
          (party_set_slot, ":center_no", slot_center_accumulated_rents, ":accumulated_rents"),
        (try_end),
        
		(try_begin),
		  (is_between, ":center_no", villages_begin, villages_end),
		  (party_get_slot, ":bound_castle", ":center_no", slot_village_bound_center),
		  (party_slot_ge, ":bound_castle", slot_town_lord, 0), #unassigned centers do not accumulate rents	  
		  (is_between, ":bound_castle", castles_begin, castles_end),
		  (party_get_slot, ":accumulated_rents", ":bound_castle", slot_center_accumulated_rents), #castle's accumulated rents
		  (val_add, ":accumulated_rents", ":cur_rents"), #add village's rent to castle rents
		  (party_set_slot, ":bound_castle", slot_center_accumulated_rents, ":accumulated_rents"),
		(try_end),		
      (try_end),
    ]),

  
  # Offer player to join faction
  # Only if the player is male -- female characters will be told that they should seek out a faction through NPCs, possibly
   (32,
   [
     (eq, "$players_kingdom", 0),
     (le, "$g_invite_faction", 0),
     (eq, "$g_player_is_captive", 0),
	 (troop_get_type, ":type", "trp_player"),
	 (try_begin),
		(eq, ":type", 1),
		(eq, "$npc_with_sisterly_advice", 0),
		(try_for_range, ":npc", companions_begin, companions_end),
			(main_party_has_troop, ":npc"),
			(troop_get_type, ":npc_type", ":npc"),
			(eq, ":npc_type", 1),
			(troop_slot_ge, "trp_player", slot_troop_renown, 150),
			(troop_slot_ge, ":npc", slot_troop_woman_to_woman_string, 1),
			(assign, "$npc_with_sisterly_advice", ":npc"),
		(try_end),
	 (else_try),
	     (store_random_in_range, ":kingdom_no", npc_kingdoms_begin, npc_kingdoms_end),
	     (assign, ":min_distance", 999999),
	     (try_for_range, ":center_no", walled_centers_begin, walled_centers_end),
	       (store_faction_of_party, ":center_faction", ":center_no"),
	       (eq, ":center_faction", ":kingdom_no"),
	       (store_distance_to_party_from_party, ":cur_distance", "p_main_party", ":center_no"),
	       (val_min, ":min_distance", ":cur_distance"),
	     (try_end),
	     (lt, ":min_distance", 30),
	     (store_relation, ":kingdom_relation", ":kingdom_no", "fac_player_supporters_faction"),
	     (faction_get_slot, ":kingdom_lord", ":kingdom_no", slot_faction_leader),
	     (call_script, "script_troop_get_player_relation", ":kingdom_lord"),
	     (assign, ":lord_relation", reg0),
	     #(troop_get_slot, ":lord_relation", ":kingdom_lord", slot_troop_player_relation),
	     (call_script, "script_get_number_of_hero_centers", "trp_player"),
	     (assign, ":num_centers_owned", reg0),
	     (eq, "$g_infinite_camping", 0),
	     	     
	     (assign, ":player_party_size", 0),	     
	     (try_begin),
	       (ge, "p_main_party", 0),
	       (store_party_size_wo_prisoners, ":player_party_size", "p_main_party"),	     
	     (try_end),  
	     
	     (try_begin),	       
	       (eq, ":num_centers_owned", 0),
	       (troop_get_slot, ":player_renown", "trp_player", slot_troop_renown),
	       (ge, ":player_renown", 160),
	       (ge, ":kingdom_relation", 0),
	       (ge, ":lord_relation", 0),
	       (ge, ":player_party_size", 45),
	       (store_random_in_range, ":rand", 0, 100),
	       (lt, ":rand", 50),
	       (call_script, "script_get_poorest_village_of_faction", ":kingdom_no"),
	       (assign, "$g_invite_offered_center", reg0),
	       (ge, "$g_invite_offered_center", 0),
	       (assign, "$g_invite_faction", ":kingdom_no"),
	       (jump_to_menu, "mnu_invite_player_to_faction"),
	     (else_try),
	       (gt, ":num_centers_owned", 0),
	       (neq, "$players_oath_renounced_against_kingdom", ":kingdom_no"),
	       (ge, ":kingdom_relation", -40),
	       (ge, ":lord_relation", -20),
	       (ge, ":player_party_size", 30),
	       (store_random_in_range, ":rand", 0, 100),
	       (lt, ":rand", 20),
	       (assign, "$g_invite_faction", ":kingdom_no"),
	       (assign, "$g_invite_offered_center", -1),
	       (jump_to_menu, "mnu_invite_player_to_faction_without_center"),
	     (try_end),
	 (try_end), 
    ]),

    #recalculate lord random decision seeds once in every week
	(24 * 7, 
	[
      (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
        (store_random_in_range, ":random", 0, 9999),
        (troop_set_slot, ":troop_no", slot_troop_temp_decision_seed, ":random"),
      (try_end),
	]),

  # Attach Lord Parties to the town they are in
  (0.001,
   [
(val_clamp, "$async_simple_trigger29", heroes_begin, heroes_end),
(val_add, "$async_simple_trigger29", 1),
	(try_begin),	
	(ge, "$async_simple_trigger29", heroes_end),
	(assign, "$async_simple_trigger29", heroes_begin),
	(try_end),
		(try_begin),
       (assign, ":troop_no", "$async_simple_trigger29"),
         (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
         (troop_get_slot, ":troop_party_no", ":troop_no", slot_troop_leaded_party),
         (ge, ":troop_party_no", 1),
		 (party_is_active, ":troop_party_no"),
		 
         (party_get_attached_to, ":cur_attached_town", ":troop_party_no"),
         (lt, ":cur_attached_town", 1),
         (party_get_cur_town, ":destination", ":troop_party_no"),
         (is_between, ":destination", centers_begin, centers_end),
         (call_script, "script_get_relation_between_parties", ":destination", ":troop_party_no"),
         (try_begin),
           (ge, reg0, 0),
           (party_attach_to_party, ":troop_party_no", ":destination"),
         (else_try),
           (party_set_ai_behavior, ":troop_party_no", ai_bhvr_hold),
         (try_end),
         
         (try_begin),
           (this_or_next|party_slot_eq, ":destination", slot_party_type, spt_town),
           (party_slot_eq, ":destination", slot_party_type, spt_castle),
           (store_faction_of_party, ":troop_faction_no", ":troop_party_no"),
           (store_faction_of_party, ":destination_faction_no", ":destination"),
           (eq, ":troop_faction_no", ":destination_faction_no"),
           (party_get_num_prisoner_stacks, ":num_stacks", ":troop_party_no"),
           (gt, ":num_stacks", 0),
           (assign, "$g_move_heroes", 1),
           (call_script, "script_party_prisoners_add_party_prisoners", ":destination", ":troop_party_no"),#Moving prisoners to the center
           (assign, "$g_move_heroes", 1),
           (call_script, "script_party_remove_all_prisoners", ":troop_party_no"),
         (try_end),
       (try_end),
	   	   
	   (try_for_parties, ":bandit_camp"),
	 	 (gt, ":bandit_camp", "p_spawn_points_end"),
		 #Can't have party is active here, because it will fail for inactive parties
		 (party_get_template_id, ":template", ":bandit_camp"),
		 (ge, ":template", "pt_steppe_bandit_lair"),
		
		 (store_distance_to_party_from_party, ":distance", "p_main_party", ":bandit_camp"),
	     (lt, ":distance", 3), 
	     (party_set_flags, ":bandit_camp", pf_disabled, 0),
	     (party_set_flags, ":bandit_camp", pf_always_visible, 1),	   
	   (try_end),
    ]),

  # Check escape chances of hero prisoners.
  (48,
   [
       (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", "p_main_party", 50),
       (try_for_range, ":center_no", walled_centers_begin, walled_centers_end),
##         (party_slot_eq, ":center_no", slot_town_lord, "trp_player"),
         (assign, ":chance", 30),
         (try_begin),
           (party_slot_eq, ":center_no", slot_center_has_prisoner_tower, 1),
           (assign, ":chance", 5),
         (try_end),
         (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", ":center_no", ":chance"),
       (try_end),
    ]),

  # Asking the ownership of captured centers to the player
#  (3,
#   [
#    (assign, "$g_center_taken_by_player_faction", -1),
#    (try_for_range, ":center_no", centers_begin, centers_end),
#      (eq, "$g_center_taken_by_player_faction", -1),
#      (store_faction_of_party, ":center_faction", ":center_no"),
#      (eq, ":center_faction", "fac_player_supporters_faction"),
#      (this_or_next|party_slot_eq, ":center_no", slot_town_lord, stl_reserved_for_player),
#      (this_or_next|party_slot_eq, ":center_no", slot_town_lord, stl_unassigned),
#      (party_slot_eq, ":center_no", slot_town_lord, stl_rejected_by_player),
#      (assign, "$g_center_taken_by_player_faction", ":center_no"),
#    (try_end),
#    (faction_get_slot, ":leader", "fac_player_supporters_faction", slot_faction_leader),

#	(try_begin),
#		(ge, "$g_center_taken_by_player_faction", 0),
		
#		(eq, "$cheat_mode", 1),
#		(str_store_party_name, s14, "$g_center_taken_by_player_faction"),
#		(display_message, "@{!}{s14} should be assigned to lord"),
#	(try_end),
	
#    ]),


  # Respawn hero party after kingdom hero is released from captivity.
  (48, 
   [
       (try_for_range, ":troop_no", active_npcs_begin, active_npcs_end),
         (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),

         (str_store_troop_name, s1, ":troop_no"),
       
         (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
         (neg|troop_slot_ge, ":troop_no", slot_troop_leaded_party, 1),

         (store_troop_faction, ":cur_faction", ":troop_no"),
         (try_begin),
           (eq, ":cur_faction", "fac_outlaws"), #Do nothing
         (else_try),         
           (try_begin),
             (eq, "$cheat_mode", 2),
             (str_store_troop_name, s4, ":troop_no"),
             (display_message, "str_debug__attempting_to_spawn_s4"),
           (try_end),
           
           (call_script, "script_cf_select_random_walled_center_with_faction_and_owner_priority_no_siege", ":cur_faction", ":troop_no"),#Can fail
           (assign, ":center_no", reg0),

           (try_begin),
             (eq, "$cheat_mode", 2),             
             (str_store_party_name, s7, ":center_no"),
			 (str_store_troop_name, s0, ":troop_no"),
             (display_message, "str_debug__s0_is_spawning_around_party__s7"),
           (try_end),
       
           (call_script, "script_create_kingdom_hero_party", ":troop_no", ":center_no"),

		   (try_begin),
		     (eq, "$g_there_is_no_avaliable_centers", 0),
             (party_attach_to_party, "$pout_party", ":center_no"),
           (try_end),
           
           #new
           #(troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
		   #(call_script, "script_npc_decision_checklist_party_ai", ":troop_no"), #This handles AI for both marshal and other parties		
		   #(call_script, "script_party_set_ai_state", ":party_no", reg0, reg1),
		   #new end

           (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
           (call_script, "script_party_set_ai_state", ":party_no", spai_holding_center, ":center_no"),           
           
         (else_try),
           (neg|faction_slot_eq, ":cur_faction", slot_faction_state, sfs_active),
           (try_begin),
             (is_between, ":troop_no", kings_begin, kings_end),
			 (call_script, "script_remove_lord_from_game", ":troop_no"),
           (else_try),
             (store_random_in_range, ":random_no", 0, 100),
             (lt, ":random_no", 15),
             (call_script, "script_cf_get_random_active_faction_except_player_faction_and_faction", ":cur_faction"),
             (troop_set_slot, ":troop_no", slot_troop_change_to_faction, reg0),
           (try_end),
         (try_end),
       (try_end),
    ]),


  # Spawn village farmer parties
  (0.035,
   [
(val_clamp, "$async_simple_trigger17", villages_begin, villages_end),
(val_add, "$async_simple_trigger17", 1),
	(try_begin),	
	(ge, "$async_simple_trigger17", villages_end),
	(assign, "$async_simple_trigger17", villages_begin),
	(try_end),
		(try_begin),
       (assign, ":village_no", "$async_simple_trigger17"),
         (party_slot_eq, ":village_no", slot_village_state, svs_normal),
         (party_get_slot, ":farmer_party", ":village_no", slot_village_farmer_party),
         (this_or_next|eq, ":farmer_party", 0),
         (neg|party_is_active, ":farmer_party"),
         (store_random_in_range, ":random_no", 0, 100),
         (lt, ":random_no", 5),
         (call_script, "script_create_village_farmer_party", ":village_no"),
         (party_set_slot, ":village_no", slot_village_farmer_party, reg0),
#         (str_store_party_name, s1, ":village_no"),
#         (display_message, "@Village farmers created at {s1}."),
       (try_end),
    ]),

  
   (0.1,
   [
 # Updating player odds
(val_clamp, "$async_simple_trigger18", centers_begin, centers_end),
(val_add, "$async_simple_trigger18", 1),
	(try_begin),	
	(ge, "$async_simple_trigger18", centers_end),
	(assign, "$async_simple_trigger18", centers_begin),
	(try_end),
		(try_begin),
       (assign, ":cur_center", "$async_simple_trigger18"),
         (party_get_slot, ":player_odds", ":cur_center", slot_town_player_odds),
         (try_begin),
           (gt, ":player_odds", 1000),
           (val_mul, ":player_odds", 95),
           (val_div, ":player_odds", 100),
           (val_max, ":player_odds", 1000),
         (else_try),
           (lt, ":player_odds", 1000),
           (val_mul, ":player_odds", 105),
           (val_div, ":player_odds", 100),
           (val_min, ":player_odds", 1000),
         (try_end),
         (party_set_slot, ":cur_center", slot_town_player_odds, ":player_odds"),
       (try_end),
    ]),

  
   (50,
   [
  # Updating trade good prices according to the productions
       (call_script, "script_update_trade_good_prices"),
    ]),


  #Troop AI: Merchants thinking
  (8,
   [
       (try_for_parties, ":party_no"),
         (party_slot_eq, ":party_no", slot_party_type, spt_kingdom_caravan),
         (party_is_in_any_town, ":party_no"),

         (store_faction_of_party, ":merchant_faction", ":party_no"),
         (faction_get_slot, ":num_towns", ":merchant_faction", slot_faction_num_towns),
         (try_begin),
           (le, ":num_towns", 0),
           (remove_party, ":party_no"),
         (else_try),
           (party_get_cur_town, ":cur_center", ":party_no"),
           
           (store_random_in_range, ":random_no", 0, 100),                               
           
           (try_begin),
             (party_slot_eq, ":cur_center", slot_town_lord, "trp_player"),
             
             (game_get_reduce_campaign_ai, ":reduce_campaign_ai"),
             (try_begin),
               (eq, ":reduce_campaign_ai", 0), #hard (less money from tariffs)
               (assign, ":tariff_succeed_limit", 35),
             (else_try),
               (eq, ":reduce_campaign_ai", 1), #medium (normal money from tariffs)
               (assign, ":tariff_succeed_limit", 45),
             (else_try),
               (eq, ":reduce_campaign_ai", 2), #easy (more money from tariffs)
               (assign, ":tariff_succeed_limit", 60),
             (try_end),                
           (else_try),  
             (assign, ":tariff_succeed_limit", 45),
           (try_end),
                      
           (lt, ":random_no", ":tariff_succeed_limit"),                  

           (assign, ":can_leave", 1),
           (try_begin),
             (is_between, ":cur_center", walled_centers_begin, walled_centers_end),
             (neg|party_slot_eq, ":cur_center", slot_center_is_besieged_by, -1),
             (assign, ":can_leave", 0),
           (try_end),
           (eq, ":can_leave", 1),

           (assign, ":do_trade", 0),
           (try_begin),
             (party_get_slot, ":cur_ai_state", ":party_no", slot_party_ai_state),
             (eq, ":cur_ai_state", spai_trading_with_town),
             (party_get_slot, ":cur_ai_object", ":party_no", slot_party_ai_object),
             (eq, ":cur_center", ":cur_ai_object"),
             (assign, ":do_trade", 1),
           (try_end),

           (assign, ":target_center", -1),
           
           (try_begin), #Make sure escorted caravan continues to its original destination.
             (eq, "$caravan_escort_party_id", ":party_no"),
             (neg|party_is_in_town, ":party_no", "$caravan_escort_destination_town"),
             (assign, ":target_center", "$caravan_escort_destination_town"),
           (else_try),         
             (call_script, "script_cf_select_most_profitable_town_at_peace_with_faction_in_trade_route", ":cur_center", ":merchant_faction"),
             (assign, ":target_center", reg0),
           (try_end),
           (is_between, ":target_center", towns_begin, towns_end),
           (neg|party_is_in_town, ":party_no", ":target_center"),
       
           (try_begin),
             (eq, ":do_trade", 1),
             (str_store_party_name, s7, ":cur_center"),             
             (call_script, "script_do_merchant_town_trade", ":party_no", ":cur_center"),
           (try_end),
           (party_set_ai_behavior, ":party_no", ai_bhvr_travel_to_party),
           (party_set_ai_object, ":party_no", ":target_center"),
           (party_set_flags, ":party_no", pf_default_behavior, 0),
           (party_set_slot, ":party_no", slot_party_ai_state, spai_trading_with_town),
           (party_set_slot, ":party_no", slot_party_ai_object, ":target_center"),
         (try_end),
       (try_end),
    ]),

  #Troop AI: Village farmers thinking
  (8,
   [
       (try_for_parties, ":party_no"),
         (party_slot_eq, ":party_no", slot_party_type, spt_village_farmer),
         (party_is_in_any_town, ":party_no"),
         (party_get_slot, ":home_center", ":party_no", slot_party_home_center),
         (party_get_cur_town, ":cur_center", ":party_no"),

         (assign, ":can_leave", 1),
         (try_begin),
           (is_between, ":cur_center", walled_centers_begin, walled_centers_end),
           (neg|party_slot_eq, ":cur_center", slot_center_is_besieged_by, -1),
           (assign, ":can_leave", 0),
         (try_end),
         (eq, ":can_leave", 1),

         (try_begin),
           (eq, ":cur_center", ":home_center"),
		   
		   #Peasants trade in their home center
		   (call_script, "script_do_party_center_trade", ":party_no", ":home_center", 3), #this needs to be the same as the center		   
		   (store_faction_of_party, ":center_faction", ":cur_center"),
           (party_set_faction, ":party_no", ":center_faction"),           		   
           (party_get_slot, ":market_town", ":home_center", slot_village_market_town),
           (party_set_slot, ":party_no", slot_party_ai_object, ":market_town"),
           (party_set_slot, ":party_no", slot_party_ai_state, spai_trading_with_town),
           (party_set_ai_behavior, ":party_no", ai_bhvr_travel_to_party),
           (party_set_ai_object, ":party_no", ":market_town"),
         (else_try),
           (try_begin),
             (party_get_slot, ":cur_ai_object", ":party_no", slot_party_ai_object),
             (eq, ":cur_center", ":cur_ai_object"),

             (call_script, "script_do_party_center_trade", ":party_no", ":cur_ai_object", 3), #raised from 10
             (assign, ":total_change", reg0),
		     #This is roughly 50% of what a caravan would pay
			 
             #Adding tariffs to the town
             (party_get_slot, ":accumulated_tariffs", ":cur_ai_object", slot_center_accumulated_tariffs),
             (party_get_slot, ":prosperity", ":cur_ai_object", slot_town_prosperity),
			 
			 (assign, ":tariffs_generated", ":total_change"),
			 (val_mul, ":tariffs_generated", ":prosperity"),
			 (val_div, ":tariffs_generated", 100),
			 (val_div, ":tariffs_generated", 20), #10 for caravans, 20 for villages
			 (val_add, ":accumulated_tariffs", ":tariffs_generated"),
	  
			 (try_begin),
				(ge, "$cheat_mode", 3),
				(assign, reg4, ":tariffs_generated"),
				(str_store_party_name, s4, ":cur_ai_object"),
				(assign, reg5, ":accumulated_tariffs"),
				(display_message, "@{!}New tariffs at {s4} = {reg4}, total = {reg5}"),
			 (try_end),
			 
             (party_set_slot, ":cur_ai_object", slot_center_accumulated_tariffs, ":accumulated_tariffs"),
			 
             #Increasing food stocks of the town
             (party_get_slot, ":town_food_store", ":cur_ai_object", slot_party_food_store),
             (call_script, "script_center_get_food_store_limit", ":cur_ai_object"),
             (assign, ":food_store_limit", reg0),
             (val_add, ":town_food_store", 1000),
             (val_min, ":town_food_store", ":food_store_limit"),
             (party_set_slot, ":cur_ai_object", slot_party_food_store, ":town_food_store"),

             #Adding 1 to village prosperity
             (try_begin),
               (store_random_in_range, ":rand", 0, 100),
               (lt, ":rand", 50), #was 35
               (call_script, "script_change_center_prosperity", ":home_center", 1),
			   (val_add, "$newglob_total_prosperity_from_village_trade", 1),
             (try_end),
           (try_end),

           #Moving farmers to their home village
           (party_set_slot, ":party_no", slot_party_ai_object, ":home_center"),
           (party_set_slot, ":party_no", slot_party_ai_state, spai_trading_with_town),
           (party_set_ai_behavior, ":party_no", ai_bhvr_travel_to_party),
           (party_set_ai_object, ":party_no", ":home_center"),
         (try_end),
       (try_end),
    ]),

 #Increase castle food stores
  (0.001,
   [
(val_clamp, "$async_simple_trigger19", castles_begin, castles_end),
(val_add, "$async_simple_trigger19", 1),
	(try_begin),	
	(ge, "$async_simple_trigger19", castles_end),
	(assign, "$async_simple_trigger19", castles_begin),
	(try_end),
		(try_begin),
       (assign, ":center_no", "$async_simple_trigger19"),
         (party_slot_eq, ":center_no", slot_center_is_besieged_by, -1), #castle is not under siege
         (party_get_slot, ":center_food_store", ":center_no", slot_party_food_store),
         (val_add, ":center_food_store", 100),
         (call_script, "script_center_get_food_store_limit", ":center_no"),
         (assign, ":food_store_limit", reg0),
         (val_min, ":center_food_store", ":food_store_limit"),
         (party_set_slot, ":center_no", slot_party_food_store, ":center_food_store"),
       (try_end),
    ]),


  # Make heroes running away from someone retreat to friendly centers
  (0.001,
   [
(val_clamp, "$async_simple_trigger30", heroes_begin, heroes_end),
(val_add, "$async_simple_trigger30", 1),
	(try_begin),	
	(ge, "$async_simple_trigger30", heroes_end),
	(assign, "$async_simple_trigger30", heroes_begin),
	(try_end),
		(try_begin),
       (assign, ":cur_troop", "$async_simple_trigger30"),
         (troop_slot_eq, ":cur_troop", slot_troop_occupation, slto_kingdom_hero),
         (troop_get_slot, ":cur_party", ":cur_troop", slot_troop_leaded_party),
         (gt, ":cur_party", 0),
         (try_begin),
           (party_is_active, ":cur_party"),
           (try_begin),
             (get_party_ai_current_behavior, ":ai_bhvr", ":cur_party"),
             (eq, ":ai_bhvr", ai_bhvr_avoid_party),
			 
			 #Certain lord personalities will not abandon a battlefield to flee to a fortress
			 (assign, ":continue", 1),
			 (try_begin),
				(this_or_next|troop_slot_eq, ":cur_troop", slot_lord_reputation_type, lrep_upstanding),
					(troop_slot_eq, ":cur_troop", slot_lord_reputation_type, lrep_martial),
				(get_party_ai_current_object, ":ai_object", ":cur_party"),
				(party_is_active, ":ai_object"),
				(party_get_battle_opponent, ":battle_opponent", ":ai_object"),
				(party_is_active, ":battle_opponent"),
				(assign, ":continue", 0),
			 (try_end),
			 (eq, ":continue", 1),
			 
			 
             (store_faction_of_party, ":party_faction", ":cur_party"),
             (party_get_slot, ":commander_party", ":cur_party", slot_party_commander_party),
             (faction_get_slot, ":faction_marshall", ":party_faction", slot_faction_marshall),
             (neq, ":faction_marshall", ":cur_troop"),
             (assign, ":continue", 1),
             (try_begin),
               (ge, ":faction_marshall", 0),
               (troop_get_slot, ":faction_marshall_party", ":faction_marshall", slot_troop_leaded_party),
               (party_is_active, ":faction_marshall_party", 0),
               (eq, ":commander_party", ":faction_marshall_party"),
               (assign, ":continue", 0),
             (try_end),
             (eq, ":continue", 1),
             (assign, ":done", 0),
             (try_for_range, ":cur_center", walled_centers_begin, walled_centers_end),
               (eq, ":done", 0),
               (party_slot_eq, ":cur_center", slot_center_is_besieged_by, -1),
               (store_faction_of_party, ":center_faction", ":cur_center"),
               (store_relation, ":cur_relation", ":center_faction", ":party_faction"),
               (gt, ":cur_relation", 0),
			 (party_is_active, ":cur_party"),
			 (party_is_active, ":cur_center"),
               (store_distance_to_party_from_party, ":cur_distance", ":cur_party", ":cur_center"),
               (lt, ":cur_distance", 20),
               (party_get_position, pos1, ":cur_party"),
               (party_get_position, pos2, ":cur_center"),
               (neg|position_is_behind_position, pos2, pos1),
               (call_script, "script_party_set_ai_state", ":cur_party", spai_retreating_to_center, ":cur_center"),
               (assign, ":done", 1),
             (try_end),
           (try_end),
         (else_try),
           (troop_set_slot, ":cur_troop", slot_troop_leaded_party, -1),
         (try_end),
       (try_end),
    ]),

  # Centers give alarm if the player is around
  (0.5,
   [
     # (store_current_hours, ":cur_hours"),
     # (store_mod, ":cur_hours_mod", ":cur_hours", 11),
     # (store_sub, ":hour_limit", ":cur_hours", 5),
     # (party_get_num_companions, ":num_men", "p_main_party"),
     # (party_get_num_prisoners, ":num_prisoners", "p_main_party"),
     # (val_add, ":num_men", ":num_prisoners"),
     # (convert_to_fixed_point, ":num_men"),
     # (store_sqrt, ":num_men_effect", ":num_men"),
     # (convert_from_fixed_point, ":num_men_effect"),
     # (try_begin),
       # (eq, ":cur_hours_mod", 0),
       # #Reduce alarm by 2 in every 11 hours.
       # (try_for_range, ":cur_faction", kingdoms_begin, kingdoms_end),
         # (faction_get_slot, ":player_alarm", ":cur_faction", slot_faction_player_alarm),
         # (val_sub, ":player_alarm", 1),
         # (val_max, ":player_alarm", 0),
         # (faction_set_slot, ":cur_faction", slot_faction_player_alarm, ":player_alarm"),
       # (try_end),
     # (try_end),
     # (eq, "$g_player_is_captive", 0),
     # (try_for_range, ":cur_center", centers_begin, centers_end),
       # (store_faction_of_party, ":cur_faction", ":cur_center"),
       # (store_relation, ":reln", ":cur_faction", "fac_player_supporters_faction"),
       # (lt, ":reln", 0),
       # (store_distance_to_party_from_party, ":dist", "p_main_party", ":cur_center"),
       # (lt, ":dist", 5),
       # (store_mul, ":dist_sqr", ":dist", ":dist"),
       # (store_sub, ":dist_effect", 20, ":dist_sqr"),
       # (store_sub, ":reln_effect", 20, ":reln"),
       # (store_mul, ":total_effect", ":dist_effect", ":reln_effect"),
       # (val_mul, ":total_effect", ":num_men_effect"),
       # (store_div, ":spot_chance", ":total_effect", 10),
       # (store_random_in_range, ":random_spot", 0, 1000),
       # (lt, ":random_spot", ":spot_chance"),
       # (faction_get_slot, ":player_alarm", ":cur_faction", slot_faction_player_alarm),
       # (val_add, ":player_alarm", 1),
       # (val_min, ":player_alarm", 100),
       # (faction_set_slot, ":cur_faction", slot_faction_player_alarm, ":player_alarm"),
       # (try_begin),
         # (neg|party_slot_ge, ":cur_center", slot_center_last_player_alarm_hour, ":hour_limit"),
         # (str_store_party_name_link, s1, ":cur_center"),
         # (display_message, "@Your party is spotted by {s1}."),
         # (party_set_slot, ":cur_center", slot_center_last_player_alarm_hour, ":cur_hours"),
       # (try_end),
     # (try_end),
    ]),
  
  # Consuming food at every 14 hours
  (17,
   [
    (eq, "$g_player_is_captive", 0),
    (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
    (assign, ":num_men", 0),
    (try_for_range, ":i_stack", 0, ":num_stacks"),
      (party_stack_get_size, ":stack_size","p_main_party",":i_stack"),
      (val_add, ":num_men", ":stack_size"),
    (try_end),
    (val_div, ":num_men", 3),
    (try_begin),
      (eq, ":num_men", 0),
      (val_add, ":num_men", 1),
    (try_end),
    
    (try_begin),
      (assign, ":number_of_foods_player_has", 0),
      (try_for_range, ":cur_edible", food_begin, food_end),      
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_edible", imod_rotten),
        (val_add, ":number_of_foods_player_has", 1),
      (try_end),
      (try_begin),
        (ge, ":number_of_foods_player_has", 6),
        (unlock_achievement, ACHIEVEMENT_ABUNDANT_FEAST),        
      (try_end),
    (try_end),
    
    (assign, ":consumption_amount", ":num_men"),
    (assign, ":no_food_displayed", 0),
    (try_for_range, ":unused", 0, ":consumption_amount"),
      (assign, ":available_food", 0),
      (try_for_range, ":cur_food", food_begin, food_end),
        (item_set_slot, ":cur_food", slot_item_is_checked, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":cur_food", imod_rotten),
        (val_add, ":available_food", 1),
      (try_end),
      (try_begin),
        (gt, ":available_food", 0),
        (store_random_in_range, ":selected_food", 0, ":available_food"),
        (call_script, "script_consume_food", ":selected_food"),
      (else_try),
        (eq, ":no_food_displayed", 0),
        (display_message, "@Party has nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -3),
        (assign, ":no_food_displayed", 1),
#NPC companion changes begin
        (try_begin),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (gt, reg0, 0),
            (call_script, "script_objectionable_action", tmt_egalitarian, "str_men_hungry"),
        (try_end),
#NPC companion changes end
      (try_end),
    (try_end),
    ]),

  # Setting item modifiers for food
  (24,
   [
     (troop_get_inventory_capacity, ":inv_size", "trp_player"),
     (try_for_range, ":i_slot", 0, ":inv_size"),
       (troop_get_inventory_slot, ":item_id", "trp_player", ":i_slot"),
       (this_or_next|eq, ":item_id", "itm_cattle_meat"),
       (this_or_next|eq, ":item_id", "itm_chicken"),
		(eq, ":item_id", "itm_pork"),
		
       (troop_get_inventory_slot_modifier, ":modifier", "trp_player", ":i_slot"),
       (try_begin),
         (ge, ":modifier", imod_fresh),
         (lt, ":modifier", imod_rotten),
         (val_add, ":modifier", 1),
         (troop_set_inventory_slot_modifier, "trp_player", ":i_slot", ":modifier"),
       (else_try),
         (lt, ":modifier", imod_fresh),
         (troop_set_inventory_slot_modifier, "trp_player", ":i_slot", imod_fresh),
       (try_end),
     (try_end),
    ]),

  # Assigning lords to centers with no leaders
  (72,
   [
   #(call_script, "script_assign_lords_to_empty_centers"),
    ]),
  
  # Updating player icon in every frame
  (0,
   [(troop_get_inventory_slot, ":cur_horse", "trp_player", 8), #horse slot
    (assign, ":new_icon", -1),
    (try_begin),
      (eq, "$g_player_icon_state", pis_normal),
      (try_begin),
        (ge, ":cur_horse", 0),
        (assign, ":new_icon", "icon_player_horseman"),
      (else_try),
        (assign, ":new_icon", "icon_player"),
      (try_end),
    (else_try),
      (eq, "$g_player_icon_state", pis_camping),
      (assign, ":new_icon", "icon_camp"),
    (else_try),
      (eq, "$g_player_icon_state", pis_ship),
      (assign, ":new_icon", "icon_ship"),
    (try_end),
    (neq, ":new_icon", "$g_player_party_icon"),
    (assign, "$g_player_party_icon", ":new_icon"),
    (party_set_icon, "p_main_party", ":new_icon"),
    ]),
  
 #Update how good a target player is for bandits
  (2,
   [
       (store_troop_gold, ":total_value", "trp_player"),
       (store_div, ":bandit_attraction", ":total_value", (10000/100)), #10000 gold = excellent_target

       (troop_get_inventory_capacity, ":inv_size", "trp_player"),
       (try_for_range, ":i_slot", 0, ":inv_size"),
         (troop_get_inventory_slot, ":item_id", "trp_player", ":i_slot"),
         (ge, ":item_id", 0),
         (try_begin),
           (is_between, ":item_id", trade_goods_begin, trade_goods_end),
           (store_item_value, ":item_value", ":item_id"),
           (val_add, ":total_value", ":item_value"),
         (try_end),
       (try_end),
       (val_clamp, ":bandit_attraction", 0, 100),
       (party_set_bandit_attraction, "p_main_party", ":bandit_attraction"),
    ]),


	#This is a backup script to activate the player faction if it doesn't happen automatically, for whatever reason
  (6,
	[
(faction_slot_eq, "fac_player_supporters_faction", slot_faction_state, sfs_inactive),
	(try_for_range, ":center", walled_centers_begin, walled_centers_end),
		(store_faction_of_party, ":center_faction", ":center"),
		(eq, ":center_faction", "fac_player_supporters_faction"),
		(call_script, "script_activate_player_faction", "trp_player"),
	(try_end),
	]),
	
  # Checking escape chances of prisoners that joined the party recently.
  (6,
   [(gt, "$g_prisoner_recruit_troop_id", 0),
    (gt, "$g_prisoner_recruit_size", 0),
    (gt, "$g_prisoner_recruit_last_time", 0),
    (is_currently_night),
    (try_begin),
      (store_skill_level, ":leadership", "skl_leadership", "trp_player"),
      (val_mul, ":leadership", 5),
      (store_sub, ":chance", 66, ":leadership"),
      (gt, ":chance", 0),
      (assign, ":num_escaped", 0),
      (try_for_range, ":unused", 0, "$g_prisoner_recruit_size"),
        (store_random_in_range, ":random_no", 0, 100),
        (lt, ":random_no", ":chance"),
        (val_add, ":num_escaped", 1),
      (try_end),
      (party_remove_members, "p_main_party", "$g_prisoner_recruit_troop_id", ":num_escaped"),
      (assign, ":num_escaped", reg0),
      (gt, ":num_escaped", 0),
      (try_begin),
        (gt, ":num_escaped", 1),
        (assign, reg2, 1),
      (else_try),
        (assign, reg2, 0),
      (try_end),
      (assign, reg1, ":num_escaped"),
      (str_store_troop_name_by_count, s1, "$g_prisoner_recruit_troop_id", ":num_escaped"),
      (display_log_message, "@{reg1} {s1} {reg2?have:has} escaped from your party during the night."),
    (try_end),
    (assign, "$g_prisoner_recruit_troop_id", 0),
    (assign, "$g_prisoner_recruit_size", 0),
    ]),

  # Offering ransom fees for player's prisoner heroes
  (24,
   [(neq, "$g_ransom_offer_rejected", 1),
    (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", "p_main_party"),
    (eq, reg0, 0),#no prisoners offered
    (assign, ":end_cond", walled_centers_end),
    (try_for_range, ":center_no", walled_centers_begin, ":end_cond"),
      (party_slot_eq, ":center_no", slot_town_lord, "trp_player"),
      (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", ":center_no"),
      (eq, reg0, 1),#a prisoner is offered
      (assign, ":end_cond", 0),#break
    (try_end),
    ]), 

  # Exchanging hero prisoners between factions and clearing old ransom offers
  (72,
   [(assign, "$g_ransom_offer_rejected", 0),
    (try_for_range, ":center_no", walled_centers_begin, walled_centers_end),
      (party_get_slot, ":town_lord", ":center_no", slot_town_lord),
      (gt, ":town_lord", 0),
      (party_get_num_prisoner_stacks, ":num_stacks", ":center_no"),
      (try_for_range_backwards, ":i_stack", 0, ":num_stacks"),
        (party_prisoner_stack_get_troop_id, ":stack_troop", ":center_no", ":i_stack"),
        (troop_is_hero, ":stack_troop"),
        (troop_slot_eq, ":stack_troop", slot_troop_occupation, slto_kingdom_hero),
        (store_random_in_range, ":random_no", 0, 100),
        (try_begin),
          (le, ":random_no", 10),
          (call_script, "script_calculate_ransom_amount_for_troop", ":stack_troop"),
          (assign, ":ransom_amount", reg0),
          (troop_get_slot, ":wealth", ":town_lord", slot_troop_wealth),
          (val_add, ":wealth", ":ransom_amount"),
          (troop_set_slot, ":town_lord", slot_troop_wealth, ":wealth"),
          (party_remove_prisoners, ":center_no", ":stack_troop", 1),
          (call_script, "script_remove_troop_from_prison", ":stack_troop"),
          (store_troop_faction, ":faction_no", ":town_lord"),
          (store_troop_faction, ":troop_faction", ":stack_troop"),
          (str_store_troop_name, s1, ":stack_troop"),
          (str_store_faction_name, s2, ":faction_no"),
          (str_store_faction_name, s3, ":troop_faction"),
          (display_log_message, "@{s1} of {s3} has been released from captivity."),
        (try_end),
      (try_end),
    (try_end),
    ]),
  
  # Adding mercenary troops to the towns
  (72,
   [
     (call_script, "script_update_mercenary_units_of_towns"),
     #NPC changes begin
     # removes   (call_script, "script_update_companion_candidates_in_taverns"),
     #NPC changes end
     (call_script, "script_update_ransom_brokers"),
     (call_script, "script_update_tavern_travellers"),
     (call_script, "script_update_tavern_minstrels"),
     (call_script, "script_update_booksellers"),
     (call_script, "script_update_villages_infested_by_bandits"),
     (try_for_range, ":village_no", villages_begin, villages_end),
       (call_script, "script_update_volunteer_troops_in_village", ":village_no"),
       (call_script, "script_update_npc_volunteer_troops_in_village", ":village_no"),
     (try_end),
    ]),

  (24,
   [	
    (call_script, "script_update_other_taverngoers"),
	]),
	
  # Setting random walker types
  (0.1,
   [
(val_clamp, "$async_simple_trigger20", centers_begin, centers_end),
(val_add, "$async_simple_trigger20", 1),
	(try_begin),	
	(ge, "$async_simple_trigger20", centers_end),
	(assign, "$async_simple_trigger20", centers_begin),
	(try_end),
		(try_begin),
		(assign, ":center_no", "$async_simple_trigger20"),
      (this_or_next|party_slot_eq, ":center_no", slot_party_type, spt_town),
      (             party_slot_eq, ":center_no", slot_party_type, spt_village),
      (call_script, "script_center_remove_walker_type_from_walkers", ":center_no", walkert_needs_money),
      (call_script, "script_center_remove_walker_type_from_walkers", ":center_no", walkert_needs_money_helped),
      (store_random_in_range, ":rand", 0, 100),
      (try_begin),
        (lt, ":rand", 70),
        (neg|party_slot_ge, ":center_no", slot_town_prosperity, 60),
        (call_script, "script_cf_center_get_free_walker", ":center_no"),
        (call_script, "script_center_set_walker_to_type", ":center_no", reg0, walkert_needs_money),
      (try_end),
    (try_end),
    ]),

  # Checking center upgrades
  (0.01,
   [
(val_clamp, "$async_simple_trigger21", centers_begin, centers_end),
(val_add, "$async_simple_trigger21", 1),
	(try_begin),	
	(ge, "$async_simple_trigger21", centers_end),
	(assign, "$async_simple_trigger21", centers_begin),
	(try_end),
		(try_begin),
   (assign, ":center_no", "$async_simple_trigger21"),
      (party_get_slot, ":cur_improvement", ":center_no", slot_center_current_improvement),
      (gt, ":cur_improvement", 0),
      (party_get_slot, ":cur_improvement_end_time", ":center_no", slot_center_improvement_end_hour),
      (store_current_hours, ":cur_hours"),
      (ge, ":cur_hours", ":cur_improvement_end_time"),
      (party_set_slot, ":center_no", ":cur_improvement", 1),
      (party_set_slot, ":center_no", slot_center_current_improvement, 0),
      (call_script, "script_get_improvement_details", ":cur_improvement"),
      (try_begin),
        (party_slot_eq, ":center_no", slot_town_lord, "trp_player"),
        (str_store_party_name, s4, ":center_no"),
        (display_log_message, "@Building of {s0} in {s4} has been completed."),
      (try_end),
      (try_begin),
        (is_between, ":center_no", villages_begin, villages_end),
        (eq, ":cur_improvement", slot_center_has_fish_pond),
        (call_script, "script_change_center_prosperity", ":center_no", 5),
      (try_end),
    (try_end),
    ]),

  # Adding tournaments to towns
  # Adding bandits to towns and villages
  (24,
   [
    (try_for_range, ":center_no", centers_begin, centers_end),
      (this_or_next|party_slot_eq, ":center_no", slot_party_type, spt_town),
      (party_slot_eq, ":center_no", slot_party_type, spt_village),
      (party_get_slot, ":has_bandits", ":center_no", slot_center_has_bandits),
      (try_begin),
        (le, ":has_bandits", 0),
        (assign, ":continue", 0),
        (try_begin),
          (check_quest_active, "qst_deal_with_night_bandits"),
          (quest_slot_eq, "qst_deal_with_night_bandits", slot_quest_target_center, ":center_no"),
          (neg|check_quest_succeeded, "qst_deal_with_night_bandits"),
          (assign, ":continue", 1),
        (else_try),
          (store_random_in_range, ":random_no", 0, 100),
          (lt, ":random_no", 3),
          (assign, ":continue", 1),
        (try_end),
        (try_begin),
          (eq, ":continue", 1),
          (store_random_in_range, ":random_no", 0, 3),
          (try_begin),
            (eq, ":random_no", 0),
            (assign, ":bandit_troop", "trp_bandit"),
          (else_try),
            (eq, ":random_no", 1),
            (assign, ":bandit_troop", "trp_mountain_bandit"),
          (else_try),
            (assign, ":bandit_troop", "trp_forest_bandit"),
          (try_end),
          (party_set_slot, ":center_no", slot_center_has_bandits, ":bandit_troop"),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (str_store_party_name, s1, ":center_no"),
            (display_message, "@{!}{s1} is infested by bandits (at night)."),
          (try_end),
        (try_end),
      (else_try),
        (try_begin),
          (assign, ":random_chance", 40),
          (try_begin),
            (party_slot_eq, ":center_no", slot_party_type, spt_town),
            (assign, ":random_chance", 20),
          (try_end),
          (store_random_in_range, ":random_no", 0, 100),
          (lt, ":random_no", ":random_chance"),
          (party_set_slot, ":center_no", slot_center_has_bandits, 0),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (str_store_party_name, s1, ":center_no"),
            (display_message, "@{s1} is no longer infested by bandits (at night)."),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    ]),

  (3,
[
	(assign, "$g_player_tournament_placement", 0),
]),  


#(0.1,

#	[
#	(try_begin),
#		(troop_slot_ge, "trp_player", slot_troop_spouse, active_npcs_begin),
#		(troop_get_slot, ":spouse", "trp_player", slot_troop_spouse),
#		(store_faction_of_troop, ":spouse_faction", ":spouse"),
#		(neq, ":spouse_faction", "$players_kingdom"),
#		(display_message, "@{!}ERROR! Player and spouse are separate factions"),
#	(try_end),
#	]
#),
	
  # Asking to give center to player
  (8,
   [
#    (assign, ":done", 0),
#    (try_for_range, ":center_no", centers_begin, centers_end),
#      (eq, ":done", 0),
#      (party_slot_eq, ":center_no", slot_town_lord, stl_reserved_for_player),
#      (assign, "$g_center_to_give_to_player", ":center_no"),
 #     (try_begin),
  #      (eq, "$g_center_to_give_to_player", "$g_castle_requested_by_player"),
   #     (assign, "$g_castle_requested_by_player", 0),
	#	(try_begin),
	#		(eq, "$g_castle_requested_for_troop", "trp_player"),
	#		(jump_to_menu, "mnu_requested_castle_granted_to_player"),
	#	(else_try),
	#		(jump_to_menu, "mnu_requested_castle_granted_to_player_husband"),
	#	(try_end),	
    #  (else_try),
    #    (jump_to_menu, "mnu_give_center_to_player"),
    # (try_end),
    #  (assign, ":done", 1),
    #(else_try),
    #  (eq, ":center_no", "$g_castle_requested_by_player"),
    #  (party_slot_ge, ":center_no", slot_town_lord, active_npcs_begin),
    #  (assign, "$g_castle_requested_by_player", 0),
    #  (store_faction_of_party, ":faction", ":center_no"),
    #  (eq, ":faction", "$players_kingdom"),
    #  (assign, "$g_center_to_give_to_player", ":center_no"),
	#  (try_begin),
#		(eq, "$player_has_homage", 1),
#		(jump_to_menu, "mnu_requested_castle_granted_to_another"),
#	  (else_try),	
#		(jump_to_menu, "mnu_requested_castle_granted_to_another_female"),
#	  (try_end),	
 #     (assign, ":done", 1),
  #  (try_end),
    ]),
  
  # Taking pounds from player while resting in not owned centers
  (1,
   [(neg|map_free),
    (is_currently_night),
#    (ge, "$g_last_rest_center", 0),
    (is_between, "$g_last_rest_center", centers_begin, centers_end),
    (neg|party_slot_eq, "$g_last_rest_center", slot_town_lord, "trp_player"),
    (store_faction_of_party, ":last_rest_center_faction", "$g_last_rest_center"),
    (neq, ":last_rest_center_faction", "fac_player_supporters_faction"),
    (store_current_hours, ":cur_hours"),
    (ge, ":cur_hours", "$g_last_rest_payment_until"),
    (store_add, "$g_last_rest_payment_until", ":cur_hours", 24),
    (store_troop_gold, ":gold", "trp_player"),
    (party_get_num_companions, ":num_men", "p_main_party"),
    (store_div, ":total_cost", ":num_men", 4),
    (val_add, ":total_cost", 1),
    (try_begin),
      (ge, ":gold", ":total_cost"),
      (display_message, "@You pay for accommodation."),
      (troop_remove_gold, "trp_player", ":total_cost"),
    (else_try),
      (gt, ":gold", 0),
      (troop_remove_gold, "trp_player", ":gold"),
    (try_end),
    ]),
    
  # Spawn some bandits.
  (8,
   [
       (call_script, "script_spawn_bandits"),
    ]),

  # Make parties larger as game progresses.
  (24,
   [
       (call_script, "script_update_party_creation_random_limits"),
    ]),
  
  # Check if a faction is defeated every day
  (24,
   [
    (assign, ":num_active_factions", 0),
    (try_for_range, ":cur_kingdom", kingdoms_begin, kingdoms_end),
      (faction_set_slot, ":cur_kingdom", slot_faction_number_of_parties, 0),
    (try_end),
    (try_for_parties, ":cur_party"),
      (store_faction_of_party, ":party_faction", ":cur_party"),
      (is_between, ":party_faction", kingdoms_begin, kingdoms_end),
      (this_or_next|is_between, ":cur_party", centers_begin, centers_end),
	  (party_slot_eq, ":cur_party", slot_party_type, spt_kingdom_hero_party),
      (faction_get_slot, ":kingdom_num_parties", ":party_faction", slot_faction_number_of_parties),
      (val_add, ":kingdom_num_parties", 1),
      (faction_set_slot, ":party_faction", slot_faction_number_of_parties, ":kingdom_num_parties"), 
    (try_end),
    (try_for_range, ":cur_kingdom", kingdoms_begin, kingdoms_end),
      #(try_begin),
        #(eq, "$cheat_mode", 1),
        #(str_store_faction_name, s1, ":cur_kingdom"),
        #(faction_get_slot, reg1, ":cur_kingdom", slot_faction_number_of_parties),        
        #(display_message, "@{!}Number of parties belonging to {s1}: {reg1}"),
      #(try_end),
      (faction_slot_eq, ":cur_kingdom", slot_faction_state, sfs_active),
      (val_add, ":num_active_factions", 1),
      (faction_slot_eq, ":cur_kingdom", slot_faction_number_of_parties, 0),
      (assign, ":faction_removed", 0),
      (try_begin),
        (eq, ":cur_kingdom", "fac_player_supporters_faction"),
        (try_begin),
          (le, "$supported_pretender", 0),
          (faction_set_slot, ":cur_kingdom", slot_faction_state, sfs_inactive),
          (assign, ":faction_removed", 1),
        (try_end),
      (else_try),
        (neq, "$players_kingdom", ":cur_kingdom"),
        (faction_set_slot, ":cur_kingdom", slot_faction_state, sfs_defeated),
        (try_for_parties, ":cur_party"),
          (store_faction_of_party, ":party_faction", ":cur_party"),
          (eq, ":party_faction", ":cur_kingdom"),
          (party_get_slot, ":home_center", ":cur_party", slot_party_home_center),
          (store_faction_of_party, ":home_center_faction", ":home_center"),
          (party_set_faction, ":cur_party", ":home_center_faction"),
        (try_end),
        (assign, ":kingdom_pretender", -1),
        (try_for_range, ":cur_pretender", pretenders_begin, pretenders_end),
          (troop_slot_eq, ":cur_pretender", slot_troop_original_faction, ":cur_kingdom"),
          (assign, ":kingdom_pretender", ":cur_pretender"),
        (try_end),
        (try_begin),
          (is_between, ":kingdom_pretender", pretenders_begin, pretenders_end),
          (neq, ":kingdom_pretender", "$supported_pretender"),
          (troop_set_slot, ":kingdom_pretender", slot_troop_cur_center, 0), #remove pretender from the world
        (try_end),
        (assign, ":faction_removed", 1),
        (try_begin),
          (eq, "$players_oath_renounced_against_kingdom", ":cur_kingdom"),
          (assign, "$players_oath_renounced_against_kingdom", 0),
          (assign, "$players_oath_renounced_given_center", 0),
          (assign, "$players_oath_renounced_begin_time", 0),
          (call_script, "script_add_notification_menu", "mnu_notification_oath_renounced_faction_defeated", ":cur_kingdom", 0),
        (try_end),
        #This menu must be at the end because faction banner will change after this menu if the player's supported pretender's original faction is cur_kingdom
       # (call_script, "script_add_notification_menu", "mnu_notification_faction_defeated", ":cur_kingdom", 0),
      (try_end),
      (try_begin),
        (eq, ":faction_removed", 1),
        (val_sub, ":num_active_factions", 1),
        #(call_script, "script_store_average_center_value_per_faction"),
      (try_end),
      (try_for_range, ":cur_kingdom_2", kingdoms_begin, kingdoms_end),
        (call_script, "script_update_faction_notes", ":cur_kingdom_2"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":num_active_factions", 1),
      (eq, "$g_one_faction_left_notification_shown", 0),
      (assign, "$g_one_faction_left_notification_shown", 1),
      (try_for_range, ":cur_kingdom", kingdoms_begin, kingdoms_end),
        (faction_slot_eq, ":cur_kingdom", slot_faction_state, sfs_active),
        (call_script, "script_add_notification_menu", "mnu_notification_one_faction_left", ":cur_kingdom", 0),
      (try_end),
    (try_end),
    ]),

  (3, #check to see if player's court has been captured
   [
     (try_begin), #The old court has been lost
       (is_between, "$g_player_court", centers_begin, centers_end),
       (store_faction_of_party, ":court_faction", "$g_player_court"),
       (neq, ":court_faction", "fac_player_supporters_faction"),
       (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
     (else_try),	#At least one new court has been found
       (lt, "$g_player_court", centers_begin),
       #Will by definition not active until a center is taken by the player faction
       #Player minister must have been appointed at some point
       (this_or_next|faction_slot_eq, "fac_player_supporters_faction", slot_faction_leader, "trp_player"),
		(gt, "$g_player_minister", 0),
		
       (assign, ":center_found", 0),
       (try_for_range, ":walled_center", walled_centers_begin, walled_centers_end),
         (eq, ":center_found", 0),
         (store_faction_of_party, ":court_faction", ":walled_center"),
         (eq, ":court_faction", "fac_player_supporters_faction"),
         (assign, ":center_found", ":walled_center"),
       (try_end),
       (ge, ":center_found", 1),
       (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
     (try_end),
     #Also, piggy-backing on this -- having bandits go to lairs and back
     (try_for_parties, ":bandit_party"),
       (gt, ":bandit_party", "p_spawn_points_end"),
       (party_get_template_id, ":bandit_party_template", ":bandit_party"),
       (is_between, ":bandit_party_template", "pt_steppe_bandits", "pt_deserters"),
       (party_template_get_slot, ":bandit_lair", ":bandit_party_template", slot_party_template_lair_party),
       (try_begin),#If party is active and bandit is far away, then move to location
         (gt, ":bandit_lair", "p_spawn_points_end"),
         (store_distance_to_party_from_party, ":distance", ":bandit_party", ":bandit_lair"), #this is the cause of the error
         (gt, ":distance", 30),
         #All this needs checking
         (party_set_ai_behavior, ":bandit_party", ai_bhvr_travel_to_point),
         (party_get_position, pos5, ":bandit_lair"),
         (party_set_ai_target_position, ":bandit_party", pos5),
       (else_try), #Otherwise, act freely
         (get_party_ai_behavior, ":behavior", ":bandit_party"),
         (eq, ":behavior", ai_bhvr_travel_to_point),
         (try_begin),
           (gt, ":bandit_lair", "p_spawn_points_end"),
           (store_distance_to_party_from_party, ":distance", ":bandit_party", ":bandit_lair"),
           (lt, ":distance", 3),
           (party_set_ai_behavior, ":bandit_party", ai_bhvr_patrol_party),
           (party_template_get_slot, ":spawnpoint", ":bandit_party_template", slot_party_template_lair_spawnpoint),
           (party_set_ai_object, ":bandit_party", ":spawnpoint"),
           (party_set_ai_patrol_radius, ":bandit_party", 45),
         (else_try),
           (lt, ":bandit_lair", "p_spawn_points_end"),
           (party_set_ai_behavior, ":bandit_party", ai_bhvr_patrol_party),
           (party_template_get_slot, ":spawnpoint", ":bandit_party_template", slot_party_template_lair_spawnpoint),
           (party_set_ai_object, ":bandit_party", ":spawnpoint"),
           (party_set_ai_patrol_radius, ":bandit_party", 45),
         (try_end),
       (try_end),
     (try_end),
     #Piggybacking on trigger:
     (try_begin),
       (troop_get_slot, ":betrothed", "trp_player", slot_troop_betrothed),
       (gt, ":betrothed", 0),
       (neg|check_quest_active, "qst_wed_betrothed"),
       (neg|check_quest_active, "qst_wed_betrothed_female"),
       (str_store_troop_name, s5, ":betrothed"),
       (display_message, "@Betrothal to {s5} expires"),
       (troop_set_slot, "trp_player", slot_troop_betrothed, -1),
       (troop_set_slot, ":betrothed", slot_troop_betrothed, -1),
     (try_end),
     ]),
		
  # Reduce renown slightly by 0.5% every week
  (7 * 24,
   [
       (troop_get_slot, ":player_renown", "trp_player", slot_troop_renown),
       (store_div, ":renown_decrease", ":player_renown", 200),
       (val_sub, ":player_renown", ":renown_decrease"),
       (troop_set_slot, "trp_player", slot_troop_renown, ":player_renown"),
    ]),

  # Read books if player is resting.
  (1, [(neg|map_free),
       (gt, "$g_player_reading_book", 0),
       (player_has_item, "$g_player_reading_book"),
       (store_attribute_level, ":int", "trp_player", ca_intelligence),
       (item_get_slot, ":int_req", "$g_player_reading_book", slot_item_intelligence_requirement),
       (le, ":int_req", ":int"),
       (item_get_slot, ":book_reading_progress", "$g_player_reading_book", slot_item_book_reading_progress),
       (item_get_slot, ":book_read", "$g_player_reading_book", slot_item_book_read),
       (eq, ":book_read", 0),
       (val_add, ":book_reading_progress", 7),
       (item_set_slot, "$g_player_reading_book", slot_item_book_reading_progress, ":book_reading_progress"),
       (ge, ":book_reading_progress", 1000),
       (item_set_slot, "$g_player_reading_book", slot_item_book_read, 1),
       (str_store_item_name, s1, "$g_player_reading_book"),
       (str_clear, s2),
       (try_begin),
         (eq, "$g_player_reading_book", "itm_book_tactics"),
         (troop_raise_skill, "trp_player", "skl_tactics", 1),
         (str_store_string, s2, "@ Your tactics skill has increased by 1."),
       (else_try),
         (eq, "$g_player_reading_book", "itm_book_persuasion"),
         (troop_raise_skill, "trp_player", "skl_persuasion", 1),
         (str_store_string, s2, "@ Your persuasion skill has increased by 1."),
       (else_try),
         (eq, "$g_player_reading_book", "itm_book_leadership"),
         (troop_raise_skill, "trp_player", "skl_leadership", 1),
         (str_store_string, s2, "@ Your leadership skill has increased by 1."),
       (else_try),
         (eq, "$g_player_reading_book", "itm_book_intelligence"),
         (troop_raise_attribute, "trp_player", ca_intelligence, 1),
         (str_store_string, s2, "@ Your intelligence has increased by 1."),
       (else_try),
         (eq, "$g_player_reading_book", "itm_book_trade"),
         (troop_raise_skill, "trp_player", "skl_trade", 1),
         (str_store_string, s2, "@ Your trade skill has increased by 1."),
       (else_try),
         (eq, "$g_player_reading_book", "itm_book_weapon_mastery"),
         (troop_raise_skill, "trp_player", "skl_weapon_master", 1),
         (str_store_string, s2, "@ Your weapon master skill has increased by 1."),
       (else_try),
         (eq, "$g_player_reading_book", "itm_book_engineering"),
         (troop_raise_skill, "trp_player", "skl_engineer", 1),
         (str_store_string, s2, "@ Your engineer skill has increased by 1."),
       (try_end),
       
       (unlock_achievement, ACHIEVEMENT_BOOK_WORM),

       (try_begin),
         (eq, "$g_infinite_camping", 0),
         (dialog_box, "@You have finished reading {s1}.{s2}", "@Book Read"),
       (try_end),  
              
       (assign, "$g_player_reading_book", 0),	   	   
       ]),

# Removing cattle herds if they are way out of range
  (12, [(try_for_parties, ":cur_party"),
          (party_slot_eq, ":cur_party", slot_party_type, spt_cattle_herd),
          (store_distance_to_party_from_party, ":dist",":cur_party", "p_main_party"),
          (try_begin),
            (gt, ":dist", 30),
            (remove_party, ":cur_party"),
            (try_begin),
              #Fail quest if the party is the quest party
              (check_quest_active, "qst_move_cattle_herd"),
              (neg|check_quest_concluded, "qst_move_cattle_herd"),
              (quest_slot_eq, "qst_move_cattle_herd", slot_quest_target_party, ":cur_party"),
              (call_script, "script_fail_quest", "qst_move_cattle_herd"),
            (end_try),
          (else_try),
            (gt, ":dist", 10),
            (party_set_slot, ":cur_party", slot_cattle_driven_by_player, 0),
            (party_set_ai_behavior, ":cur_party", ai_bhvr_hold),
          (try_end),
        (try_end),
    ]),

  
#####!!!!!

# Village upgrade triggers

# School
  (30 * 24,
   [(try_for_range, ":cur_village", villages_begin, villages_end),
      (party_slot_eq, ":cur_village", slot_town_lord, "trp_player"),
      (party_slot_eq, ":cur_village", slot_center_has_school, 1),
      (party_get_slot, ":cur_relation", ":cur_village", slot_center_player_relation),
      (val_add, ":cur_relation", 1),
      (val_min, ":cur_relation", 100),
      (party_set_slot, ":cur_village", slot_center_player_relation, ":cur_relation"),
    (try_end),
    ]),

# Quest triggers:

# Remaining days text update
  (24, [(try_for_range, ":cur_quest", all_quests_begin, all_quests_end),
          (try_begin),
            (check_quest_active, ":cur_quest"),
            (try_begin),
              (neg|check_quest_concluded, ":cur_quest"),
              (quest_slot_ge, ":cur_quest", slot_quest_expiration_days, 1),
              (quest_get_slot, ":exp_days", ":cur_quest", slot_quest_expiration_days),
              (val_sub, ":exp_days", 1),
              (try_begin),
                (eq, ":exp_days", 0),
                (call_script, "script_abort_quest", ":cur_quest", 1),
              (else_try),
                (quest_set_slot, ":cur_quest", slot_quest_expiration_days, ":exp_days"),
                (assign, reg0, ":exp_days"),
                (add_quest_note_from_sreg, ":cur_quest", 7, "@You have {reg0} days to finish this quest.", 0),
              (try_end),
            (try_end),
          (else_try),
            (quest_slot_ge, ":cur_quest", slot_quest_dont_give_again_remaining_days, 1),
            (quest_get_slot, ":value", ":cur_quest", slot_quest_dont_give_again_remaining_days),
            (val_sub, ":value", 1),
            (quest_set_slot, ":cur_quest", slot_quest_dont_give_again_remaining_days, ":value"),
          (try_end),
        (try_end),
    ]),

# Report to army quest 
  (2,
   [
     (eq, "$g_infinite_camping", 0),
     (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
     (eq, "$g_player_is_captive", 0),
     	 
	 (try_begin),
		(check_quest_active, "qst_report_to_army"),
		(faction_slot_eq, "$players_kingdom", slot_faction_marshall, -1),
		(call_script, "script_abort_quest", "qst_report_to_army", 0),
	 (try_end),
	 
	 (faction_get_slot, ":faction_object", "$players_kingdom", slot_faction_ai_object),         
	 
     (neg|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_default),
     (neg|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_feast),     
          
     (assign, ":continue", 1),
     (try_begin),     
       (this_or_next|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_attacking_enemies_around_center),
       (this_or_next|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_attacking_center),
       (faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_raiding_village),                            
       (neg|is_between, ":faction_object", walled_centers_begin, walled_centers_end),
       (assign, ":continue", 0),
     (try_end),       
     (eq, ":continue", 1),
                            	 
	 (assign, ":kingdom_is_at_war", 0),
	 (try_for_range, ":faction", kingdoms_begin, kingdoms_end),
		(neq, ":faction", "$players_kingdom"),
		(store_relation, ":relation", ":faction", "$players_kingdom"),
		(lt, ":relation", 0),
		(assign, ":kingdom_is_at_war", 1),
	 (try_end),
	 (eq, ":kingdom_is_at_war", 1),
	 	 
     (neg|check_quest_active, "qst_report_to_army"),
     (neg|check_quest_active, "qst_follow_army"),
     
     (neg|quest_slot_ge, "qst_report_to_army", slot_quest_dont_give_again_remaining_days, 1),
     (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
     (gt, ":faction_marshall", 0),
     (troop_get_slot, ":faction_marshall_party", ":faction_marshall", slot_troop_leaded_party),
     (gt, ":faction_marshall_party", 0),
     (party_is_active, ":faction_marshall_party"),
     
     (store_distance_to_party_from_party, ":distance_to_marshal", ":faction_marshall_party", "p_main_party"),
     (le, ":distance_to_marshal", 96),
     
     (assign, ":has_no_quests", 1),     
     (try_for_range, ":cur_quest", lord_quests_begin, lord_quests_end),
       (check_quest_active, ":cur_quest"),
       (quest_slot_eq, ":cur_quest", slot_quest_giver_troop, ":faction_marshall"),
       (assign, ":has_no_quests", 0),
     (try_end),
     (eq, ":has_no_quests", 1),
     
     (try_for_range, ":cur_quest", lord_quests_begin_2, lord_quests_end_2),
       (check_quest_active, ":cur_quest"),
       (quest_slot_eq, ":cur_quest", slot_quest_giver_troop, ":faction_marshall"),
       (assign, ":has_no_quests", 0),
     (try_end),
     (eq, ":has_no_quests", 1),
     
     (try_for_range, ":cur_quest", army_quests_begin, army_quests_end),
       (check_quest_active, ":cur_quest"),
       (assign, ":has_no_quests", 0),
     (try_end),
     (eq, ":has_no_quests", 1),
     
     (store_character_level, ":level", "trp_player"),
     (ge, ":level", 8),
     (assign, ":cur_target_amount", 2),
     (try_for_range, ":cur_center", centers_begin, centers_end),
       (party_slot_eq, ":cur_center", slot_town_lord, "trp_player"),
       (try_begin),
         (party_slot_eq, ":cur_center", slot_party_type, spt_town),
         (val_add, ":cur_target_amount", 3),
       (else_try),
         (party_slot_eq, ":cur_center", slot_party_type, spt_castle),
         (val_add, ":cur_target_amount", 1),
       (else_try),
         (val_add, ":cur_target_amount", 1),
       (try_end),
     (try_end),
     
     (val_mul, ":cur_target_amount", 4),
     (val_min, ":cur_target_amount", 60),
     (quest_set_slot, "qst_report_to_army", slot_quest_giver_troop, ":faction_marshall"),
     (quest_set_slot, "qst_report_to_army", slot_quest_target_troop, ":faction_marshall"),
     (quest_set_slot, "qst_report_to_army", slot_quest_target_amount, ":cur_target_amount"),
     (quest_set_slot, "qst_report_to_army", slot_quest_expiration_days, 4),
     (quest_set_slot, "qst_report_to_army", slot_quest_dont_give_again_period, 22),     
     (jump_to_menu, "mnu_kingdom_army_quest_report_to_army"),
   ]),


# Army quest initializer
  (3,
   [
     (assign, "$g_random_army_quest", -1),
     (check_quest_active, "qst_follow_army", 1),
     (is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
#Rebellion changes begin
#     (neg|is_between, "$players_kingdom", rebel_factions_begin, rebel_factions_end),
#Rebellion changes end
     (neg|faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_default),
     (faction_get_slot, ":faction_marshall", "$players_kingdom", slot_faction_marshall),
     (neq, ":faction_marshall", "trp_player"),
     (gt, ":faction_marshall", 0),
     (troop_get_slot, ":faction_marshall_party", ":faction_marshall", slot_troop_leaded_party),
     (gt, ":faction_marshall_party", 0),
     (party_is_active, ":faction_marshall_party"),
     (store_distance_to_party_from_party, ":dist", ":faction_marshall_party", "p_main_party"),
     (try_begin),
       (lt, ":dist", 15),
       (assign, "$g_player_follow_army_warnings", 0),
       (store_current_hours, ":cur_hours"),
       (faction_get_slot, ":last_offensive_time", "$players_kingdom", slot_faction_last_offensive_concluded),
       (store_sub, ":passed_time", ":cur_hours", ":last_offensive_time"),

       (assign, ":result", -1),
       (try_begin),
         (store_random_in_range, ":random_no", 0, 100),
         (lt, ":random_no", 30),
         (troop_slot_eq, ":faction_marshall", slot_troop_does_not_give_quest, 0),
         (try_for_range, ":unused", 0, 20), #Repeat trial twenty times
           (eq, ":result", -1),
           (store_random_in_range, ":quest_no", army_quests_begin, army_quests_end),
           (neg|quest_slot_ge, ":quest_no", slot_quest_dont_give_again_remaining_days, 1),
           (try_begin),
             (eq, ":quest_no", "qst_deliver_cattle_to_army"),
			# (eq, 1, 0), #disables temporarily			 
             (try_begin),
               (faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_attacking_center),
               (gt, ":passed_time", 120),#5 days
               (store_random_in_range, ":quest_target_amount", 5, 10),
               (assign, ":result","qst_deliver_cattle_to_army"),
               (quest_set_slot, ":result", slot_quest_target_amount, ":quest_target_amount"),
               (quest_set_slot, ":result", slot_quest_expiration_days, 10),
               (quest_set_slot, ":result", slot_quest_dont_give_again_period, 30),
             (try_end),
           (else_try),
             (eq, ":quest_no", "qst_join_siege_with_army"),
			 (eq, 1, 0),
             (try_begin),
               (faction_slot_eq, "$players_kingdom", slot_faction_ai_state, sfai_attacking_center),
               (faction_get_slot, ":ai_object", "$players_kingdom", slot_faction_ai_object),
               (is_between, ":ai_object", walled_centers_begin, walled_centers_end),
               (party_get_battle_opponent, ":besieged_center", ":faction_marshall_party"),
               (eq, ":besieged_center", ":ai_object"),
               #army is assaulting the center
               (assign, ":result", ":quest_no"),
               (quest_set_slot, ":result", slot_quest_target_center, ":ai_object"),
               (quest_set_slot, ":result", slot_quest_expiration_days, 2),
               (quest_set_slot, ":result", slot_quest_dont_give_again_period, 15),
             (try_end),
           (else_try),
             (eq, ":quest_no", "qst_scout_waypoints"),
             (try_begin),
               (assign, ":end_cond", 100),
               (assign, "$qst_scout_waypoints_wp_1", -1),
               (assign, "$qst_scout_waypoints_wp_2", -1),
               (assign, "$qst_scout_waypoints_wp_3", -1),
               (assign, ":continue", 0),
               (try_for_range, ":unused", 0, ":end_cond"),
                 (try_begin),
                   (lt, "$qst_scout_waypoints_wp_1", 0),
                   (call_script, "script_cf_get_random_enemy_center_within_range", ":faction_marshall_party", 50),
                   (assign, "$qst_scout_waypoints_wp_1", reg0),
                 (try_end),
                 (try_begin),
                   (lt, "$qst_scout_waypoints_wp_2", 0),
                   (call_script, "script_cf_get_random_enemy_center_within_range", ":faction_marshall_party", 50),
                   (neq, "$qst_scout_waypoints_wp_1", reg0),
                   (assign, "$qst_scout_waypoints_wp_2", reg0),
                 (try_end),
                 (try_begin),
                   (lt, "$qst_scout_waypoints_wp_3", 0),
                   (call_script, "script_cf_get_random_enemy_center_within_range", ":faction_marshall_party", 50),
                   (neq, "$qst_scout_waypoints_wp_1", reg0),
                   (neq, "$qst_scout_waypoints_wp_2", reg0),
                   (assign, "$qst_scout_waypoints_wp_3", reg0),
                 (try_end),
                 (neq, "$qst_scout_waypoints_wp_1", "$qst_scout_waypoints_wp_2"),
                 (neq, "$qst_scout_waypoints_wp_1", "$qst_scout_waypoints_wp_2"),
                 (neq, "$qst_scout_waypoints_wp_2", "$qst_scout_waypoints_wp_3"),
                 (ge, "$qst_scout_waypoints_wp_1", 0),
                 (ge, "$qst_scout_waypoints_wp_2", 0),
                 (ge, "$qst_scout_waypoints_wp_3", 0),
                 (assign, ":end_cond", 0),
                 (assign, ":continue", 1),
               (try_end),
               (eq, ":continue", 1),
               (assign, "$qst_scout_waypoints_wp_1_visited", 0),
               (assign, "$qst_scout_waypoints_wp_2_visited", 0),
               (assign, "$qst_scout_waypoints_wp_3_visited", 0),
               (assign, ":result", "qst_scout_waypoints"),
               (quest_set_slot, ":result", slot_quest_expiration_days, 7),
               (quest_set_slot, ":result", slot_quest_dont_give_again_period, 25),
             (try_end),
           (try_end),
         (try_end),
		 
         (try_begin),
           (neq, ":result", -1),
           (quest_set_slot, ":result", slot_quest_current_state, 0),
           (quest_set_slot, ":result", slot_quest_giver_troop, ":faction_marshall"),
           (try_begin),
             (eq, ":result", "qst_join_siege_with_army"),
             (jump_to_menu, "mnu_kingdom_army_quest_join_siege_order"),
           (else_try),
             (assign, "$g_random_army_quest", ":result"),
             (quest_set_slot, "$g_random_army_quest", slot_quest_giver_troop, ":faction_marshall"),
             (jump_to_menu, "mnu_kingdom_army_quest_messenger"),
           (try_end),
         (try_end),
       (try_end),
     (else_try),
       (val_add, "$g_player_follow_army_warnings", 1),
       (try_begin),
         (lt, "$g_player_follow_army_warnings", 15),
         (try_begin),
           (store_mod, ":follow_mod", "$g_player_follow_army_warnings", 3),
           (eq, ":follow_mod", 0),
           (str_store_troop_name_link, s1, ":faction_marshall"),
           (try_begin),
             (lt, "$g_player_follow_army_warnings", 8),
#             (display_message, "str_marshal_warning"),
           (else_try),
             (display_message, "str_marshal_warning"),
           (try_end),
         (try_end),
       (else_try),
         (jump_to_menu, "mnu_kingdom_army_follow_failed"),
       (try_end),
     (try_end),
    ]),

# Move cattle herd
  (0.5, [(check_quest_active,"qst_move_cattle_herd"),
         (neg|check_quest_concluded,"qst_move_cattle_herd"),
         (quest_get_slot, ":target_party", "qst_move_cattle_herd", slot_quest_target_party),
         (quest_get_slot, ":target_center", "qst_move_cattle_herd", slot_quest_target_center),
         (store_distance_to_party_from_party, ":dist",":target_party", ":target_center"),
         (lt, ":dist", 3),
         (remove_party, ":target_party"),
         (call_script, "script_succeed_quest", "qst_move_cattle_herd"),
    ]),

  (0.001, [
(val_clamp, "$async_simple_trigger22", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger22", 1),
	(try_begin),	
	(ge, "$async_simple_trigger22", active_npcs_end),
	(assign, "$async_simple_trigger22", active_npcs_begin),
	(try_end),
		(try_begin),
       (assign, ":troop_no", "$async_simple_trigger22"),
		 (troop_slot_eq, ":troop_no", slot_troop_occupation, slto_kingdom_hero),
		 (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
         (ge, ":party_no", 1),
		 (party_is_active, ":party_no"),
         (party_slot_eq, ":party_no", slot_party_following_player, 1),
         (store_current_hours, ":cur_time"),
         (neg|party_slot_ge, ":party_no", slot_party_follow_player_until_time, ":cur_time"),
         (party_set_slot, ":party_no", slot_party_commander_party, -1),
         (party_set_slot, ":party_no", slot_party_following_player, 0),
         (assign,  ":dont_follow_period", 200),
         (store_add, ":dont_follow_time", ":cur_time", ":dont_follow_period"),
         (party_set_slot, ":party_no", slot_party_dont_follow_player_until_time,  ":dont_follow_time"),
       (try_end),
    ]),

# Deliver cattle and deliver cattle to army
  (0.5,
   [
     (try_begin),
       (check_quest_active,"qst_deliver_cattle"),
       (neg|check_quest_succeeded, "qst_deliver_cattle"),
       (quest_get_slot, ":target_center", "qst_deliver_cattle", slot_quest_target_center),
       (quest_get_slot, ":target_amount", "qst_deliver_cattle", slot_quest_target_amount),
       (quest_get_slot, ":cur_amount", "qst_deliver_cattle", slot_quest_current_state),
       (store_sub, ":left_amount", ":target_amount", ":cur_amount"),
       (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":target_center", ":left_amount"),
       (val_add, ":cur_amount", reg0),
       (quest_set_slot, "qst_deliver_cattle", slot_quest_current_state, ":cur_amount"),
       (le, ":target_amount", ":cur_amount"),
       (call_script, "script_succeed_quest", "qst_deliver_cattle"),
     (try_end),
     (try_begin),
       (check_quest_active, "qst_deliver_cattle_to_army"),
       (neg|check_quest_succeeded, "qst_deliver_cattle_to_army"),
       (quest_get_slot, ":giver_troop", "qst_deliver_cattle_to_army", slot_quest_giver_troop),
       (troop_get_slot, ":target_party", ":giver_troop", slot_troop_leaded_party),
       (try_begin),
         (gt, ":target_party", 0),
         (quest_get_slot, ":target_amount", "qst_deliver_cattle_to_army", slot_quest_target_amount),
         (quest_get_slot, ":cur_amount", "qst_deliver_cattle_to_army", slot_quest_current_state),
         (store_sub, ":left_amount", ":target_amount", ":cur_amount"),
         (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":target_party", ":left_amount"),
         (val_add, ":cur_amount", reg0),
         (quest_set_slot, "qst_deliver_cattle_to_army", slot_quest_current_state, ":cur_amount"),
         (try_begin),
           (le, ":target_amount", ":cur_amount"),
           (call_script, "script_succeed_quest", "qst_deliver_cattle_to_army"),
         (try_end),
       (else_try),
         (call_script, "script_abort_quest", "qst_deliver_cattle_to_army", 0),
       (try_end),
     (try_end),
     ]),

# Train peasants against bandits
  (1,
   [
     (neg|map_free),
     (check_quest_active, "qst_train_peasants_against_bandits"),
     (neg|check_quest_concluded, "qst_train_peasants_against_bandits"),
     (eq, "$qst_train_peasants_against_bandits_currently_training", 1),
     (val_add, "$qst_train_peasants_against_bandits_num_hours_trained", 1),
     (call_script, "script_get_max_skill_of_player_party", "skl_trainer"),
     (assign, ":trainer_skill", reg0),
     (store_sub, ":needed_hours", 20, ":trainer_skill"),
     (val_mul, ":needed_hours", 3),
     (val_div, ":needed_hours", 5),
     (ge, "$qst_train_peasants_against_bandits_num_hours_trained", ":needed_hours"),
     (assign, "$qst_train_peasants_against_bandits_num_hours_trained", 0),
     (rest_for_hours, 0, 0, 0), #stop resting
     (jump_to_menu, "mnu_train_peasants_against_bandits_ready"),
     ]),

# Scout waypoints
  (1,
   [
     (check_quest_active,"qst_scout_waypoints"),
     (neg|check_quest_succeeded, "qst_scout_waypoints"),
     (try_begin),
       (eq, "$qst_scout_waypoints_wp_1_visited", 0),
       (store_distance_to_party_from_party, ":distance", "$qst_scout_waypoints_wp_1", "p_main_party"),
       (le, ":distance", 3),
       (assign, "$qst_scout_waypoints_wp_1_visited", 1),
       (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_1"),
       (display_message, "@{s1} is scouted."),
     (try_end),
     (try_begin),
       (eq, "$qst_scout_waypoints_wp_2_visited", 0),
       (store_distance_to_party_from_party, ":distance", "$qst_scout_waypoints_wp_2", "p_main_party"),
       (le, ":distance", 3),
       (assign, "$qst_scout_waypoints_wp_2_visited", 1),
       (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_2"),
       (display_message, "@{s1} is scouted."),
     (try_end),
     (try_begin),
       (eq, "$qst_scout_waypoints_wp_3_visited", 0),
       (store_distance_to_party_from_party, ":distance", "$qst_scout_waypoints_wp_3", "p_main_party"),
       (le, ":distance", 3),
       (assign, "$qst_scout_waypoints_wp_3_visited", 1),
       (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_3"),
       (display_message, "@{s1} is scouted."),
     (try_end),
     (eq, "$qst_scout_waypoints_wp_1_visited", 1),
     (eq, "$qst_scout_waypoints_wp_2_visited", 1),
     (eq, "$qst_scout_waypoints_wp_3_visited", 1),
     (call_script, "script_succeed_quest", "qst_scout_waypoints"),
     ]),
  
# Kill local merchant
  
  (3, [(neg|map_free),
       (check_quest_active, "qst_kill_local_merchant"),
       (quest_slot_eq, "qst_kill_local_merchant", slot_quest_current_state, 0),
       (quest_set_slot, "qst_kill_local_merchant", slot_quest_current_state, 1),
       (rest_for_hours, 0, 0, 0), #stop resting
       (assign, "$auto_enter_town", "$qst_kill_local_merchant_center"),
       (assign, "$quest_auto_menu", "mnu_kill_local_merchant_begin"),
       ]),

# Collect taxes
  (1, [(neg|map_free),
       (check_quest_active, "qst_collect_taxes"),
       (eq, "$g_player_is_captive", 0),
       (eq, "$qst_collect_taxes_currently_collecting", 1),
       (quest_get_slot, ":quest_current_state", "qst_collect_taxes", slot_quest_current_state),
       (this_or_next|eq, ":quest_current_state", 1),
       (this_or_next|eq, ":quest_current_state", 2),
       (eq, ":quest_current_state", 3),
       (quest_get_slot, ":left_hours", "qst_collect_taxes", slot_quest_target_amount),
       (val_sub, ":left_hours", 1),
       (quest_set_slot, "qst_collect_taxes", slot_quest_target_amount, ":left_hours"),
       (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
       
       (try_begin),
         (lt, ":left_hours", 0),
         (assign, ":quest_current_state", 4),
         (quest_set_slot, "qst_collect_taxes", slot_quest_current_state, 4),
         (rest_for_hours, 0, 0, 0), #stop resting
         (jump_to_menu, "mnu_collect_taxes_complete"),
       (else_try),
         #Continue collecting taxes
         (assign, ":max_collected_tax", "$qst_collect_taxes_hourly_income"),
         (party_get_slot, ":prosperity", "$g_encountered_party", slot_town_prosperity),
         (store_add, ":multiplier", 30, ":prosperity"),
         (val_mul, ":max_collected_tax", ":multiplier"),
         (val_div, ":max_collected_tax", 80),#Prosperity of 50 gives the default values
       
         (try_begin),
           (eq, "$qst_collect_taxes_halve_taxes", 1),
           (val_div, ":max_collected_tax", 2),
         (try_end),
         (val_max, ":max_collected_tax", 2),
         (store_random_in_range, ":collected_tax", 1, ":max_collected_tax"),
         (quest_get_slot, ":cur_collected", "qst_collect_taxes", slot_quest_gold_reward),
         (val_add, ":cur_collected", ":collected_tax"),
         (quest_set_slot, "qst_collect_taxes", slot_quest_gold_reward, ":cur_collected"),
         (call_script, "script_troop_add_gold", "trp_player", ":collected_tax"),
       (try_end),
       (try_begin),
         (eq, ":quest_current_state", 1),
         (val_sub, "$qst_collect_taxes_menu_counter", 1),
         (le, "$qst_collect_taxes_menu_counter", 0),
         (quest_set_slot, "qst_collect_taxes", slot_quest_current_state, 2),
         (jump_to_menu, "mnu_collect_taxes_revolt_warning"),
       (else_try), #Chance of revolt against player
         (eq, ":quest_current_state", 2),
         (val_sub, "$qst_collect_taxes_unrest_counter", 1),
         (le, "$qst_collect_taxes_unrest_counter", 0),
         (eq, "$qst_collect_taxes_halve_taxes", 0),
         (quest_set_slot, "qst_collect_taxes", slot_quest_current_state, 3),

         (store_div, ":unrest_chance", 10000, "$qst_collect_taxes_total_hours"),
         (val_add, ":unrest_chance",30),
       
         (store_random_in_range, ":unrest_roll", 0, 1000),
         (try_begin),
           (lt, ":unrest_roll", ":unrest_chance"),
           (jump_to_menu, "mnu_collect_taxes_revolt"),
         (try_end),
       (try_end),
       ]),

#persuade_lords_to_make_peace begin
  (72, [(gt, "$g_force_peace_faction_1", 0),
        (gt, "$g_force_peace_faction_2", 0),
        (try_begin),
          (store_relation, ":relation", "$g_force_peace_faction_1", "$g_force_peace_faction_2"),
          (lt, ":relation", 0),
          (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_force_peace_faction_1", "$g_force_peace_faction_2", 1),
        (try_end),
        (assign, "$g_force_peace_faction_1", 0),
        (assign, "$g_force_peace_faction_2", 0),
       ]),  

#NPC changes begin
#Resolve one issue each hour
(1, 
   [           
		(str_store_string, s51, "str_no_trigger_noted"),
		
		# Rejoining party
        (try_begin),
            (gt, "$npc_to_rejoin_party", 0),
            (eq, "$g_infinite_camping", 0),
            (try_begin),
                (neg|main_party_has_troop, "$npc_to_rejoin_party"),
                (neq, "$g_player_is_captive", 1),

				(str_store_string, s51, "str_triggered_by_npc_to_rejoin_party"),
				
                (assign, "$npc_map_talk_context", slot_troop_days_on_mission),
                (start_map_conversation, "$npc_to_rejoin_party", -1),
			(else_try),
				(troop_set_slot, "$npc_to_rejoin_party", slot_troop_current_mission, npc_mission_rejoin_when_possible),
				(assign, "$npc_to_rejoin_party", 0),
            (try_end),			
		# Here do NPC that is quitting
		(else_try),
            (gt, "$npc_is_quitting", 0),
            (eq, "$g_infinite_camping", 0),
            (try_begin),
                (main_party_has_troop, "$npc_is_quitting"),
                (neq, "$g_player_is_captive", 1),

				(str_store_string, s51, "str_triggered_by_npc_is_quitting"),
                (start_map_conversation, "$npc_is_quitting", -1),
            (else_try),
                (assign, "$npc_is_quitting", 0),
            (try_end),
		#NPC with grievance	
        (else_try), #### Grievance
            (gt, "$npc_with_grievance", 0),
            (eq, "$g_infinite_camping", 0),
            (eq, "$disable_npc_complaints", 0),
            (try_begin),
                (main_party_has_troop, "$npc_with_grievance"),
                (neq, "$g_player_is_captive", 1),

				(str_store_string, s51, "str_triggered_by_npc_has_grievance"),
				
                (assign, "$npc_map_talk_context", slot_troop_morality_state),
                (start_map_conversation, "$npc_with_grievance", -1),
            (else_try),
                (assign, "$npc_with_grievance", 0),
            (try_end),
        (else_try),
            (gt, "$npc_with_personality_clash", 0),
            (eq, "$g_infinite_camping", 0),
            (eq, "$disable_npc_complaints", 0),
            (troop_get_slot, ":object", "$npc_with_personality_clash", slot_troop_personalityclash_object),
            (try_begin),
                (main_party_has_troop, "$npc_with_personality_clash"),
                (main_party_has_troop, ":object"),
                (neq, "$g_player_is_captive", 1),
				
                (assign, "$npc_map_talk_context", slot_troop_personalityclash_state),
				(str_store_string, s51, "str_triggered_by_npc_has_personality_clash"),
                (start_map_conversation, "$npc_with_personality_clash", -1),
            (else_try),
                (assign, "$npc_with_personality_clash", 0),
            (try_end),
        (else_try), #### Political issue
            (gt, "$npc_with_political_grievance", 0),
            (eq, "$g_infinite_camping", 0),
            (eq, "$disable_npc_complaints", 0),
            (try_begin),
                (main_party_has_troop, "$npc_with_political_grievance"),
                (neq, "$g_player_is_captive", 1),
				
				(str_store_string, s51, "str_triggered_by_npc_has_political_grievance"),
                (assign, "$npc_map_talk_context", slot_troop_kingsupport_objection_state),
                (start_map_conversation, "$npc_with_political_grievance", -1),
			(else_try),
				(assign, "$npc_with_political_grievance", 0),
            (try_end),
		(else_try),	
            (eq, "$disable_sisterly_advice", 0),
            (eq, "$g_infinite_camping", 0),
            (gt, "$npc_with_sisterly_advice", 0),
            (try_begin),
				(main_party_has_troop, "$npc_with_sisterly_advice"),
                (neq, "$g_player_is_captive", 1),
				
				(assign, "$npc_map_talk_context", slot_troop_woman_to_woman_string), #was npc_with_sisterly advice
	            (start_map_conversation, "$npc_with_sisterly_advice", -1),
			(else_try),
				(assign, "$npc_with_sisterly_advice", 0),
            (try_end),
		(else_try), #check for regional background
            (eq, "$disable_local_histories", 0),
            (eq, "$g_infinite_camping", 0),
            (try_for_range, ":npc", companions_begin, companions_end),
                (main_party_has_troop, ":npc"),           
                (troop_slot_eq, ":npc", slot_troop_home_speech_delivered, 0),
                (troop_get_slot, ":home", ":npc", slot_troop_home),
                (gt, ":home", 0),
                (store_distance_to_party_from_party, ":distance", ":home", "p_main_party"),
                (lt, ":distance", 7),
                (assign, "$npc_map_talk_context", slot_troop_home),
				
				(str_store_string, s51, "str_triggered_by_local_histories"),
				
                (start_map_conversation, ":npc", -1),
            (try_end),
        (try_end),
		
		#add pretender to party if not active
		(try_begin),
			(check_quest_active, "qst_rebel_against_kingdom"),
			(is_between, "$supported_pretender", pretenders_begin, pretenders_end),
			(neg|main_party_has_troop, "$supported_pretender"),
			(neg|troop_slot_eq, "$supported_pretender", slot_troop_occupation, slto_kingdom_hero),
			(party_add_members, "p_main_party", "$supported_pretender", 1),
		(try_end),
		
		#make player marshal of rebel faction
		(try_begin),
			(check_quest_active, "qst_rebel_against_kingdom"),
			(is_between, "$supported_pretender", pretenders_begin, pretenders_end),
			(main_party_has_troop, "$supported_pretender"),
			(neg|faction_slot_eq, "fac_player_supporters_faction", slot_faction_marshall, "trp_player"),
			(call_script, "script_appoint_faction_marshall", "fac_player_supporters_faction", "trp_player"),
		(try_end),
		
		
]),
#NPC changes end

(0.001, 
   [
(val_clamp, "$async_simple_trigger23", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger23", 1),
	(try_begin),	
	(ge, "$async_simple_trigger23", active_npcs_end),
	(assign, "$async_simple_trigger23", active_npcs_begin),
	(try_end),
		(try_begin),
   (assign, ":troop_no", active_npcs_begin, active_npcs_end),
      (troop_slot_ge, ":troop_no", slot_troop_change_to_faction, 1),
      (store_troop_faction, ":faction_no", ":troop_no"),
      (troop_get_slot, ":new_faction_no", ":troop_no", slot_troop_change_to_faction),
      (troop_get_slot, ":party_no", ":troop_no", slot_troop_leaded_party),
      (assign, ":continue", 0),
      (try_begin),
        (le, ":party_no", 0),
        #(troop_slot_eq, ":troop_no", slot_troop_is_prisoner, 0),
        (neg|troop_slot_ge, ":troop_no", slot_troop_prisoner_of_party, 0),
        (assign, ":continue", 1),
      (else_try),
        (gt, ":party_no", 0),

        #checking if the party is outside the centers
        (party_get_attached_to, ":cur_center_no", ":party_no"),
        (try_begin),
          (lt, ":cur_center_no", 0),
          (party_get_cur_town, ":cur_center_no", ":party_no"),
        (try_end),
        (this_or_next|neg|is_between, ":cur_center_no", centers_begin, centers_end),
        (party_slot_eq, ":cur_center_no", slot_town_lord, ":troop_no"),
    
        #checking if the party is away from his original faction parties
        (assign, ":end_cond", active_npcs_end),
        (try_for_range, ":enemy_troop_no", active_npcs_begin, ":end_cond"),
		  (troop_slot_eq, ":enemy_troop_no", slot_troop_occupation, slto_kingdom_hero),
          (troop_get_slot, ":enemy_party_no", ":enemy_troop_no", slot_troop_leaded_party),
          (party_is_active, ":enemy_party_no"),
          (store_faction_of_party, ":enemy_faction_no", ":enemy_party_no"),
          (eq, ":enemy_faction_no", ":faction_no"),
			 (party_is_active, ":party_no"),
			 (party_is_active, ":enemy_party_no"),
          (store_distance_to_party_from_party, ":dist", ":party_no", ":enemy_party_no"),
          (lt, ":dist", 4),
          (assign, ":end_cond", 0),
        (try_end),
        (neq, ":end_cond", 0),
        (assign, ":continue", 1),
      (try_end),
      (eq, ":continue", 1),
	  
		(try_begin),
			(ge, "$cheat_mode", 1),
			(str_store_troop_name, s4, ":troop_no"),
			(display_message, "@{!}DEBUG - {s4} faction changed from slot_troop_change_to_faction"), 
		(try_end),	  
		
      (call_script, "script_change_troop_faction", ":troop_no", ":new_faction_no"),
      (troop_set_slot, ":troop_no", slot_troop_change_to_faction, 0),
      (try_begin),
        (is_between, ":new_faction_no", kingdoms_begin, kingdoms_end),
        (str_store_troop_name_link, s1, ":troop_no"),
        (str_store_faction_name_link, s2, ":faction_no"),
        (str_store_faction_name_link, s3, ":new_faction_no"),
        (display_message, "@{s1} has switched from {s2} to {s3}."),
        (try_begin),
          (eq, ":faction_no", "$players_kingdom"),
          (call_script, "script_add_notification_menu", "mnu_notification_troop_left_players_faction", ":troop_no", ":new_faction_no"),
        (else_try),
          (eq, ":new_faction_no", "$players_kingdom"),
          (call_script, "script_add_notification_menu", "mnu_notification_troop_joined_players_faction", ":troop_no", ":faction_no"),
        (try_end),
      (try_end),
    (try_end),
    ]),


(1,
   [
     (eq, "$cheat_mode", 1),
     (try_for_range, ":center_no", centers_begin, centers_end),
       (party_get_battle_opponent, ":besieger_party", ":center_no"),
       (try_begin),
         (gt, ":besieger_party", 0),
         (str_store_party_name, s2, ":center_no"),
         (str_store_party_name, s3, ":besieger_party"),
         (display_message, "@{!}DEBUG : {s2} is besieging by {s3}"),
       (try_end),
     (try_end),    
     ]),

(1, 
   [
     (store_current_day, ":cur_day"),
     (gt, ":cur_day", "$g_last_report_control_day"),
     (store_time_of_day, ":cur_hour"),
     (ge, ":cur_hour", 18),

     (store_random_in_range, ":rand_no", 0, 4),
     (this_or_next|ge, ":cur_hour", 22),
     (eq, ":rand_no", 0),
     
     (assign, "$g_last_report_control_day", ":cur_day"),
     
     (store_troop_gold, ":gold", "trp_player"),
     
     (try_begin),
       (lt, ":gold", 0),
       (store_sub, ":gold_difference", 0, ":gold"),
       (troop_add_gold, "trp_player", ":gold_difference"),
     (try_end),

     (party_get_morale, ":main_party_morale", "p_main_party"),     
     
     #(assign, ":swadian_soldiers_are_upset_message_showed", 0),
     #(assign, ":vaegir_soldiers_are_upset_message_showed", 0),
     #(assign, ":khergit_soldiers_are_upset_message_showed", 0),
     #(assign, ":nord_soldiers_are_upset_message_showed", 0),
     #(assign, ":rhodok_soldiers_are_upset_message_showed", 0),
    
     (try_begin),
       (str_store_string, s1, "str_party_morale_is_low"),            
       (str_clear, s2),

       (party_get_num_companion_stacks, ":num_stacks","p_main_party"),
       (assign, ":num_deserters_total", 0),
       (try_for_range_backwards, ":i_stack", 0, ":num_stacks"),
         (party_stack_get_troop_id, ":stack_troop", "p_main_party", ":i_stack"),
         (neg|troop_is_hero, ":stack_troop"),
         (party_stack_get_size, ":stack_size", "p_main_party", ":i_stack"),
         
         (store_troop_faction, ":faction_no", ":stack_troop"),
      
         (assign, ":troop_morale", ":main_party_morale"),         
         (try_begin),
           (ge, ":faction_no", npc_kingdoms_begin),
           (lt, ":faction_no", npc_kingdoms_end),
        
           (faction_get_slot, ":troop_morale_addition", ":faction_no",  slot_faction_morale_of_player_troops),
           (val_div, ":troop_morale_addition", 100),
           (val_add, ":troop_morale", ":troop_morale_addition"),
         (try_end),

         (lt, ":troop_morale", 32),
         (store_sub, ":desert_prob", 36, ":troop_morale"),
         (val_div, ":desert_prob", 4),

         (assign, ":num_deserters_from_that_troop", 0),
         (try_for_range, ":unused", 0, ":stack_size"),
           (store_random_in_range, ":rand_no", 0, 100),
           (lt, ":rand_no", ":desert_prob"),
           (val_add, ":num_deserters_from_that_troop", 1),
           #p.remove_members_from_stack(i_stack,cur_deserters, &main_party_instances);
           (remove_member_from_party, ":stack_troop", "p_main_party"),
         (try_end),
         (try_begin),
           (ge, ":num_deserters_from_that_troop", 1),           
           (str_store_troop_name, s2, ":stack_troop"),
           (assign, reg0, ":num_deserters_from_that_troop"),
           
#           (try_begin),           
#             (lt, ":troop_morale_addition", -2),
#             (ge, ":main_party_morale", 28),
#             (try_begin),
#               (eq, ":faction_no", "fac_kingdom_1"),  
#               (eq, ":swadian_soldiers_are_upset_message_showed", 0),
#               (str_store_string, s3, "str_swadian_soldiers_are_upset"),
#               (assign, ":swadian_soldiers_are_upset_message_showed", 1),
#             (else_try),
#               (eq, ":faction_no", "fac_kingdom_2"),  
#               (eq, ":vaegir_soldiers_are_upset_message_showed", 0),
#               (str_store_string, s3, "str_vaegir_soldiers_are_upset"),
#               (assign, ":vaegir_soldiers_are_upset_message_showed", 1),
#             (else_try),
#               (eq, ":faction_no", "fac_kingdom_3"),  
#               (eq, ":khergit_soldiers_are_upset_message_showed", 0),
#               (str_store_string, s3, "str_khergit_soldiers_are_upset"),
#               (assign, ":khergit_soldiers_are_upset_message_showed", 1),
#             (else_try),
#               (eq, ":faction_no", "fac_kingdom_4"),  
#               (eq, ":nord_soldiers_are_upset_message_showed", 0),
#               (str_store_string, s3, "str_nord_soldiers_are_upset"),
#               (assign, ":nord_soldiers_are_upset_message_showed", 1),
#             (else_try),
#               (eq, ":faction_no", "fac_kingdom_5"),  
#               (eq, ":rhodok_soldiers_are_upset_message_showed", 0),
#               (str_store_string, s3, "str_rhodok_soldiers_are_upset"),
#               (assign, ":rhodok_soldiers_are_upset_message_showed", 1),
#             (try_end),
#             (str_store_string, s1, "@{!}{s1} {s3}"),
#           (try_end),
           
           (try_begin),
             (ge, ":num_deserters_total", 1),
             (str_store_string, s1, "str_s1_reg0_s2"),
           (else_try),
             (str_store_string, s3, s1),
             (str_store_string, s1, "str_s3_reg0_s2"),
           (try_end),
           (val_add, ":num_deserters_total", ":num_deserters_from_that_troop"),
         (try_end),
       (try_end),

       (try_begin),
         (ge, ":num_deserters_total", 1),
  
         (try_begin),
           (ge, ":num_deserters_total", 2),
           (str_store_string, s2, "str_have_deserted_the_party"),
         (else_try),
           (str_store_string, s2, "str_has_deserted_the_party"),
         (try_end),          

         (str_store_string, s1, "str_s1_s2"),

         (eq, "$g_infinite_camping", 0),
         
         (tutorial_box, s1, "str_weekly_report"),
       (try_end), 
     (try_end),
 ]),
 # reserved for future use. For backward compatibility, we need to use these triggers instead of creating new ones.
  
  (0.001,
   [ # parabellum cut # PARABELLUM UNKNOWN EFFECT
     (call_script, "script_async_calculate_castle_prosperities_by_using_its_villages"),

     # (store_add, ":fac_kingdom_6_plus_one", "fac_kingdom_6", 1),

     # (try_for_range, ":faction_1", "fac_kingdom_1", ":fac_kingdom_6_plus_one"),
       # (try_for_range, ":faction_2", "fac_kingdom_1", ":fac_kingdom_6_plus_one"),
         # (store_relation, ":faction_relation", ":faction_1", ":faction_2"),
         # (str_store_faction_name, s7, ":faction_1"),
         # (str_store_faction_name, s8, ":faction_2"),
         # (neq, ":faction_1", ":faction_2"),
         # (assign, reg1, ":faction_relation"),
         # #(display_message, "@{s7}-{s8}, relation is {reg1}"),
       # (try_end),
     # (try_end),          
   ]),
   
  (1,
   [   
     (try_begin),
       (eq, "$g_player_is_captive", 1),
       (neg|party_is_active, "$capturer_party"),
       (rest_for_hours, 0, 0, 0),
     (try_end),            
     
     (assign, ":village_no", "$next_center_will_be_fired"),
     (party_get_slot, ":is_there_already_fire", ":village_no", slot_village_smoke_added),
     (eq, ":is_there_already_fire", 0),
	 
	 
     (try_begin),
       (party_get_slot, ":bound_center", ":village_no", slot_village_bound_center),  
       (party_get_slot, ":last_nearby_fire_time", ":bound_center", slot_town_last_nearby_fire_time),
       (store_current_hours, ":cur_hours"),
	   
	   (try_begin),
		(eq, "$cheat_mode", 1),
		(is_between, ":village_no", centers_begin, centers_end),
		(is_between, ":bound_center", centers_begin, centers_end),
		(str_store_party_name, s4, ":village_no"),
		(str_store_party_name, s5, ":bound_center"),
		(store_current_hours, reg3),
        (party_get_slot, reg4, ":bound_center", slot_town_last_nearby_fire_time),
		(display_message, "@{!}DEBUG - Checking fire at {s4} for {s5} - current time {reg3}, last nearby fire {reg4}"),
	   (try_end),
	   
	   
       (eq, ":cur_hours", ":last_nearby_fire_time"),
       (party_add_particle_system, ":village_no", "psys_map_village_fire"),
       (party_add_particle_system, ":village_no", "psys_map_village_fire_smoke"),       
     (else_try),  
       (store_add, ":last_nearby_fire_finish_time", ":last_nearby_fire_time", fire_duration),
       (eq, ":last_nearby_fire_finish_time", ":cur_hours"),
       (party_clear_particle_systems, ":village_no"),
     (try_end),  
     

   ]),
   
  (24,
   [
   (val_sub, "$g_dont_give_fief_to_player_days", 1),
   (val_max, "$g_dont_give_fief_to_player_days", -1),
   (val_sub, "$g_dont_give_marshalship_to_player_days", 1),
   (val_max, "$g_dont_give_marshalship_to_player_days", -1),

   #this to correct string errors in games started in 1.104 or before
   (party_set_name, "p_steppe_bandit_spawn_point", "str_the_steppes"),
   (party_set_name, "p_taiga_bandit_spawn_point", "str_the_tundra"),
   (party_set_name, "p_forest_bandit_spawn_point", "str_the_forests"),
   (party_set_name, "p_mountain_bandit_spawn_point", "str_the_highlands"),
   (party_set_name, "p_sea_raider_spawn_point_1", "str_the_coast"),
   (party_set_name, "p_sea_raider_spawn_point_2", "str_the_coast"),
   (party_set_name, "p_desert_bandit_spawn_point", "str_the_deserts"),

   
   #this to correct inappropriate home strings - Katrin to Uxkhal, Matheld to Fearichen
   (troop_set_slot, "trp_npc11", slot_troop_home, "p_town_7"),
   (troop_set_slot, "trp_npc8", slot_troop_home, "p_village_35"),
   
   (troop_set_slot, "trp_npc15", slot_troop_town_with_contacts, "p_town_20"), #durquba
   
   #this to correct linen production at villages of durquba 
   (party_set_slot, "p_village_93", slot_center_linen_looms, 0), #mazigh
   (party_set_slot, "p_village_94", slot_center_linen_looms, 0), #sekhtem
   (party_set_slot, "p_village_95", slot_center_linen_looms, 0), #qalyut
   (party_set_slot, "p_village_96", slot_center_linen_looms, 0), #tilimsal
   (party_set_slot, "p_village_97", slot_center_linen_looms, 0), #shibal zumr
   (party_set_slot, "p_village_102", slot_center_linen_looms, 0), #tamnuh
   (party_set_slot, "p_village_109", slot_center_linen_looms, 0), #habba

   (party_set_slot, "p_village_67", slot_center_fishing_fleet, 0), #Tebandra
   (party_set_slot, "p_village_5", slot_center_fishing_fleet, 15), #Kulum
   
   
   #The following scripts are to end quests which should have cancelled, but did not because of a bug
   (try_begin),
	(check_quest_active, "qst_formal_marriage_proposal"),
	(check_quest_failed, "qst_formal_marriage_proposal"),
    (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
   (try_end),
   
   (try_begin),
	(check_quest_active, "qst_lend_companion"),
	(quest_get_slot, ":giver_troop", "qst_lend_companion", slot_quest_giver_troop),
	(store_faction_of_troop, ":giver_troop_faction", ":giver_troop"),
    (store_relation, ":faction_relation", ":giver_troop_faction", "$players_kingdom"),
    (this_or_next|lt, ":faction_relation", 0),
    (neg|is_between, ":giver_troop_faction", kingdoms_begin, kingdoms_end),
    (call_script, "script_abort_quest", "qst_lend_companion", 0),
   (try_end),


   
   (try_begin),
	(is_between, "$players_kingdom", kingdoms_begin, kingdoms_end),
	(neq, "$players_kingdom", "fac_player_supporters_faction"),
    (faction_slot_eq, "$players_kingdom", slot_faction_marshall, "trp_player"),
    (val_add, "$g_player_days_as_marshal", 1),
   (else_try),
    (assign, "$g_player_days_as_marshal", 0),
   (try_end),
   
   (try_for_range, ":town", towns_begin, towns_end),
	(party_get_slot, ":days_to_completion", ":town", slot_center_player_enterprise_days_until_complete),
    (ge, ":days_to_completion", 1),
	(val_sub, ":days_to_completion", 1),
	(party_set_slot, ":town", slot_center_player_enterprise_days_until_complete, ":days_to_completion"), 
   (try_end),
    ]),
  (24,
   [
	  # Setting food bonuses in every 6 hours again and again because of a bug (we could not find its reason) which decreases especially slot_item_food_bonus slots of items to 0.
	  #Staples
      (item_set_slot, "itm_bread", slot_item_food_bonus, 8), #brought up from 4
      (item_set_slot, "itm_grain", slot_item_food_bonus, 2), #new - can be boiled as porridge
	  
	  #Fat sources - preserved
      (item_set_slot, "itm_smoked_fish", slot_item_food_bonus, 4),
      (item_set_slot, "itm_dried_meat", slot_item_food_bonus, 5),
      (item_set_slot, "itm_cheese", slot_item_food_bonus, 5),
      (item_set_slot, "itm_sausages", slot_item_food_bonus, 5),
      (item_set_slot, "itm_butter", slot_item_food_bonus, 4), #brought down from 8

	  #Fat sources - perishable
      (item_set_slot, "itm_chicken", slot_item_food_bonus, 8), #brought up from 7
      (item_set_slot, "itm_cattle_meat", slot_item_food_bonus, 7), #brought down from 7
      (item_set_slot, "itm_pork", slot_item_food_bonus, 6), #brought down from 6
	  
	  #Produce
      (item_set_slot, "itm_raw_olives", slot_item_food_bonus, 1),
      (item_set_slot, "itm_cabbages", slot_item_food_bonus, 2),
      (item_set_slot, "itm_raw_grapes", slot_item_food_bonus, 3),
      (item_set_slot, "itm_apples", slot_item_food_bonus, 4), #brought down from 5

	  #Sweet items
      (item_set_slot, "itm_raw_date_fruit", slot_item_food_bonus, 4), #brought down from 8
      (item_set_slot, "itm_honey", slot_item_food_bonus, 6), #brought down from 12
      
      (item_set_slot, "itm_wine", slot_item_food_bonus, 5),
      (item_set_slot, "itm_ale", slot_item_food_bonus, 4),
   ]),
(1, #PWS - Parabellum Weather Simulation
	[
#Randomly changing temperatures of uttermost points 
	(store_random_in_range, ":random", -2, 3),
	(val_add, "$pws_equatorward_temperature", ":random"),
	(store_random_in_range, ":random", -2, 3),
	(val_add, "$pws_poleward_temperature", ":random"),
	(val_clamp, "$pws_equatorward_temperature", 15, 36),
	(val_clamp, "$pws_poleward_temperature", -35, -14),
#Difference of temperature of uttermost points affects speed of changing pressure
	(store_sub, ":global_temperature_difference", "$pws_equatorward_temperature", "$pws_poleward_temperature"), #global_temperature_difference varies from 30 to 70
	(store_div, ":pressure_change_speed1", ":global_temperature_difference", 20),
	(store_sub, ":pressure_change_speed2", 0, ":pressure_change_speed1"),
	(val_add, ":pressure_change_speed1", 1),
	(store_random_in_range, ":random", ":pressure_change_speed2", ":pressure_change_speed1"),
	(val_add, "$pws_n_pressure", ":random"),
	(store_random_in_range, ":random", ":pressure_change_speed2", ":pressure_change_speed1"),
	(val_add, "$pws_m_pressure", ":random"),
	(store_random_in_range, ":random", ":pressure_change_speed2", ":pressure_change_speed1"),
	(val_add, "$pws_s_pressure", ":random"),
	(val_clamp, "$pws_n_pressure", 960, 1036),
	(val_clamp, "$pws_m_pressure", 960, 1036),
	(val_clamp, "$pws_s_pressure", 960, 1036),
#Difference of pressures in different regions and difference of temperature of uttermost points form wind speed
	(store_sub, ":n_to_m_pressure_difference", "$pws_n_pressure", "$pws_m_pressure"), #pressure_difference varies from 0 to 75
	(store_sub, ":m_to_s_pressure_difference", "$pws_m_pressure", "$pws_s_pressure"),
	(call_script, "script_get_modulus_of_value", ":n_to_m_pressure_difference"), (assign, ":n_to_m_pressure_difference", reg0),
	(call_script, "script_get_modulus_of_value", ":m_to_s_pressure_difference"), (assign, ":m_to_s_pressure_difference", reg0),
	(assign, "$pws_n_rawwind", ":n_to_m_pressure_difference"),
	(assign, "$pws_s_rawwind", ":m_to_s_pressure_difference"),
	(store_add, "$pws_m_rawwind", ":n_to_m_pressure_difference", ":m_to_s_pressure_difference"),
	(val_div, "$pws_m_rawwind", 2),
	(val_add, "$pws_n_rawwind", ":global_temperature_difference"),
	(val_add, "$pws_m_rawwind", ":global_temperature_difference"),
	(val_add, "$pws_s_rawwind", ":global_temperature_difference"),
	(val_sub, "$pws_n_rawwind", 25),
	(val_sub, "$pws_m_rawwind", 25),
	(val_sub, "$pws_s_rawwind", 25),
	(val_div, "$pws_n_rawwind", 2),
	(val_div, "$pws_m_rawwind", 2),
	(val_div, "$pws_s_rawwind", 2),
	(assign, "$pws_n_wind", "$pws_n_rawwind"),
	(assign, "$pws_m_wind", "$pws_m_rawwind"),
	(assign, "$pws_s_wind", "$pws_s_rawwind"),
	(store_random_in_range, ":random", -6, 7),
	(val_add, "$pws_n_wind", ":random"),
	(store_random_in_range, ":random", -6, 7),
	(val_add, "$pws_m_wind", ":random"),
	(store_random_in_range, ":random", -6, 7),
	(val_add, "$pws_s_wind", ":random"),
	(val_clamp, "$pws_n_wind", 1, 66),
	(val_clamp, "$pws_m_wind", 1, 66),
	(val_clamp, "$pws_s_wind", 1, 66),
	(val_clamp, "$pws_n_rawwind", 0, 61),
	(val_clamp, "$pws_m_rawwind", 0, 61),
	(val_clamp, "$pws_s_rawwind", 0, 61),
#Randomly changing humidity
	(store_random_in_range, ":random", -4, 4),
	(val_add, "$pws_n_humidity", ":random"),
	(store_random_in_range, ":random", -4, 4),
	(val_add, "$pws_m_humidity", ":random"),
	(store_random_in_range, ":random", -4, 4),
	(val_add, "$pws_s_humidity", ":random"),
	(val_clamp, "$pws_n_humidity", 30, 101),
	(val_clamp, "$pws_m_humidity", 20, 101),
	(val_clamp, "$pws_s_humidity", 1, 61),
#Humidity forms cloudiness, and wind speed affects cloudiness changing speed
	(store_div, ":cloudiness_changing_speed1", "$pws_n_wind", 4),
	(store_sub, ":cloudiness_changing_speed2", 0, ":cloudiness_changing_speed1"),
	(val_add, ":cloudiness_changing_speed1", 1),
	(store_sub, ":n_humidity_surrogate", "$pws_n_humidity", 20),
	(store_div, ":cloudiness_changing_speed_humidity_coef", ":n_humidity_surrogate", 20),
	(val_add, ":cloudiness_changing_speed_humidity_coef", -1),
	(val_add, ":cloudiness_changing_speed1", ":cloudiness_changing_speed_humidity_coef"),
	(val_add, ":cloudiness_changing_speed2", ":cloudiness_changing_speed_humidity_coef"),
		(try_begin),
		(gt, "$pws_n_clouds", ":n_humidity_surrogate"),
		(store_sub, ":cloudiness_humidity_difference_coef", "$pws_n_humidity", "$pws_n_clouds"),
		(val_div, ":cloudiness_humidity_difference_coef", 20),
		(val_add, ":cloudiness_changing_speed1", ":cloudiness_humidity_difference_coef"),
		(val_add, ":cloudiness_changing_speed2", ":cloudiness_humidity_difference_coef"),
		(try_end),
	(store_random_in_range, ":random", ":cloudiness_changing_speed2", ":cloudiness_changing_speed1"),
	(val_add, "$pws_n_clouds", ":random"),
	(store_div, ":cloudiness_changing_speed1", "$pws_m_wind", 4),
	(store_sub, ":cloudiness_changing_speed2", 0, ":cloudiness_changing_speed1"),
	(val_add, ":cloudiness_changing_speed1", 1),
	(store_sub, ":m_humidity_surrogate", "$pws_m_humidity", 19),
	(store_div, ":cloudiness_changing_speed_humidity_coef", ":m_humidity_surrogate", 20),
	(val_add, ":cloudiness_changing_speed_humidity_coef", -1),
	(val_add, ":cloudiness_changing_speed1", ":cloudiness_changing_speed_humidity_coef"),
	(val_add, ":cloudiness_changing_speed2", ":cloudiness_changing_speed_humidity_coef"),
		(try_begin),
		(gt, "$pws_m_clouds", ":m_humidity_surrogate"),
		(store_sub, ":cloudiness_humidity_difference_coef", "$pws_m_humidity", "$pws_m_clouds"),
		(val_div, ":cloudiness_humidity_difference_coef", 20),
		(val_add, ":cloudiness_changing_speed1", ":cloudiness_humidity_difference_coef"),
		(val_add, ":cloudiness_changing_speed2", ":cloudiness_humidity_difference_coef"),
		(try_end),
	(store_random_in_range, ":random", ":cloudiness_changing_speed2", ":cloudiness_changing_speed1"),
	(val_add, "$pws_m_clouds", ":random"),
	(store_div, ":cloudiness_changing_speed1", "$pws_s_wind", 4),
	(store_sub, ":cloudiness_changing_speed2", 0, ":cloudiness_changing_speed1"),
	(val_add, ":cloudiness_changing_speed1", 1),
	(store_div, ":cloudiness_changing_speed_humidity_coef", "$pws_n_humidity", 20),
	(val_add, ":cloudiness_changing_speed_humidity_coef", -1),
	(val_add, ":cloudiness_changing_speed1", ":cloudiness_changing_speed_humidity_coef"),
	(val_add, ":cloudiness_changing_speed2", ":cloudiness_changing_speed_humidity_coef"),
		(try_begin),
		(gt, "$pws_s_clouds", "$pws_s_humidity"),
		(store_sub, ":cloudiness_humidity_difference_coef", "$pws_s_humidity", "$pws_s_clouds"),
		(val_div, ":cloudiness_humidity_difference_coef", 33),
		(val_add, ":cloudiness_changing_speed1", ":cloudiness_humidity_difference_coef"),
		(val_add, ":cloudiness_changing_speed2", ":cloudiness_humidity_difference_coef"),
		(try_end),
	(store_random_in_range, ":random", ":cloudiness_changing_speed2", ":cloudiness_changing_speed1"),
	(val_add, "$pws_s_clouds", ":random"),
	(val_clamp, "$pws_n_clouds", 0, 101),
	(val_clamp, "$pws_m_clouds", 0, 101),
	(val_clamp, "$pws_s_clouds", 0, 101),
#Humidity affects precipitation
	(store_random_in_range, ":random", -2, 1),
	(val_add, "$pws_n_precipitation", ":random"),
	(store_random_in_range, ":random", 0, "$pws_n_humidity"),
	(val_div, ":random", 15),
	(val_add, "$pws_n_precipitation", ":random"),
	(store_random_in_range, ":random", -2, 1),
	(val_add, "$pws_m_precipitation", ":random"),
	(store_random_in_range, ":random", 0, "$pws_m_humidity"),
	(val_div, ":random", 20),
	(val_add, "$pws_m_precipitation", ":random"),
	(val_clamp, "$pws_n_precipitation", 0, 101),
	(val_clamp, "$pws_m_precipitation", 0, 101),
	(assign, "$pws_s_precipitation", 0),
#Randomly changing temperature. Cloudiness and wind reduce temperature
	(store_add, ":temperature_reduce", "$pws_n_rawwind", "$pws_n_clouds"),
	(val_add, ":temperature_reduce", "$pws_n_precipitation"),
	(val_div, ":temperature_reduce", 35),
	(store_random_in_range, ":random", -1, 2),
	(val_add, "$pws_n_rawtemperature", ":random"),
	(val_clamp, "$pws_n_rawtemperature", 10, 36),
	(store_sub, "$pws_n_temperature", "$pws_n_rawtemperature", ":temperature_reduce"),
	(val_clamp, "$pws_n_temperature", 0, 26),
	(store_add, ":temperature_reduce", "$pws_m_rawwind", "$pws_m_clouds"),
	(val_add, ":temperature_reduce", "$pws_m_precipitation"),
	(val_div, ":temperature_reduce", 35),
	(store_random_in_range, ":random", -1, 2),
	(val_add, "$pws_m_rawtemperature", ":random"),
	(val_clamp, "$pws_m_rawtemperature", 14, 42),
	(store_sub, "$pws_m_temperature", "$pws_m_rawtemperature", ":temperature_reduce"),
	(val_clamp, "$pws_m_temperature", 5, 26),
	(store_add, ":temperature_reduce", "$pws_s_rawwind", "$pws_s_clouds"),
	(val_add, ":temperature_reduce", "$pws_s_precipitation"),
	(val_div, ":temperature_reduce", 35),
	(store_random_in_range, ":random", -1, 2),
	(val_add, "$pws_s_rawtemperature", ":random"),
	(val_clamp, "$pws_s_rawtemperature", 17, 46),
	(store_sub, "$pws_s_temperature", "$pws_s_rawtemperature", ":temperature_reduce"),
	(val_clamp, "$pws_s_temperature", 10, 31),
	(assign, "$pws_n_actualtemperature", "$pws_n_temperature"),
	(assign, "$pws_m_actualtemperature", "$pws_m_temperature"),
	(assign, "$pws_s_actualtemperature", "$pws_s_temperature"),

#Apply increasing/decreasing of temperature depending on month
	(assign, ":month_coef", "$pws_month"),
		(try_begin),
		(gt, ":month_coef", 7),
		(store_sub, ":month_coef", 14, ":month_coef"), # 8 -> 6, 9 -> 5, 10 -> 4
		(try_end),
	(val_add, ":month_coef", -4), #month_coef varies from -3 to 3
	(val_mul, ":month_coef", 3),
	(val_add, "$pws_n_actualtemperature", ":month_coef"),
	(val_add, "$pws_m_actualtemperature", ":month_coef"),
	(val_add, "$pws_s_actualtemperature", ":month_coef"),
#Apply decreasing of temperature depending on hour
	(store_time_of_day, ":hours_coef"),
		(try_begin),
		(this_or_next|is_between, ":hours_coef", 16, 17+1),
		(is_between, ":hours_coef", 11, 14+1),
		(store_random_in_range, ":hours_coef", -2, 0),
		(else_try),
		(this_or_next|is_between, ":hours_coef", 17, 19+1),
		(is_between, ":hours_coef", 9, 11+1),
		(store_random_in_range, ":hours_coef", -4, -2),
		(else_try),
		(this_or_next|is_between, ":hours_coef", 19, 21+1),
		(is_between, ":hours_coef", 7, 9+1),
		(store_random_in_range, ":hours_coef", -6, -4),
		(else_try),
		(this_or_next|is_between, ":hours_coef", 21, 24+1),
		(is_between, ":hours_coef", 4, 7+1),
		(store_random_in_range, ":hours_coef", -8, -6),
		(else_try),
		(this_or_next|is_between, ":hours_coef", 0, 2+1),
		(is_between, ":hours_coef", 3, 4+1),
		(store_random_in_range, ":hours_coef", -10, -8),
		(else_try),
		(assign, ":hours_coef", 0),
		(try_end),
	(val_add, "$pws_n_actualtemperature", ":hours_coef"),
	(val_add, "$pws_m_actualtemperature", ":hours_coef"),
	(val_add, "$pws_s_actualtemperature", ":hours_coef"),
	(val_clamp, "$pws_n_actualtemperature", -1, 36),
	(val_clamp, "$pws_m_actualtemperature", -1, 36),
	(val_clamp, "$pws_s_actualtemperature", 5, 36),
	
	
(assign, "$killed_agents_count", 0),
	
# (assign, reg0, "$pws_n_actualtemperature"),
# (assign, reg1, "$pws_n_pressure"),
# (assign, reg2, "$pws_n_humidity"),
# (assign, reg3, "$pws_n_wind"),
# (assign, reg4, "$pws_n_clouds"),
# (assign, reg5, "$pws_n_precipitation"),
# (display_message, "@Temperature: +{reg0} C Pressure: {reg1} hPa Humidity: {reg2}% Wind: {reg3} km/h Cloudiness: {reg4}% Precipitation: {reg5}%"),
	]),
	
  (24,
   []),
  (24,
   []),
  (24,
   []),
  (24,
   []),
  (24,
   []),
  (24,
   []),
  (24,
   []),
   
   
   ## ZZ Custom Kingdom Troops begin
    (0,
    [
(party_get_current_terrain, ":terrain_type", "p_main_party"),
(try_begin),
(this_or_next|eq, ":terrain_type", rt_water),
(this_or_next|eq, ":terrain_type", rt_mountain),
(this_or_next|eq, ":terrain_type", rt_plain),
(this_or_next|eq, ":terrain_type", rt_mountain_forest),
(this_or_next|eq, ":terrain_type", rt_bridge),
(eq, ":terrain_type", rt_forest),
(assign, "$current_wind", "$pws_n_wind"),
(assign, "$current_clouds", "$pws_n_clouds"),
(assign, "$current_precipitation", "$pws_n_precipitation"),
(else_try),
(this_or_next|eq, ":terrain_type", rt_steppe),
(eq, ":terrain_type", rt_steppe_forest),
(assign, "$current_wind", "$pws_m_wind"),
(assign, "$current_clouds", "$pws_m_clouds"),
(assign, "$current_precipitation", "$pws_m_precipitation"),
(else_try),
(assign, "$current_wind", "$pws_s_wind"),
(assign, "$current_clouds", "$pws_s_clouds"),
(assign, "$current_precipitation", "$pws_s_precipitation"),
(eq, "$current_wind", "$current_wind"),
(try_end),
(assign,"$g_battle_type", battle_type_nobattle),
      (map_free),
      (troop_get_inventory_slot, ":item", "trp_kingdom_inventory", 10),
      (eq,":item","itm_velvet"),
      (try_for_range, ":troop", custom_troop_begin,  trp_array_a+6),
			(try_begin),
			(eq, ":troop", trp_array_a),
			(assign, ":troop", "trp_factionplayer_fieldgun_cannoneer_officer"),
			(else_try),
			(eq, ":troop", trp_array_a+1),
			(assign, ":troop", "trp_factionplayer_howitzer_cannoneer_officer"),
			(else_try),
			(eq, ":troop", trp_array_a+2),
			(assign, ":troop", "trp_factionplayer_heavyhowitzer_cannoneer_officer"),
			(else_try),
			(eq, ":troop", trp_array_a+3),
			(assign, ":troop", "trp_factionplayer_fieldgun_cannoneer"),
			(else_try),
			(eq, ":troop", trp_array_a+4),
			(assign, ":troop", "trp_factionplayer_howitzer_cannoneer"),
			(else_try),
			(eq, ":troop", trp_array_a+5),
			(assign, ":troop", "trp_factionplayer_mgoperator"),
			(try_end),
			(try_begin),
			(is_between, ":troop", custom_troop_begin,  custom_troop_end),
			(store_sub,":offset",":troop",custom_troop_begin),	
			(else_try),
			(eq, ":troop", "trp_factionplayer_fieldgun_cannoneer_officer"),
			(assign, ":offset", 10),
			(else_try),
			(eq, ":troop", "trp_factionplayer_howitzer_cannoneer_officer"),
			(assign, ":offset", 11),
			(else_try),
			(eq, ":troop", "trp_factionplayer_heavyhowitzer_cannoneer_officer"),
			(assign, ":offset", 12),
			(else_try),
			(eq, ":troop", "trp_factionplayer_fieldgun_cannoneer"),
			(assign, ":offset", 13),
			(else_try),
			(eq, ":troop", "trp_factionplayer_howitzer_cannoneer"),
			(assign, ":offset", 14),
			(else_try),
			(eq, ":troop", "trp_factionplayer_mgoperator"),
			(assign, ":offset", 15),
			(try_end),
		(val_mul,":offset",10),	
		(try_for_range, ":i_slot", 0, 9),
			(store_add,":slot_no",":i_slot",":offset"),		
			(troop_get_slot,":item", "trp_kingdom_inventory", ":slot_no"),
			(gt,":item",0),
			(troop_set_inventory_slot,":troop", ":i_slot",":item"),
		(try_end),
	  (try_end),
      (try_for_range, ":troop", custom_troop_begin,  trp_array_a+6),
		(try_begin),
		(eq, ":troop", trp_array_a),
		(assign, ":troop", "trp_factionplayer_fieldgun_cannoneer_officer"),
		(else_try),
		(eq, ":troop", trp_array_a+1),
		(assign, ":troop", "trp_factionplayer_howitzer_cannoneer_officer"),
		(else_try),
		(eq, ":troop", trp_array_a+2),
		(assign, ":troop", "trp_factionplayer_heavyhowitzer_cannoneer_officer"),
		(else_try),
		(eq, ":troop", trp_array_a+3),
		(assign, ":troop", "trp_factionplayer_fieldgun_cannoneer"),
		(else_try),
		(eq, ":troop", trp_array_a+4),
		(assign, ":troop", "trp_factionplayer_howitzer_cannoneer"),
		(else_try),
		(eq, ":troop", trp_array_a+5),
		(assign, ":troop", "trp_factionplayer_mgoperator"),
		(try_end),
		(try_begin),
		(is_between, ":troop", custom_troop_begin,  custom_troop_end),
		(store_sub,":offset",":troop","trp_kingdom_recruit"),
		(else_try),
		(eq, ":troop", "trp_factionplayer_fieldgun_cannoneer_officer"),
		(assign, ":offset", 10),
		(else_try),
		(eq, ":troop", "trp_factionplayer_howitzer_cannoneer_officer"),
		(assign, ":offset", 11),
		(else_try),
		(eq, ":troop", "trp_factionplayer_heavyhowitzer_cannoneer_officer"),
		(assign, ":offset", 12),
		(else_try),
		(eq, ":troop", "trp_factionplayer_fieldgun_cannoneer"),
		(assign, ":offset", 13),
		(else_try),
		(eq, ":troop", "trp_factionplayer_howitzer_cannoneer"),
		(assign, ":offset", 14),
		(else_try),
		(eq, ":troop", "trp_factionplayer_mgoperator"),
		(assign, ":offset", 15),
		(try_end),
          (store_add,":faction_troop_name","fac_culture_1",":offset"),
          (str_store_faction_name,s2,":faction_troop_name"),
	   (troop_set_name, ":troop", s2),
	   (troop_set_plural_name, ":troop", s2),
	  (try_end),
      (troop_clear_inventory, "trp_kingdom_inventory"),
    ]
  ),
 
(24,[
      (try_for_range, ":center_no", centers_begin, centers_end),
        (store_faction_of_party, ":now_faction", ":center_no"),
        (faction_get_slot, ":culture", ":now_faction", slot_faction_culture),
        (party_set_slot, ":center_no", slot_center_culture,  ":culture"),
      (try_end),
]), 
## ZZ Custom Kingdom Troops end
   
(24,[
	(try_for_range, ":faction", npc_kingdoms_begin, npc_kingdoms_end),
	(faction_slot_eq, ":faction", slot_faction_state, sfs_active),
		(try_for_range, ":slot_technology", slot_faction_technology_modernattack, slot_faction_technology_modernattack + faction_technologies_number),
		(store_add, ":slot_technology_preset", ":slot_technology", faction_technology_preset_year),
		(faction_get_slot, ":technology_progress", ":faction", ":slot_technology"),
		(faction_get_slot, ":technology_preset_year", ":faction", ":slot_technology_preset"),
		(faction_get_slot, ":literacy", ":faction", slot_faction_literacy),
		(neq, ":technology_preset_year", -1),
		(neq, ":technology_progress", 10000),
		(ge, "$g_current_year", ":technology_preset_year"),
		(assign, ":chance", 1000),
		(val_div, ":chance", "$g_game_speed"),
			(try_begin),
			(le, ":literacy", 1000),
			(val_div, ":chance", 2),
			(try_end),
		(store_random_in_range, ":random", 1, 3001),
		(lt, ":random", ":chance"),
		(faction_set_slot, ":faction",  ":slot_technology", 10000),
			(try_begin),
			# (this_or_next|is_between, ":slot_technology", slot_faction_technology_riflesconverted, slot_faction_technology_riflesboltaction+1),
			# (eq, ":slot_technology", slot_faction_technology_skirmishline),
			(assign, ":string_name", "str_faction_technology_modernattack_name"),
			(store_sub, ":slot_number", ":slot_technology", slot_faction_technology_modernattack),
			(val_add, ":string_name", ":slot_number"), (val_add, ":string_name", ":slot_number"),
			(str_store_string, s2, ":string_name"),
			(str_store_faction_name, s1, ":faction"), (display_message, "@The {s1} has finished researching technology '{s2}'.", 0x8ae2ff),
			(try_end),
		(try_end),
	(try_end),
]), 
(24,[
	(try_begin),
	(lt, "$g_days_until_next_year", 0),
	(assign, "$g_days_until_next_year", "$g_game_speed"),
	(try_end),
(val_sub, "$g_days_until_next_year", 1),
(val_clamp, "$g_days_until_next_year", 0, "$g_game_speed"),
(eq, "$g_days_until_next_year", 0),
(assign, "$g_days_until_next_year", "$g_game_speed"),
(val_add, "$g_current_year", 1),
(assign, reg0, "$g_current_year"),
(display_message, "@The year is {reg0}.", 0x8ae2ff),
]), 

(4,[
	(try_for_range, ":faction", "fac_player_faction", kingdoms_end),
	(faction_get_slot, ":current_research_technology", ":faction", slot_faction_current_research_technology),
	(neq, ":current_research_technology", -1),
	(faction_get_slot, ":current_research_technology_progress", ":faction", ":current_research_technology"),
	(store_div, ":progress_add", 525, "$g_game_speed"),
	(val_add, ":current_research_technology_progress", ":progress_add"),
	(val_clamp, ":current_research_technology_progress", 0, 10001),
	(faction_set_slot, ":faction",  ":current_research_technology", ":current_research_technology_progress"),
		(try_begin),
		(eq, ":current_research_technology_progress", 10000),
		(faction_set_slot, ":faction",  slot_faction_current_research_technology, -1),
			(try_begin),
			(this_or_next|eq, ":faction", "fac_player_faction"),
			(eq, ":faction", "$players_kingdom"),
			(assign, reg20, ":current_research_technology"),
			(assign, reg21, 1),
			(jump_to_menu, "mnu_tech_invented"),
			(try_end),
		(try_end),
	(try_end),
]), 

(0.001,
[
(map_free),

# (party_get_position, pos1, "p_main_party"),
# (set_fixed_point_multiplier, 100),
# (position_get_x, reg1, pos1),
# (position_get_y, reg2, pos1),
# (display_message, "@x {reg1} y {reg2}"),

(val_add, "$async_randomly_start_war_peace_new_cur_kingdom_2", 1),
	(try_begin),
	(gt, "$async_randomly_start_war_peace_new_cur_kingdom_2", kingdoms_end),
	(assign, "$async_randomly_start_war_peace_new_cur_kingdom_2", kingdoms_begin),
	(val_add, "$async_randomly_start_war_peace_new_cur_kingdom", 1),
	(try_end),
	(try_begin),
	(gt, "$async_randomly_start_war_peace_new_cur_kingdom", kingdoms_end),
	(assign, "$async_randomly_start_war_peace_new_cur_kingdom", "fac_kingdom_1"),
	(try_end),
(val_clamp, "$async_randomly_start_war_peace_new_cur_kingdom", kingdoms_begin, kingdoms_end),
(val_clamp, "$async_randomly_start_war_peace_new_cur_kingdom_2", kingdoms_begin, kingdoms_end),
(call_script, "script_async_randomly_start_war_peace_new", 1),
(call_script, "script_create_random_provocation"),
(call_script, "script_create_random_relation_increasing"),
(call_script, "script_create_random_alliance"),
	(try_begin),
	(le, "$player_faction_preset", 0),
	(call_script, "script_player_faction_troops"),
	(try_end),
]),

(1,
[
	(try_begin), # Player unificating Germany as Prussia
	(check_quest_active, "qst_prussia_unification_defeat_denmark"),
	(store_faction_of_party, ":faction", "p_castle_256"),
	(eq, ":faction", "fac_player_supporters_faction"),
	(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "fac_kingdom_18"),
	(this_or_next|faction_slot_eq, "fac_kingdom_18", slot_faction_state, sfs_inactive),
	(neq, reg0, -2),
	(complete_quest, "qst_prussia_unification_defeat_denmark"),
	(assign, "$prussia_unification_progress", 2),
	(try_end),
	(try_begin),
	(check_quest_active, "qst_prussia_unification_defeat_austria"),
	(store_faction_of_party, ":faction", "p_town_46"), (eq, ":faction", "fac_player_supporters_faction"),
	(store_faction_of_party, ":faction", "p_castle_162"), (eq, ":faction", "fac_player_supporters_faction"),
	(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "fac_kingdom_3"),
	(this_or_next|faction_slot_eq, "fac_kingdom_3", slot_faction_state, sfs_inactive),
	(neq, reg0, -2),
	(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "fac_kingdom_27"),
	(this_or_next|faction_slot_eq, "fac_kingdom_27", slot_faction_state, sfs_inactive),
	(neq, reg0, -2),
	(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "fac_kingdom_30"),
	(this_or_next|faction_slot_eq, "fac_kingdom_30", slot_faction_state, sfs_inactive),
	(neq, reg0, -2),
	(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "fac_kingdom_31"),
	(this_or_next|faction_slot_eq, "fac_kingdom_31", slot_faction_state, sfs_inactive),
	(neq, reg0, -2),
	(complete_quest, "qst_prussia_unification_defeat_austria"),
	(assign, "$prussia_unification_progress", 4),
	#form north german confederation
	(faction_set_name, "fac_player_supporters_faction", "@North German Confederation"),
	(call_script, "script_change_faction_flag", "fac_player_supporters_faction", 36),
	(call_script, "script_faction_annex_faction", "fac_player_supporters_faction", "fac_kingdom_27", 50),
	(call_script, "script_faction_annex_faction", "fac_player_supporters_faction", "fac_kingdom_31", 50),
	(call_script, "script_give_center_to_faction", "p_castle_162", "fac_kingdom_30"), (party_set_slot, "p_castle_162", slot_center_official_faction, "fac_kingdom_30"),
	(jump_to_menu, "mnu_prussia_unification_austria_defeated"),
	(try_end),
	(try_begin),
	(check_quest_active, "qst_prussia_unification_defeat_france"),
	(store_faction_of_party, ":faction", "p_castle_151"), (eq, ":faction", "fac_player_supporters_faction"),
	(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", "fac_player_supporters_faction", "fac_kingdom_1"),
	(this_or_next|faction_slot_eq, "fac_kingdom_1", slot_faction_state, sfs_inactive),
	(neq, reg0, -2),
	(complete_quest, "qst_prussia_unification_defeat_france"),
	(assign, "$prussia_unification_progress", 6),
	#form german empire
	(call_script, "script_faction_annex_faction", "fac_player_supporters_faction", "fac_kingdom_30", 50),
	(faction_set_name, "fac_player_supporters_faction", "@German Empire"),
	(jump_to_menu, "mnu_prussia_unification_france_defeated"),
	(try_end),
	(try_begin), # Player unificating Italy
	(check_quest_active, "qst_italy_unification_defeat_sardinia"),
	(store_faction_of_party, ":faction", "p_town_11"),
	(eq, ":faction", "fac_player_supporters_faction"),
	(store_add, ":slot_war_damage_suffered", "fac_kingdom_4", slot_faction_war_damage_inflicted_on_factions_begin),
	(val_sub, ":slot_war_damage_suffered", kingdoms_begin),
	(faction_get_slot, ":war_damage_suffered", "fac_player_supporters_faction", ":slot_war_damage_suffered"),
	(this_or_next|faction_slot_eq, "fac_kingdom_4", slot_faction_state, sfs_inactive),
	(ge, ":war_damage_suffered", 90),
	(call_script, "script_faction_annex_faction", "fac_player_supporters_faction", "fac_kingdom_4", 50),
	(complete_quest, "qst_italy_unification_defeat_sardinia"),
	(str_store_faction_name, s31, "fac_player_supporters_faction"),
	(str_store_faction_name, s32, "fac_kingdom_4"),
	(str_store_troop_name, s33, "trp_player"),
	(jump_to_menu,"mnu_italian_unification"),
		(try_begin),
		(eq, "$player_faction_preset", "fac_kingdom_11"),
		(neg|check_quest_active, "qst_italy_unification_defeat_papalstates"),
		(faction_set_name, "fac_player_supporters_faction", "@Kingdom of Italy"),
		(call_script, "script_change_faction_flag", "fac_player_supporters_faction", 39),
		(else_try),
		(eq, "$player_faction_preset", "fac_kingdom_19"),
		(neg|check_quest_active, "qst_italy_unification_defeat_sicily"),
		(faction_set_name, "fac_player_supporters_faction", "@Kingdom of Italy"),
		(call_script, "script_change_faction_flag", "fac_player_supporters_faction", 38),
		(try_end),
	(try_end),
	(try_begin),
	(check_quest_active, "qst_italy_unification_defeat_sicily"),
	(store_faction_of_party, ":faction", "p_town_23"),
	(eq, ":faction", "fac_player_supporters_faction"),
	(store_add, ":slot_war_damage_suffered", "fac_kingdom_11", slot_faction_war_damage_inflicted_on_factions_begin),
	(val_sub, ":slot_war_damage_suffered", kingdoms_begin),
	(faction_get_slot, ":war_damage_suffered", "fac_player_supporters_faction", ":slot_war_damage_suffered"),
	(this_or_next|faction_slot_eq, "fac_kingdom_11", slot_faction_state, sfs_inactive),
	(ge, ":war_damage_suffered", 80),
	(call_script, "script_faction_annex_faction", "fac_player_supporters_faction", "fac_kingdom_11", 50),
	(complete_quest, "qst_italy_unification_defeat_sicily"),
	(str_store_faction_name, s31, "fac_player_supporters_faction"),
	(str_store_faction_name, s32, "fac_kingdom_11"),
	(str_store_troop_name, s33, "trp_player"),
	(jump_to_menu,"mnu_italian_unification"),
		(try_begin),
		(eq, "$player_faction_preset", "fac_kingdom_4"),
		(neg|check_quest_active, "qst_italy_unification_defeat_papalstates"),
		(faction_set_name, "fac_player_supporters_faction", "@Kingdom of Italy"),
		(else_try),
		(eq, "$player_faction_preset", "fac_kingdom_19"),
		(neg|check_quest_active, "qst_italy_unification_defeat_sardinia"),
		(faction_set_name, "fac_player_supporters_faction", "@Kingdom of Italy"),
		(call_script, "script_change_faction_flag", "fac_player_supporters_faction", 38),
		(try_end),
	(try_end),
	(try_begin),
	(check_quest_active, "qst_italy_unification_defeat_papalstates"),
	(store_faction_of_party, ":faction", "p_town_40"),
	(eq, ":faction", "fac_player_supporters_faction"),
	(store_add, ":slot_war_damage_suffered", "fac_kingdom_19", slot_faction_war_damage_inflicted_on_factions_begin),
	(val_sub, ":slot_war_damage_suffered", kingdoms_begin),
	(faction_get_slot, ":war_damage_suffered", "fac_player_supporters_faction", ":slot_war_damage_suffered"),
	(this_or_next|faction_slot_eq, "fac_kingdom_19", slot_faction_state, sfs_inactive),
	(ge, ":war_damage_suffered", 60),
	(call_script, "script_faction_annex_faction", "fac_player_supporters_faction", "fac_kingdom_19", 50),
	(complete_quest, "qst_italy_unification_defeat_papalstates"),
	(str_store_faction_name, s31, "fac_player_supporters_faction"),
	(str_store_faction_name, s32, "fac_kingdom_19"),
	(str_store_troop_name, s33, "trp_player"),
	(jump_to_menu,"mnu_italian_unification"),
		(try_begin),
		(eq, "$player_faction_preset", "fac_kingdom_4"),
		(neg|check_quest_active, "qst_italy_unification_defeat_sicily"),
		(faction_set_name, "fac_player_supporters_faction", "@Kingdom of Italy"),
		(else_try),
		(eq, "$player_faction_preset", "fac_kingdom_11"),
		(neg|check_quest_active, "qst_italy_unification_defeat_sardinia"),
		(faction_set_name, "fac_player_supporters_faction", "@Kingdom of Italy"),
		(call_script, "script_change_faction_flag", "fac_player_supporters_faction", 39),
		(try_end),
	(try_end),

	(try_begin), # AI unificating Italy
	(neq, "$player_faction_preset", "fac_kingdom_4"),
	(neq, "$player_faction_preset", "fac_kingdom_11"),
	(neq, "$player_faction_preset", "fac_kingdom_19"),
	(store_faction_of_party, ":faction", "p_town_11"),
		(try_begin),
		(eq, ":faction", "fac_kingdom_11"),
		(faction_slot_eq, "fac_kingdom_4", slot_faction_state, sfs_active),
		(call_script, "script_faction_annex_faction", "fac_kingdom_11", "fac_kingdom_4", 0),
		(str_store_faction_name, s31, "fac_kingdom_11"),
		(str_store_faction_name, s32, "fac_kingdom_4"),
		(str_store_troop_name, s33, "trp_kingdom_11_lord"),
		(jump_to_menu,"mnu_italian_unification"),
		(else_try),
		(eq, ":faction", "fac_kingdom_19"),
		(faction_slot_eq, "fac_kingdom_4", slot_faction_state, sfs_active),
		(call_script, "script_faction_annex_faction", "fac_kingdom_19", "fac_kingdom_4", 0),
		(str_store_faction_name, s31, "fac_kingdom_19"),
		(str_store_faction_name, s32, "fac_kingdom_4"),
		(str_store_troop_name, s33, "trp_kingdom_19_lord"),
		(jump_to_menu,"mnu_italian_unification"),
		(try_end),
	(store_faction_of_party, ":faction", "p_town_23"),
		(try_begin),
		(eq, ":faction", "fac_kingdom_4"),
		(faction_slot_eq, "fac_kingdom_11", slot_faction_state, sfs_active),
		(call_script, "script_faction_annex_faction", "fac_kingdom_4", "fac_kingdom_11", 0),
		(str_store_faction_name, s31, "fac_kingdom_4"),
		(str_store_faction_name, s32, "fac_kingdom_11"),
		(str_store_troop_name, s33, "trp_kingdom_4_lord"),
		(jump_to_menu,"mnu_italian_unification"),
		(else_try),
		(eq, ":faction", "fac_kingdom_19"),
		(faction_slot_eq, "fac_kingdom_11", slot_faction_state, sfs_active),
		(call_script, "script_faction_annex_faction", "fac_kingdom_19", "fac_kingdom_11", 0),
		(str_store_faction_name, s31, "fac_kingdom_19"),
		(str_store_faction_name, s32, "fac_kingdom_11"),
		(str_store_troop_name, s33, "trp_kingdom_19_lord"),
		(jump_to_menu,"mnu_italian_unification"),
		(try_end),
	(store_faction_of_party, ":faction", "p_town_40"),
		(try_begin),
		(eq, ":faction", "fac_kingdom_4"),
		(faction_slot_eq, "fac_kingdom_19", slot_faction_state, sfs_active),
		(call_script, "script_faction_annex_faction", "fac_kingdom_4", "fac_kingdom_19", 0),
		(str_store_faction_name, s31, "fac_kingdom_4"),
		(str_store_faction_name, s32, "fac_kingdom_19"),
		(str_store_troop_name, s33, "trp_kingdom_4_lord"),
		(jump_to_menu,"mnu_italian_unification"),
		(else_try),
		(eq, ":faction", "fac_kingdom_11"),
		(faction_slot_eq, "fac_kingdom_19", slot_faction_state, sfs_active),
		(call_script, "script_faction_annex_faction", "fac_kingdom_11", "fac_kingdom_19", 0),
		(str_store_faction_name, s31, "fac_kingdom_11"),
		(str_store_faction_name, s32, "fac_kingdom_19"),
		(str_store_troop_name, s33, "trp_kingdom_11_lord"),
		(jump_to_menu,"mnu_italian_unification"),
		(try_end),
		(try_begin),
		(faction_slot_eq, "fac_kingdom_11", slot_faction_state, sfs_inactive),
		(faction_slot_eq, "fac_kingdom_19", slot_faction_state, sfs_inactive),
		(faction_set_name, "fac_kingdom_4", "@Kingdom of Italy"),
		(else_try),
		(faction_slot_eq, "fac_kingdom_4", slot_faction_state, sfs_inactive),
		(faction_slot_eq, "fac_kingdom_19", slot_faction_state, sfs_inactive),
		(faction_set_name, "fac_kingdom_11", "@Kingdom of Italy"),
		(call_script, "script_change_faction_flag", "fac_kingdom_11", 39),
		(else_try),
		(faction_slot_eq, "fac_kingdom_4", slot_faction_state, sfs_inactive),
		(faction_slot_eq, "fac_kingdom_11", slot_faction_state, sfs_inactive),
		(faction_set_name, "fac_kingdom_19", "@Kingdom of Italy"),
		(call_script, "script_change_faction_flag", "fac_kingdom_11", 38),
		(try_end),
	(try_end),

]),

(72, # Decreasing infamy over time
[
	(try_for_range, ":faction_no", kingdoms_begin, kingdoms_end),
	(faction_get_slot, ":infamy", ":faction_no", slot_faction_infamy),
	(gt, ":infamy", 0),
	(call_script, "script_faction_change_infamy", ":faction_no", -1),
	(try_end),
]),

(0.8, # Faction relation improvement going # Casus belli generation going
[
	(val_clamp, "$async_simple_trigger25", kingdoms_begin, kingdoms_end),
	(val_add, "$async_simple_trigger25", 1),
	(try_begin),	
	(ge, "$async_simple_trigger25", kingdoms_end),
	(assign, "$async_simple_trigger25", kingdoms_begin),
	(try_end),
	(try_begin),
	(assign, ":faction", "$async_simple_trigger25"),
	(faction_get_slot, ":faction_casus_belli_target", ":faction", slot_faction_casus_belli_target),
	(faction_get_slot, ":faction_casus_belli_progress", ":faction", slot_faction_casus_belli_progress),
		(try_begin),
		(is_between, ":faction_casus_belli_target", kingdoms_begin, kingdoms_end),
		(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction", ":faction_casus_belli_target"),
		(eq, reg0, 0),
		(lt, reg60, 1),
		(val_add, ":faction_casus_belli_progress", 16),
		(faction_set_slot, ":faction", slot_faction_casus_belli_progress, ":faction_casus_belli_progress"),
			(try_begin),
			(ge, ":faction_casus_belli_progress", 100),
			(faction_set_slot, ":faction", slot_faction_casus_belli_target, 0),
			(faction_set_slot, ":faction", slot_faction_casus_belli_progress, 0),
			(str_store_faction_name, s31, ":faction"),
			(str_store_faction_name, s32, ":faction_casus_belli_target"),
			(store_random_in_range, ":days", 10, 15),
			(assign, reg10, ":days"),
			(store_add, ":provocation_slot", ":faction_casus_belli_target", slot_faction_provocation_days_with_factions_begin), (val_sub, ":provocation_slot", kingdoms_begin),
			(faction_set_slot, ":faction", ":provocation_slot", ":days"),
			(display_message, "@{s31} created a casus belli for {s32} for {reg10} days."),
			(this_or_next|eq, ":faction", "fac_player_supporters_faction"),
			(eq, ":faction_casus_belli_target", "fac_player_supporters_faction"),
				(try_begin),
				(call_script, "script_cf_random", 25),
				(jump_to_menu,"mnu_provocation_created1"),
				(else_try),
				(call_script, "script_cf_random", 33),
				(jump_to_menu,"mnu_provocation_created2"),
				(else_try),
				(call_script, "script_cf_random", 50),
				(jump_to_menu,"mnu_provocation_created3"),
				(else_try),
				(jump_to_menu,"mnu_provocation_created4"),
				(try_end),
			(faction_get_slot, ":infamy", ":faction_casus_belli_target", slot_faction_infamy),
			(val_clamp, ":infamy", 0, 50+1),
			(val_div, ":infamy", 5),
				(try_begin),
				(assign, ":infamy_penalty", 10),
				(val_sub, ":infamy_penalty", ":infamy"),
				(try_end),
			(call_script, "script_faction_change_infamy", ":faction", ":infamy_penalty"),
			(try_end),
		(try_end),
	(faction_get_slot, ":faction_improve_relations_target", ":faction", slot_faction_improve_relations_target),
	(faction_get_slot, ":faction_improve_relations_progress", ":faction", slot_faction_improve_relations_progress),
	(is_between, ":faction_improve_relations_target", kingdoms_begin, kingdoms_end),
		(try_begin),
		(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction", ":faction_improve_relations_target"),
		(eq, reg0, 0),
		(lt, reg60, 1),
		(store_relation, ":relation", ":faction", ":faction_improve_relations_target"),
		(val_add, ":relation", 2),
		(val_add, ":faction_improve_relations_progress", 10),
			(try_begin),
			(eq, ":faction", "fac_player_supporters_faction"),
			(le, ":relation", 50),
			(call_script, "script_change_player_relation_with_faction_ex", ":faction_improve_relations_target", 2),
			(else_try),
			(eq, ":faction_improve_relations_target", "fac_player_supporters_faction"),
			(le, ":relation", 50),
			(call_script, "script_change_player_relation_with_faction_ex", ":faction", 2),
			(else_try),
			(le, ":relation", 50),
			(set_relation, ":faction", ":faction_improve_relations_target", ":relation"),
			(set_relation, ":faction_improve_relations_target", ":faction", ":relation"),
			(try_end),
		(faction_set_slot, ":faction", slot_faction_improve_relations_progress, ":faction_improve_relations_progress"),
			(try_begin),
			(ge, ":faction_improve_relations_progress", 100),
			(faction_set_slot, ":faction", slot_faction_improve_relations_target, 0),
			(faction_set_slot, ":faction", slot_faction_improve_relations_progress, 0),
			(eq, ":faction", "fac_player_supporters_faction"),
			(str_store_faction_name, s31, ":faction_improve_relations_target"),
			(display_message, "@Finished improving relations with {s31}."),
			(try_end),
		(else_try),
		(faction_set_slot, ":faction", slot_faction_improve_relations_target, 0),
		(faction_set_slot, ":faction", slot_faction_improve_relations_progress, 0),
		(eq, ":faction", "fac_player_supporters_faction"),
		(str_store_faction_name, s31, ":faction_improve_relations_target"),
		(display_message, "@Interrupted improving relations with {s31}."),
		(try_end),
	(try_end),
]),

(0.1, # Faction supporting allies
[
	(val_clamp, "$async_simple_trigger26", kingdoms_begin, kingdoms_end),
	(val_add, "$async_simple_trigger26", 1),
	(try_begin),	
	(ge, "$async_simple_trigger26", kingdoms_end),
	(assign, "$async_simple_trigger26", kingdoms_begin),
	(try_end),
	(try_begin),
	(assign, ":faction1", "$async_simple_trigger26"),
	(faction_slot_eq, ":faction1", slot_faction_state, sfs_active),
		(try_for_range, ":faction2", kingdoms_begin, kingdoms_end),
		(faction_slot_eq, ":faction2", slot_faction_state, sfs_active),
		(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction1", ":faction2"),
		(eq, reg0, 0),
		(gt, reg60, 0),
		(assign, ":break_alliance", 0),
			(try_for_range, ":faction3", kingdoms_begin, kingdoms_end),
			(neq, ":faction1", "fac_player_supporters_faction"),
			(faction_slot_eq, ":faction3", slot_faction_state, sfs_active),
			(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction2", ":faction3"),
			(eq, reg0, -2),
			(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction1", ":faction3"),
			(neq, reg0, -2),
			(neq, reg0, 1),
				(try_begin),
				(call_script, "script_cf_if_faction_decides_to_support_ally_against_enemy", ":faction1", ":faction2", ":faction3"),
				(else_try),
				(assign, ":break_alliance", 1),
				(try_end),
			(try_end),
			(try_for_range, ":faction3", kingdoms_begin, kingdoms_end),
			(faction_slot_eq, ":faction3", slot_faction_state, sfs_active),
			(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction2", ":faction3"),
			(eq, reg0, -2),
			(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction1", ":faction3"),
			(neq, reg0, -2),
			(neq, reg0, 1),
				(try_begin),
				(eq, ":faction1", "fac_player_supporters_faction"),
				(faction_get_slot, ":faction_leader", ":faction2", slot_faction_leader),
				(str_store_faction_name, s31, ":faction2"),
				(str_store_faction_name, s32, ":faction3"),
				(str_store_troop_name, s33, ":faction_leader"),
				(assign, reg10, ":faction2"),
				(assign, reg11, ":faction3"),
				(jump_to_menu, "mnu_alliance_support_ally_in_war"),
				(else_try),
					(try_begin),
					(eq, ":break_alliance", 0),
					(store_add, ":provocation_slot", ":faction3", slot_faction_provocation_days_with_factions_begin),
					(val_sub, ":provocation_slot", kingdoms_begin),
					(faction_set_slot, ":faction1", ":provocation_slot", 10),
					(assign, "$war_supports_allies", 1),
					(str_store_faction_name, s31, ":faction2"),
					(call_script, "script_diplomacy_start_war_between_kingdoms", ":faction1", ":faction3", 1),
					(assign, "$war_supports_allies", 0),
					(store_add, ":provocation_slot", ":faction3", slot_faction_days_of_war_with_faction_before_pressure_begin),
					(val_sub, ":provocation_slot", kingdoms_begin),
					(faction_set_slot, ":faction1", ":provocation_slot", 500),
					(else_try),
					(call_script, "script_break_alliance_between_factions", ":faction1", ":faction2"),
					(faction_get_slot, ":ally_infamy", ":faction2", slot_faction_infamy), (val_div, ":ally_infamy", 2),
					(store_sub, ":infamy_penalty", 15, ":ally_infamy"),
					(call_script, "script_faction_change_infamy", ":faction1", ":infamy_penalty"),
					(try_end),
				(try_end),
			(try_end),
		(try_end),
	(try_end),
]),

(0.001, # Refreshing faction diplomacy prices
[
	(val_clamp, "$async_simple_trigger27", npc_kingdoms_begin, npc_kingdoms_end),
	(val_add, "$async_simple_trigger27", 1),
	(try_begin),	
	(ge, "$async_simple_trigger27", npc_kingdoms_end),
	(assign, "$async_simple_trigger27", npc_kingdoms_begin),
	(try_end),
	(try_begin),
	(assign, ":faction", "$async_simple_trigger27"),
	(call_script, "script_faction_recalculate_strength", ":faction"),
	(faction_slot_eq, ":faction", slot_faction_state, sfs_active),
	(faction_get_slot, ":number_of_armies", ":faction", slot_faction_num_armies),
	(faction_get_slot, ":number_of_castles", ":faction", slot_faction_num_castles),
	(faction_get_slot, ":number_of_towns", ":faction", slot_faction_num_towns),
	(val_mul, ":number_of_castles", 3),
	(val_mul, ":number_of_towns", 5),
	(store_add, ":modifier", ":number_of_armies", ":number_of_castles"),
	(val_add, ":modifier", ":number_of_towns"),
	(set_fixed_point_multiplier, 1),
	(val_mul, ":modifier", 10),
	(store_sqrt, ":modifier", ":modifier"),
	(store_mul, ":alliance_price", ":modifier", 360),
	(store_mul, ":increase_relations_price", ":modifier", 150),
	(faction_set_slot, ":faction", slot_faction_alliance_price, ":alliance_price"),
	(faction_set_slot, ":faction", slot_faction_increase_relations_price, ":increase_relations_price"),
	(try_end),
]),

(3, # Decreasing relations
[
	(val_clamp, "$async_simple_trigger28", npc_kingdoms_begin, npc_kingdoms_end),
	(val_add, "$async_simple_trigger28", 1),
	(try_begin),	
	(ge, "$async_simple_trigger28", npc_kingdoms_end),
	(assign, "$async_simple_trigger28", npc_kingdoms_begin),
	(try_end),
	(try_begin),
	(assign, ":faction1", "$async_simple_trigger28"),
	(faction_slot_eq, ":faction1", slot_faction_state, sfs_active),
		(try_for_range, ":faction2", kingdoms_begin, kingdoms_end),
		(faction_slot_eq, ":faction2", slot_faction_state, sfs_active),
		(call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":faction1", ":faction2"),
		(eq, reg0, 0),
		(store_relation, ":relation", ":faction1", ":faction2"),
		(store_relation, ":relation_old", ":faction1", ":faction2"),
		(faction_get_slot, ":ally_infamy", ":faction2", slot_faction_infamy),
		(val_clamp, ":ally_infamy", 0, 30+1),
		(val_div, ":ally_infamy", -10),
			(try_begin),
			(eq, ":ally_infamy", 0),
			(call_script, "script_cf_random", 3),
			(assign, ":ally_infamy", -1),
			(try_end),
		(val_add, ":relation", ":ally_infamy"),
			(try_begin),
			(gt, ":relation_old", 60),
			(val_max, ":relation", 60),
			(try_end),
		(val_max, ":relation", 0),
			(try_begin),
			(eq, ":faction2", "fac_player_supporters_faction"),
			(ge, ":relation_old", 3),
			(call_script, "script_change_player_relation_with_faction_ex", ":faction1", ":ally_infamy"),
			(else_try),
			(set_relation, ":faction1", ":faction2", ":relation"),
			(set_relation),
		(try_end),
	(try_end),
]),

  (0,
   [
	(val_clamp, "$async_simple_trigger31", npc_kingdoms_begin, npc_kingdoms_end),
	(val_add, "$async_simple_trigger31", 1),
	(try_begin),	
	(ge, "$async_simple_trigger31", npc_kingdoms_end),
	(assign, "$async_simple_trigger31", npc_kingdoms_begin),
	(try_end),
	(try_begin),
	(assign, ":faction", "$async_simple_trigger31"),
	(assign, ":tech_faction", "$async_simple_trigger31"),
		(try_begin),
		(eq, ":faction", "fac_kingdom_24"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_24"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesconverted, 10000),
		(troop_has_item_equipped, "trp_faction24_troop1", "itm_els_hat2a"),
		(troop_remove_item, "trp_faction24_troop1", "itm_els_hat2a"), (troop_remove_item, "trp_faction24_troop1", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop1", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop2", "itm_els_hat2a"), (troop_remove_item, "trp_faction24_troop2", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop2", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop3", "itm_els_hat2a"), (troop_remove_item, "trp_faction24_troop3", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop3", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop4", "itm_els_hat2a"), (troop_remove_item, "trp_faction24_troop4", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop4", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop5", "itm_els_hat2b"), (troop_remove_item, "trp_faction24_troop5", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop5", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop6", "itm_els_hat2b"), (troop_remove_item, "trp_faction24_troop6", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop6", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop7", "itm_els_hat2b"), (troop_remove_item, "trp_faction24_troop7", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop7", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop8", "itm_els_hat2c"), (troop_remove_item, "trp_faction24_troop8", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop8", "itm_els_trousers1"),
		(troop_remove_item, "trp_faction24_troop9", "itm_els_hat2c"), (troop_remove_item, "trp_faction24_troop9", "itm_els_infantry1"), (troop_remove_item, "trp_faction24_troop9", "itm_els_trousers1"),
		(troop_add_items, "trp_faction24_troop1", "itm_els_hat3", 1), (troop_add_items, "trp_faction24_troop1", "itm_els_infantry2", 1), (troop_add_items, "trp_faction24_troop1", "itm_els_trousers2", 1),
		(troop_add_items, "trp_faction24_troop2", "itm_els_hat3", 1), (troop_add_items, "trp_faction24_troop2", "itm_els_infantry2", 1), (troop_add_items, "trp_faction24_troop2", "itm_els_trousers2", 1),
		(troop_add_items, "trp_faction24_troop3", "itm_els_hat3", 1), (troop_add_items, "trp_faction24_troop3", "itm_els_infantry2", 1), (troop_add_items, "trp_faction24_troop3", "itm_els_trousers2", 1),
		(troop_add_items, "trp_faction24_troop4", "itm_els_hat3", 1), (troop_add_items, "trp_faction24_troop4", "itm_els_infantry2", 1), (troop_add_items, "trp_faction24_troop4", "itm_els_trousers2", 1),
		(troop_add_items, "trp_faction24_troop5", "itm_els_hat3", 1), (troop_add_items, "trp_faction24_troop5", "itm_els_infantry3", 1), (troop_add_items, "trp_faction24_troop5", "itm_els_trousers2", 1),
		(troop_add_items, "trp_faction24_troop6", "itm_els_hat3", 1), (troop_add_items, "trp_faction24_troop6", "itm_els_infantry3", 1), (troop_add_items, "trp_faction24_troop6", "itm_els_trousers2", 1),
		(troop_add_items, "trp_faction24_troop7", "itm_els_hat3", 1), (troop_add_items, "trp_faction24_troop7", "itm_els_infantry3", 1), (troop_add_items, "trp_faction24_troop7", "itm_els_trousers2", 1),
		(troop_add_items, "trp_faction24_troop8", "itm_els_hat4", 1), (troop_add_items, "trp_faction24_troop8", "itm_els_infantry2", 1), (troop_add_items, "trp_faction24_troop8", "itm_els_trousers3", 1),
		(troop_add_items, "trp_faction24_troop9", "itm_els_hat4", 1), (troop_add_items, "trp_faction24_troop9", "itm_els_infantry2", 1), (troop_add_items, "trp_faction24_troop9", "itm_els_trousers3", 1),
		(troop_equip_items, "trp_faction24_troop1"),
		(troop_equip_items, "trp_faction24_troop2"),
		(troop_equip_items, "trp_faction24_troop3"),
		(troop_equip_items, "trp_faction24_troop4"),
		(troop_equip_items, "trp_faction24_troop5"),
		(troop_equip_items, "trp_faction24_troop6"),
		(troop_equip_items, "trp_faction24_troop7"),
		(troop_equip_items, "trp_faction24_troop8"),
		(troop_equip_items, "trp_faction24_troop9"),
		(else_try),
		(eq, ":faction", "fac_kingdom_2"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_2"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_skirmishline, 10000),
		(troop_has_item_equipped, "trp_faction2_troop1", "itm_ria_infantry_trousers2"),
		(troop_remove_item, "trp_faction2_castleguard", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_castleguard", "itm_ria_infantry2"), (troop_remove_item, "trp_faction2_castleguard", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_prisonguard", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_prisonguard", "itm_ria_infantry2"), (troop_remove_item, "trp_faction2_prisonguard", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_troop1", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_troop1", "itm_ria_infantry2"), (troop_remove_item, "trp_faction2_troop1", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_troop2", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_troop2", "itm_ria_infantry2"), (troop_remove_item, "trp_faction2_troop2", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_troop3", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_troop3", "itm_ria_infantry2"), (troop_remove_item, "trp_faction2_troop3", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_troop4", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_troop4", "itm_ria_infantry2"), (troop_remove_item, "trp_faction2_troop4", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_troop5", "itm_ria_infantry_trousers1"), (troop_remove_item, "trp_faction2_troop5", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_troop5", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_troop6", "itm_ria_infantry_trousers1"), (troop_remove_item, "trp_faction2_troop6", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_troop6", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_troop7", "itm_ria_infantry_trousers3"), (troop_remove_item, "trp_faction2_troop7", "itm_ria_infantry4"), (troop_remove_item, "trp_faction2_troop7", "itm_ria_hat3"),
		(troop_remove_item, "trp_faction2_troop8", "itm_ria_infantry_trousers3"), (troop_remove_item, "trp_faction2_troop8", "itm_ria_infantry4"), (troop_remove_item, "trp_faction2_troop8", "itm_ria_hat3"),
		(troop_remove_item, "trp_faction2_troop9", "itm_ria_hat2"),
		(troop_remove_item, "trp_faction2_troop10", "itm_ria_hat2"),
		(troop_remove_item, "trp_faction2_troop11", "itm_ria_hat2"),
		(troop_remove_item, "trp_faction2_troop12", "itm_ria_hat2"),
		(troop_remove_item, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_hat4"),
		(troop_remove_item, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_hat4"),
		(troop_remove_item, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_hat4"),
		(troop_remove_item, "trp_faction2_howitzer_cannoneer", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_howitzer_cannoneer", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_howitzer_cannoneer", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_fieldgun_cannoneer", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_fieldgun_cannoneer", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_fieldgun_cannoneer", "itm_ria_hat1"),
		(troop_remove_item, "trp_faction2_mgoperator", "itm_ria_infantry_trousers2"), (troop_remove_item, "trp_faction2_mgoperator", "itm_ria_infantry3"), (troop_remove_item, "trp_faction2_mgoperator", "itm_ria_hat1"),
		(troop_add_items, "trp_faction2_castleguard", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_castleguard", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_castleguard", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_prisonguard", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_prisonguard", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_prisonguard", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop1", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_troop1", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_troop1", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop2", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_troop2", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_troop2", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop3", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_troop3", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_troop3", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop4", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_troop4", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_troop4", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop5", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_troop5", "itm_ria_infantry6", 1), (troop_add_items, "trp_faction2_troop5", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop6", "itm_ria_hat7", 1), (troop_add_items, "trp_faction2_troop6", "itm_ria_infantry6", 1), (troop_add_items, "trp_faction2_troop6", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop7", "itm_ria_hat6", 1), (troop_add_items, "trp_faction2_troop7", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_troop7", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_troop8", "itm_ria_hat6", 1), (troop_add_items, "trp_faction2_troop8", "itm_ria_infantry5", 1), (troop_add_items, "trp_faction2_troop8", "itm_ria_infantry_trousers4", 1),
		(troop_add_items, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_infantry_trousers4", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_infantry7", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_hat6", 1),
		(troop_add_items, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_infantry_trousers4", 1), (troop_add_items, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_infantry7", 1), (troop_add_items, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_hat6", 1),
		(troop_add_items, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_infantry_trousers4", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_infantry7", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_hat6", 1),
		(troop_add_items, "trp_faction2_howitzer_cannoneer", "itm_ria_infantry_trousers4", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer", "itm_ria_infantry7", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer", "itm_ria_hat7", 1),
		(troop_add_items, "trp_faction2_fieldgun_cannoneer", "itm_ria_infantry_trousers4", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer", "itm_ria_infantry7", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer", "itm_ria_hat7", 1),
		(troop_add_items, "trp_faction2_mgoperator", "itm_ria_infantry_trousers4", 1), (troop_add_items, "trp_faction2_mgoperator", "itm_ria_infantry7", 1), (troop_add_items, "trp_faction2_mgoperator", "itm_ria_hat7", 1),
		(troop_add_items, "trp_faction2_troop9", "itm_ria_hat6", 1),
		(troop_add_items, "trp_faction2_troop10", "itm_ria_hat6", 1),
		(troop_add_items, "trp_faction2_troop11", "itm_ria_hat8", 1),
		(troop_add_items, "trp_faction2_troop12", "itm_ria_hat8", 1),
		(troop_equip_items, "trp_faction2_troop1"),
		(troop_equip_items, "trp_faction2_troop2"),
		(troop_equip_items, "trp_faction2_troop3"),
		(troop_equip_items, "trp_faction2_troop4"),
		(troop_equip_items, "trp_faction2_troop5"),
		(troop_equip_items, "trp_faction2_troop6"),
		(troop_equip_items, "trp_faction2_troop7"),
		(troop_equip_items, "trp_faction2_troop8"),
		(troop_equip_items, "trp_faction2_troop9"),
		(troop_equip_items, "trp_faction2_troop10"),
		(troop_equip_items, "trp_faction2_troop11"),
		(troop_equip_items, "trp_faction2_troop12"),
		(troop_equip_items, "trp_faction2_prisonguard"),
		(troop_equip_items, "trp_faction2_castleguard"),
		(troop_equip_items, "trp_faction2_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction2_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction2_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction2_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction2_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction2_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_2"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_2"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_infantrymgtactics, 10000),
		(troop_has_item_equipped, "trp_faction2_troop1", "itm_ria_infantry_trousers4"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_ria_hat9b", "itm_ria_infantry10", "itm_ria_infantry_trousers5"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction2_troop1", "trp_faction3_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction2_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction2_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction2_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction2_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction2_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction2_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction2_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction2_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction2_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction2_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction2_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction2_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction2_troop1", "trp_faction3_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction2_troop1", "trp_faction2_troop5"),
			(troop_add_items, ":troop", "itm_ria_hat9", 1), (troop_add_items, ":troop", "itm_ria_infantry8", 1), (troop_add_items, ":troop", "itm_ria_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction2_troop5", "trp_faction2_troop7"),
			(troop_add_items, ":troop", "itm_ria_hat9", 1), (troop_add_items, ":troop", "itm_ria_infantry11", 1), (troop_add_items, ":troop", "itm_ria_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction2_troop7", "trp_faction2_troop9"),
			(troop_add_items, ":troop", "itm_ria_hat9", 1), (troop_add_items, ":troop", "itm_ria_infantry8", 1), (troop_add_items, ":troop", "itm_ria_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction2_troop9", "trp_faction2_troop13"),
			(troop_add_items, ":troop", "itm_ria_hat9", 1), (troop_add_items, ":troop", "itm_ria_infantry9", 1), (troop_add_items, ":troop", "itm_ria_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction2_troop13", "trp_faction2_prisonguard"),
			(troop_add_items, ":troop", "itm_ria_hat5", 1), (troop_add_items, ":troop", "itm_ria_infantry9", 1), (troop_add_items, ":troop", "itm_ria_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction2_prisonguard", "trp_faction3_troop1"),
			(troop_add_items, ":troop", "itm_ria_hat9", 1), (troop_add_items, ":troop", "itm_ria_infantry11", 1), (troop_add_items, ":troop", "itm_ria_infantry_trousers5", 1),
			(try_end),
		(troop_add_items, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_infantry_trousers5", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_infantry10", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer_officer", "itm_ria_hat9", 1),
		(troop_add_items, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_infantry_trousers5", 1), (troop_add_items, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_infantry10", 1), (troop_add_items, "trp_faction2_heavyhowitzer_cannoneer_officer", "itm_ria_hat9", 1),
		(troop_add_items, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_infantry_trousers5", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_infantry10", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer_officer", "itm_ria_hat9", 1),
		(troop_add_items, "trp_faction2_howitzer_cannoneer", "itm_ria_infantry_trousers5", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer", "itm_ria_infantry9", 1), (troop_add_items, "trp_faction2_howitzer_cannoneer", "itm_ria_hat9", 1),
		(troop_add_items, "trp_faction2_fieldgun_cannoneer", "itm_ria_infantry_trousers5", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer", "itm_ria_infantry9", 1), (troop_add_items, "trp_faction2_fieldgun_cannoneer", "itm_ria_hat9", 1),
		(troop_add_items, "trp_faction2_mgoperator", "itm_ria_infantry_trousers5", 1), (troop_add_items, "trp_faction2_mgoperator", "itm_ria_infantry9", 1), (troop_add_items, "trp_faction2_mgoperator", "itm_ria_hat9", 1),
			(try_for_range, ":troop", "trp_faction2_troop1", "trp_faction3_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction2_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction2_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction2_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction2_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction2_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction2_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_2"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_2"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_shocktroops, 10000),
		(troop_has_item_equipped, "trp_faction2_troop4", "itm_ria_hat9"),
			(try_for_range, ":troop", "trp_faction2_troop4", "trp_faction2_troop9"),
			(neq, ":troop", "trp_faction2_troop5"),
			(troop_remove_item, ":troop", "itm_ria_hat10"),
			(troop_add_items, ":troop", "itm_ria_hat10", 1),
			(troop_equip_items, ":troop"),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_7"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_7"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_modernartillery, 10000),
		(troop_has_item_equipped, "trp_faction7_troop1", "itm_baf_hat9"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_baf_hat13", "itm_baf_infantry10", "itm_baf_trousers8"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction7_troop1", "trp_faction8_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction7_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction7_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction7_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction7_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction7_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction7_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction7_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction7_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction7_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction7_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction7_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction7_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction7_troop1", "trp_faction8_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction7_troop1", "trp_faction7_troop10"),
			(troop_add_items, ":troop", "itm_baf_hat13", 1), (troop_add_items, ":troop", "itm_baf_infantry11", 1), (troop_add_items, ":troop", "itm_baf_trousers8", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction7_troop10", "trp_faction8_troop1"),
			(troop_add_items, ":troop", "itm_baf_hat13", 1), (troop_add_items, ":troop", "itm_baf_infantry10", 1), (troop_add_items, ":troop", "itm_baf_trousers8", 1),
			(try_end),
		(troop_add_items, "trp_faction7_howitzer_cannoneer_officer", "itm_baf_hat13", 1), (troop_add_items, "trp_faction7_howitzer_cannoneer_officer", "itm_baf_infantry10", 1), (troop_add_items, "trp_faction7_howitzer_cannoneer_officer", "itm_baf_trousers8", 1),
		(troop_add_items, "trp_faction7_heavyhowitzer_cannoneer_officer", "itm_baf_hat13", 1), (troop_add_items, "trp_faction7_heavyhowitzer_cannoneer_officer", "itm_baf_infantry10", 1), (troop_add_items, "trp_faction7_heavyhowitzer_cannoneer_officer", "itm_baf_trousers8", 1),
		(troop_add_items, "trp_faction7_fieldgun_cannoneer_officer", "itm_baf_hat13", 1), (troop_add_items, "trp_faction7_fieldgun_cannoneer_officer", "itm_baf_infantry10", 1), (troop_add_items, "trp_faction7_fieldgun_cannoneer_officer", "itm_baf_trousers8", 1),
		(troop_add_items, "trp_faction7_howitzer_cannoneer", "itm_baf_hat13", 1), (troop_add_items, "trp_faction7_howitzer_cannoneer", "itm_baf_infantry10", 1), (troop_add_items, "trp_faction7_howitzer_cannoneer", "itm_baf_trousers8", 1),
		(troop_add_items, "trp_faction7_fieldgun_cannoneer", "itm_baf_hat13", 1), (troop_add_items, "trp_faction7_fieldgun_cannoneer", "itm_baf_infantry10", 1), (troop_add_items, "trp_faction7_fieldgun_cannoneer", "itm_baf_trousers8", 1),
		(troop_add_items, "trp_faction7_mgoperator", "itm_baf_hat13", 1), (troop_add_items, "trp_faction7_mgoperator", "itm_baf_infantry10", 1), (troop_add_items, "trp_faction7_mgoperator", "itm_baf_trousers8", 1),
			(try_for_range, ":troop", "trp_faction7_troop1", "trp_faction8_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction7_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction7_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction7_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction7_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction7_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction7_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_7"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_7"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_gasattacks, 10000),
		(troop_has_item_equipped, "trp_faction7_troop2", "itm_baf_hat13"),
			(try_for_range, ":troop", "trp_faction7_troop2", "trp_faction8_troop1"),
			(troop_remove_item, ":troop", "itm_baf_hat13"),
			(troop_add_items, ":troop", "itm_baf_hat14", 1),
			(troop_add_items, ":troop", "itm_baf_hat15", 1),
			(troop_equip_items, ":troop"),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_5"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_5"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_gasattacks, 10000),
		(troop_has_item_equipped, "trp_faction5_troop2", "itm_pru_hat1"),
			(try_for_range, ":troop", "trp_faction5_troop2", "trp_faction6_troop1"),
			(troop_remove_item, ":troop", "itm_pru_hat1"),
			(troop_add_items, ":troop", "itm_pru_hat2", 1),
			(troop_equip_items, ":troop"),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_3"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_3"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesconverted, 10000),
		(troop_has_item_equipped, "trp_faction3_troop1", "itm_lou_infantry1"),
		(troop_remove_item, "trp_faction3_castleguard", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_castleguard", "itm_lou_infantry1"),
		(troop_remove_item, "trp_faction3_prisonguard", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_prisonguard", "itm_lou_infantry1"),
		(troop_remove_item, "trp_faction3_troop1", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_troop1", "itm_lou_infantry1"),
		(troop_remove_item, "trp_faction3_troop2", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_troop2", "itm_lou_infantry1"),
		(troop_remove_item, "trp_faction3_troop3", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_troop3", "itm_lou_infantry1"),
		(troop_remove_item, "trp_faction3_troop4", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_troop4", "itm_lou_infantry1"),
		(troop_remove_item, "trp_faction3_troop5", "itm_lou_infantry3"),
		(troop_remove_item, "trp_faction3_troop6", "itm_lou_infantry3"),
		(troop_remove_item, "trp_faction3_troop13", "itm_lou_infantry3"),
		(troop_remove_item, "trp_faction3_troop7", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_troop7", "itm_lou_infantry4"),
		(troop_remove_item, "trp_faction3_troop8", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_troop8", "itm_lou_infantry4"),
		(troop_add_items, "trp_faction3_castleguard", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_castleguard", "itm_lou_infantry5", 1),
		(troop_add_items, "trp_faction3_prisonguard", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_prisonguard", "itm_lou_infantry5", 1),
		(troop_add_items, "trp_faction3_troop1", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_troop1", "itm_lou_infantry5", 1),
		(troop_add_items, "trp_faction3_troop2", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_troop2", "itm_lou_infantry5", 1),
		(troop_add_items, "trp_faction3_troop3", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_troop3", "itm_lou_infantry5", 1),
		(troop_add_items, "trp_faction3_troop4", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_troop4", "itm_lou_infantry5", 1),
		(troop_add_items, "trp_faction3_troop5", "itm_lou_infantry7", 1),
		(troop_add_items, "trp_faction3_troop6", "itm_lou_infantry7", 1),
		(troop_add_items, "trp_faction3_troop13", "itm_lou_infantry7", 1),
		(troop_add_items, "trp_faction3_troop7", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_troop7", "itm_lou_infantry6", 1),
		(troop_add_items, "trp_faction3_troop8", "itm_lou_infantry_trousers3", 1), (troop_add_items, "trp_faction3_troop8", "itm_lou_infantry6", 1),
		(troop_equip_items, "trp_faction3_troop1"),
		(troop_equip_items, "trp_faction3_troop2"),
		(troop_equip_items, "trp_faction3_troop3"),
		(troop_equip_items, "trp_faction3_troop4"),
		(troop_equip_items, "trp_faction3_troop5"),
		(troop_equip_items, "trp_faction3_troop6"),
		(troop_equip_items, "trp_faction3_troop7"),
		(troop_equip_items, "trp_faction3_troop8"),
		(troop_equip_items, "trp_faction3_troop13"),
		(troop_equip_items, "trp_faction3_prisonguard"),
		(troop_equip_items, "trp_faction3_castleguard"),
		(else_try),
		(eq, ":faction", "fac_kingdom_3"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_3"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesboltaction, 10000),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(troop_has_item_equipped, "trp_faction3_troop1", "itm_lou_infantry5"),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_lou_hat1", "itm_lou_infantry15", "itm_lou_infantry_trousers1"),
		(troop_remove_item, "trp_faction3_castleguard", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_castleguard", "itm_lou_infantry5"), (troop_remove_item, "trp_faction3_castleguard", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_prisonguard", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_prisonguard", "itm_lou_infantry5"), (troop_remove_item, "trp_faction3_prisonguard", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_troop1", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_troop1", "itm_lou_infantry5"), (troop_remove_item, "trp_faction3_troop1", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_troop2", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_troop2", "itm_lou_infantry5"), (troop_remove_item, "trp_faction3_troop2", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_troop3", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_troop3", "itm_lou_infantry5"), (troop_remove_item, "trp_faction3_troop3", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_troop4", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_troop4", "itm_lou_infantry5"), (troop_remove_item, "trp_faction3_troop4", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_troop5", "itm_lou_infantry7"), (troop_remove_item, "trp_faction3_troop5", "itm_lou_hat3"),
		(troop_remove_item, "trp_faction3_troop6", "itm_lou_infantry7"), (troop_remove_item, "trp_faction3_troop13", "itm_lou_hat3"),
		(troop_remove_item, "trp_faction3_troop13", "itm_lou_infantry7"), (troop_remove_item, "trp_faction3_troop6", "itm_lou_hat3"),
		(troop_remove_item, "trp_faction3_troop7", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_troop7", "itm_lou_infantry6"), (troop_remove_item, "trp_faction3_troop7", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_troop8", "itm_lou_infantry_trousers3"), (troop_remove_item, "trp_faction3_troop8", "itm_lou_infantry6"), (troop_remove_item, "trp_faction3_troop8", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_infantry2"), (troop_remove_item, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_hat1"),
		(troop_remove_item, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_infantry2"), (troop_remove_item, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_hat1"),
		(troop_remove_item, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_infantry2"), (troop_remove_item, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_hat1"),
		(troop_remove_item, "trp_faction3_howitzer_cannoneer", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_howitzer_cannoneer", "itm_lou_infantry2"), (troop_remove_item, "trp_faction3_howitzer_cannoneer", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_fieldgun_cannoneer", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_fieldgun_cannoneer", "itm_lou_infantry2"), (troop_remove_item, "trp_faction3_fieldgun_cannoneer", "itm_lou_hat2"),
		(troop_remove_item, "trp_faction3_mgoperator", "itm_lou_infantry_trousers1"), (troop_remove_item, "trp_faction3_mgoperator", "itm_lou_infantry2"), (troop_remove_item, "trp_faction3_mgoperator", "itm_lou_hat2"),
		(troop_add_items, "trp_faction3_castleguard", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_castleguard", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_castleguard", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_prisonguard", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_prisonguard", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_prisonguard", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_troop1", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop1", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_troop1", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_troop2", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop2", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_troop2", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_troop3", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop3", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_troop3", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_troop4", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop4", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_troop4", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_troop5", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop5", "itm_lou_infantry9", 1),
		(troop_add_items, "trp_faction3_troop6", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop6", "itm_lou_infantry9", 1),
		(troop_add_items, "trp_faction3_troop13", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop13", "itm_lou_infantry9", 1),
		(troop_add_items, "trp_faction3_troop7", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop7", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_troop7", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_troop8", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_troop8", "itm_lou_infantry8", 1), (troop_add_items, "trp_faction3_troop8", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_cavalry_trousers1", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_infantry10", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_hat7", 1),
		(troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_cavalry_trousers1", 1), (troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_infantry10", 1), (troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_hat7", 1),
		(troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_cavalry_trousers1", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_infantry10", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_hat7", 1),
		(troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_cavalry_trousers1", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_infantry10", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_hat7", 1),
		(troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_cavalry_trousers1", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_infantry10", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_hat7", 1),
		(troop_add_items, "trp_faction3_mgoperator", "itm_lou_cavalry_trousers1", 1), (troop_add_items, "trp_faction3_mgoperator", "itm_lou_infantry10", 1), (troop_add_items, "trp_faction3_mgoperator", "itm_lou_hat7", 1),
		(troop_equip_items, "trp_faction3_troop1"),
		(troop_equip_items, "trp_faction3_troop2"),
		(troop_equip_items, "trp_faction3_troop3"),
		(troop_equip_items, "trp_faction3_troop4"),
		(troop_equip_items, "trp_faction3_troop5"),
		(troop_equip_items, "trp_faction3_troop6"),
		(troop_equip_items, "trp_faction3_troop7"),
		(troop_equip_items, "trp_faction3_troop8"),
		(troop_equip_items, "trp_faction3_troop13"),
		(troop_equip_items, "trp_faction3_prisonguard"),
		(troop_equip_items, "trp_faction3_castleguard"),
		(troop_equip_items, "trp_faction3_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction3_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction3_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_7"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_7"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesboltaction, 10000),
		(troop_has_item_equipped, "trp_faction7_troop1", "itm_baf_hat1"),
		(troop_remove_item, "trp_faction7_troop1", "itm_baf_hat1"),
		(troop_remove_item, "trp_faction7_troop2", "itm_baf_hat1"),
		(troop_remove_item, "trp_faction7_troop3", "itm_baf_hat1"),
		(troop_remove_item, "trp_faction7_troop4", "itm_baf_hat1"),
		(troop_remove_item, "trp_faction7_troop5", "itm_baf_hat2"),
		(troop_remove_item, "trp_faction7_troop6", "itm_baf_hat2"),
		(troop_remove_item, "trp_faction7_troop7", "itm_baf_hat2"),
		(troop_remove_item, "trp_faction7_troop8", "itm_baf_hat3"),
		(troop_remove_item, "trp_faction7_troop9", "itm_baf_hat3"),
		(troop_remove_item, "trp_faction7_prisonguard", "itm_baf_hat1"),
		(troop_remove_item, "trp_faction7_castleguard", "itm_baf_hat1"),
		(troop_add_items, "trp_faction7_troop1", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop2", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop3", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop4", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop5", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop6", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop7", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop8", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_troop9", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_prisonguard", "itm_baf_hat9", 1),
		(troop_add_items, "trp_faction7_castleguard", "itm_baf_hat9", 1),
		(troop_equip_items, "trp_faction7_troop1"),
		(troop_equip_items, "trp_faction7_troop2"),
		(troop_equip_items, "trp_faction7_troop3"),
		(troop_equip_items, "trp_faction7_troop4"),
		(troop_equip_items, "trp_faction7_troop5"),
		(troop_equip_items, "trp_faction7_troop6"),
		(troop_equip_items, "trp_faction7_troop7"),
		(troop_equip_items, "trp_faction7_troop8"),
		(troop_equip_items, "trp_faction7_troop9"),
		(troop_equip_items, "trp_faction7_prisonguard"),
		(troop_equip_items, "trp_faction7_castleguard"),
		(else_try),
		(eq, ":faction", "fac_kingdom_20"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_20"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesboltaction, 10000),
		(troop_has_item_equipped, "trp_faction20_troop1", "itm_baf_hat12"),
		(troop_remove_item, "trp_faction20_troop1", "itm_baf_hat12"), (troop_remove_item, "trp_faction20_troop1", "itm_baf_infantry1"), (troop_remove_item, "trp_faction20_troop1", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop2", "itm_baf_hat12"), (troop_remove_item, "trp_faction20_troop2", "itm_baf_infantry1"), (troop_remove_item, "trp_faction20_troop2", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop3", "itm_baf_hat12"), (troop_remove_item, "trp_faction20_troop3", "itm_baf_infantry1"), (troop_remove_item, "trp_faction20_troop3", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop4", "itm_baf_hat12"), (troop_remove_item, "trp_faction20_troop4", "itm_baf_infantry1"), (troop_remove_item, "trp_faction20_troop4", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop5", "itm_baf_hat12"), (troop_remove_item, "trp_faction20_troop5", "itm_baf_infantry2"), (troop_remove_item, "trp_faction20_troop5", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop6", "itm_baf_hat12"), (troop_remove_item, "trp_faction20_troop6", "itm_baf_infantry2"), (troop_remove_item, "trp_faction20_troop6", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop7", "itm_baf_hat12"), (troop_remove_item, "trp_faction20_troop7", "itm_baf_infantry2"), (troop_remove_item, "trp_faction20_troop7", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop8", "itm_baf_hat8"), (troop_remove_item, "trp_faction20_troop8", "itm_baf_infantry3"), (troop_remove_item, "trp_faction20_troop8", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop9", "itm_baf_hat8"), (troop_remove_item, "trp_faction20_troop9", "itm_baf_infantry3"), (troop_remove_item, "trp_faction20_troop9", "itm_baf_trousers1"),
		(troop_remove_item, "trp_faction20_troop10", "itm_baf_trousers3"), (troop_remove_item, "trp_faction20_troop10", "itm_baf_hat8"), (troop_remove_item, "trp_faction20_troop10", "itm_baf_cavalry2"),
		(troop_remove_item, "trp_faction20_troop11", "itm_baf_trousers3"), (troop_remove_item, "trp_faction20_troop11", "itm_baf_hat8"), (troop_remove_item, "trp_faction20_troop11", "itm_baf_cavalry2"),
		(troop_remove_item, "trp_faction20_troop12", "itm_baf_trousers2"), (troop_remove_item, "trp_faction20_troop12", "itm_baf_hat4"), (troop_remove_item, "trp_faction20_troop12", "itm_baf_cavalry1"),
		(troop_remove_item, "trp_faction20_troop13", "itm_baf_trousers2"), (troop_remove_item, "trp_faction20_troop13", "itm_baf_hat4"), (troop_remove_item, "trp_faction20_troop13", "itm_baf_cavalry1"),
		(troop_remove_item, "trp_faction20_prisonguard", "itm_baf_hat8"),
		(troop_remove_item, "trp_faction20_castleguard", "itm_baf_hat8"),
		(troop_remove_item, "trp_faction20_howitzer_cannoneer_officer", "itm_baf_hat6"), (troop_remove_item, "trp_faction20_howitzer_cannoneer_officer", "itm_baf_infantry5"), (troop_remove_item, "trp_faction20_howitzer_cannoneer_officer", "itm_baf_trousers6"),
		(troop_remove_item, "trp_faction20_heavyhowitzer_cannoneer_officer", "itm_baf_hat6"), (troop_remove_item, "trp_faction20_heavyhowitzer_cannoneer_officer", "itm_baf_infantry5"), (troop_remove_item, "trp_faction20_heavyhowitzer_cannoneer_officer", "itm_baf_trousers6"),
		(troop_remove_item, "trp_faction20_fieldgun_cannoneer_officer", "itm_baf_hat6"), (troop_remove_item, "trp_faction20_fieldgun_cannoneer_officer", "itm_baf_infantry5"), (troop_remove_item, "trp_faction20_fieldgun_cannoneer_officer", "itm_baf_trousers6"),
		(troop_remove_item, "trp_faction20_howitzer_cannoneer", "itm_baf_hat6"), (troop_remove_item, "trp_faction20_howitzer_cannoneer", "itm_baf_infantry4"), (troop_remove_item, "trp_faction20_howitzer_cannoneer", "itm_baf_trousers5"),
		(troop_remove_item, "trp_faction20_fieldgun_cannoneer", "itm_baf_hat6"), (troop_remove_item, "trp_faction20_fieldgun_cannoneer", "itm_baf_infantry4"), (troop_remove_item, "trp_faction20_fieldgun_cannoneer", "itm_baf_trousers5"),
		(troop_remove_item, "trp_faction20_mgoperator", "itm_baf_hat6"), (troop_remove_item, "trp_faction20_mgoperator", "itm_baf_infantry4"), (troop_remove_item, "trp_faction20_mgoperator", "itm_baf_trousers5"),
		(troop_add_items, "trp_faction20_troop1", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop1", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop1", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop2", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop2", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop2", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop3", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop3", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop3", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop4", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop4", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop4", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop5", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop5", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop5", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop6", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop6", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop6", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop7", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop7", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop7", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop8", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop8", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop8", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop9", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop9", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop9", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop10", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop10", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop10", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop11", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_troop11", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop11", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop12", "itm_baf_hat11", 1), (troop_add_items, "trp_faction20_troop12", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop12", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_troop13", "itm_baf_hat11", 1), (troop_add_items, "trp_faction20_troop13", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_troop13", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_prisonguard", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_prisonguard", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_prisonguard", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_castleguard", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_castleguard", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_castleguard", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_howitzer_cannoneer_officer", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_howitzer_cannoneer_officer", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_howitzer_cannoneer_officer", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_heavyhowitzer_cannoneer_officer", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_heavyhowitzer_cannoneer_officer", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_heavyhowitzer_cannoneer_officer", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_fieldgun_cannoneer_officer", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_fieldgun_cannoneer_officer", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_fieldgun_cannoneer_officer", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_howitzer_cannoneer", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_howitzer_cannoneer", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_howitzer_cannoneer", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_fieldgun_cannoneer", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_fieldgun_cannoneer", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_fieldgun_cannoneer", "itm_baf_trousers7", 1),
		(troop_add_items, "trp_faction20_mgoperator", "itm_baf_hat10", 1), (troop_add_items, "trp_faction20_mgoperator", "itm_baf_infantry7", 1), (troop_add_items, "trp_faction20_mgoperator", "itm_baf_trousers7", 1),
		(troop_equip_items, "trp_faction20_troop1"),
		(troop_equip_items, "trp_faction20_troop2"),
		(troop_equip_items, "trp_faction20_troop3"),
		(troop_equip_items, "trp_faction20_troop4"),
		(troop_equip_items, "trp_faction20_troop5"),
		(troop_equip_items, "trp_faction20_troop6"),
		(troop_equip_items, "trp_faction20_troop7"),
		(troop_equip_items, "trp_faction20_troop8"),
		(troop_equip_items, "trp_faction20_troop9"),
		(troop_equip_items, "trp_faction20_troop10"),
		(troop_equip_items, "trp_faction20_troop11"),
		(troop_equip_items, "trp_faction20_troop12"),
		(troop_equip_items, "trp_faction20_troop13"),
		(troop_equip_items, "trp_faction20_prisonguard"),
		(troop_equip_items, "trp_faction20_castleguard"),
		(troop_equip_items, "trp_faction20_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction20_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction20_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction20_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction20_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction20_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_29"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_29"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesconverted, 10000),
		(troop_has_item_equipped, "trp_faction29_troop1", "itm_sve_shako"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_sve_hat4", "itm_sve_torso_general", "itm_sve_trousers_infantry2"),
			(try_for_range, ":troop", "trp_faction29_troop1", "trp_faction29_troop9"),
			(troop_remove_item, ":troop", "itm_sve_shako"), (troop_remove_item, ":troop", "itm_sve_trousers_infantry"), (troop_add_items, ":troop", "itm_sve_hat4b", 1), (troop_add_items, ":troop", "itm_sve_trousers_infantry2", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction29_troop14", "trp_faction30_troop1"),
			(troop_remove_item, ":troop", "itm_sve_shako"), (troop_remove_item, ":troop", "itm_sve_trousers_infantry"), (troop_add_items, ":troop", "itm_sve_hat4b", 1), (troop_add_items, ":troop", "itm_sve_trousers_infantry2", 1),
			(try_end),
		(troop_remove_item, "trp_faction29_howitzer_cannoneer_officer", "itm_sve_shako"), (troop_remove_item, "trp_faction29_howitzer_cannoneer_officer", "itm_sve_trousers_infantry"), (troop_add_items, "trp_faction29_howitzer_cannoneer_officer", "itm_sve_hat4", 1), (troop_add_items, "trp_faction29_howitzer_cannoneer_officer", "itm_sve_trousers_infantry2", 1),
		(troop_remove_item, "trp_faction29_heavyhowitzer_cannoneer_officer", "itm_sve_shako"), (troop_remove_item, "trp_faction29_heavyhowitzer_cannoneer_officer", "itm_sve_trousers_infantry"), (troop_add_items, "trp_faction29_heavyhowitzer_cannoneer_officer", "itm_sve_hat4", 1), (troop_add_items, "trp_faction29_heavyhowitzer_cannoneer_officer", "itm_sve_trousers_infantry2", 1),
		(troop_remove_item, "trp_faction29_fieldgun_cannoneer_officer", "itm_sve_shako"), (troop_remove_item, "trp_faction29_fieldgun_cannoneer_officer", "itm_sve_trousers_infantry"), (troop_add_items, "trp_faction29_fieldgun_cannoneer_officer", "itm_sve_hat4", 1), (troop_add_items, "trp_faction29_fieldgun_cannoneer_officer", "itm_sve_trousers_infantry2", 1),
		(troop_remove_item, "trp_faction29_howitzer_cannoneer", "itm_sve_shako"), (troop_remove_item, "trp_faction29_howitzer_cannoneer", "itm_sve_trousers_infantry"), (troop_add_items, "trp_faction29_howitzer_cannoneer", "itm_sve_hat4b", 1), (troop_add_items, "trp_faction29_howitzer_cannoneer", "itm_sve_trousers_infantry2", 1),
		(troop_remove_item, "trp_faction29_fieldgun_cannoneer", "itm_sve_shako"), (troop_remove_item, "trp_faction29_fieldgun_cannoneer", "itm_sve_trousers_infantry"), (troop_add_items, "trp_faction29_fieldgun_cannoneer", "itm_sve_hat4b", 1), (troop_add_items, "trp_faction29_fieldgun_cannoneer", "itm_sve_trousers_infantry2", 1),
		(troop_remove_item, "trp_faction29_mgoperator", "itm_sve_shako"), (troop_remove_item, "trp_faction29_mgoperator", "itm_sve_trousers_infantry"), (troop_add_items, "trp_faction29_mgoperator", "itm_sve_hat4b", 1), (troop_add_items, "trp_faction29_mgoperator", "itm_sve_trousers_infantry2", 1),
			(try_for_range, ":troop", "trp_faction29_troop1", "trp_faction30_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction29_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction29_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction29_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction29_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction29_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction29_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_29"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_29"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesboltaction, 10000),
		(troop_has_item_equipped, "trp_faction29_troop1", "itm_sve_torso_infantry1"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_sve_hat4", "itm_sve_torso_infantry5", "itm_sve_trousers_infantry2"),
			(try_for_range, ":troop", "trp_faction29_troop1", "trp_faction30_troop1"),
			(neg|is_between, "trp_faction29_troop9", "trp_faction29_troop13"),
			(troop_get_inventory_slot, ":item", ":troop", ek_body),
			(troop_set_inventory_slot, ":troop", ek_body, -1),
			(gt, ":item", 1),
			(troop_remove_items, ":troop", ":item", 1),
			(troop_add_items, ":troop", "itm_sve_torso_infantry4", 1),
			(troop_equip_items, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction29_troop9", "trp_faction29_troop13"),
			(troop_get_inventory_slot, ":item", ":troop", ek_body),
			(troop_set_inventory_slot, ":troop", ek_body, -1),
			(gt, ":item", 1),
			(troop_remove_items, ":troop", ":item", 1),
			(troop_add_items, ":troop", "itm_sve_torso_infantry5", 1),
			(troop_equip_items, ":troop"),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_7"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_7"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_infantrymgtactics, 10000),
		(troop_has_item_equipped, "trp_faction7_troop1", "itm_baf_infantry11"),
			(try_for_range, ":troop", "trp_faction7_troop1", "trp_faction8_troop1"),
			(neg|is_between, "trp_faction7_troop10", "trp_faction7_troop14"),
			(troop_get_inventory_slot, ":item", ":troop", ek_body),
			(troop_set_inventory_slot, ":troop", ek_body, -1),
			(gt, ":item", 1),
			(troop_remove_items, ":troop", ":item", 1),
			(troop_add_items, ":troop", "itm_baf_infantry8", 1),
			(troop_equip_items, ":troop"),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_7"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_7"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_gasattacks, 10000),
		(troop_has_item_equipped, "trp_faction7_troop1", "itm_baf_infantry8"),
			(try_for_range, ":troop", "trp_faction7_troop1", "trp_faction8_troop1"),
			(neg|is_between, "trp_faction7_troop10", "trp_faction7_troop14"),
			(troop_get_inventory_slot, ":item", ":troop", ek_body),
			(troop_set_inventory_slot, ":troop", ek_body, -1),
			(gt, ":item", 1),
			(troop_remove_items, ":troop", ":item", 1),
			(troop_add_items, ":troop", "itm_baf_infantry9", 1),
			(troop_equip_items, ":troop"),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_5"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_5"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_modernartillery, 10000),
		(troop_has_item_equipped, "trp_faction5_troop1", "itm_pru_torso_infantry1"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_pru_hat5", "itm_pru_torso_infantry6", "itm_pru_trousers_infantry4"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction5_troop1", "trp_faction6_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction5_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction5_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction5_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction5_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction5_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction5_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction5_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction5_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction5_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction5_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction5_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction5_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction5_troop1", "trp_faction6_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction5_troop1", "trp_faction5_troop5"),
			(troop_add_items, ":troop", "itm_pru_hat1", 1), (troop_add_items, ":troop", "itm_pru_torso_infantry5", 1), (troop_add_items, ":troop", "itm_pru_trousers_infantry4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction5_troop5", "trp_faction5_troop7"),
			(troop_add_items, ":troop", "itm_pru_hat3", 1), (troop_add_items, ":troop", "itm_pru_torso_infantry6", 1), (troop_add_items, ":troop", "itm_pru_trousers_infantry4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction5_troop7", "trp_faction6_troop1"),
			(troop_add_items, ":troop", "itm_pru_hat1", 1), (troop_add_items, ":troop", "itm_pru_torso_infantry5", 1), (troop_add_items, ":troop", "itm_pru_trousers_infantry4", 1),
			(try_end),
		(troop_add_items, "trp_faction5_howitzer_cannoneer_officer", "itm_pru_hat5", 1), (troop_add_items, "trp_faction5_howitzer_cannoneer_officer", "itm_pru_torso_infantry6", 1), (troop_add_items, "trp_faction5_howitzer_cannoneer_officer", "itm_pru_trousers_infantry4", 1),
		(troop_add_items, "trp_faction5_heavyhowitzer_cannoneer_officer", "itm_pru_hat5", 1), (troop_add_items, "trp_faction5_heavyhowitzer_cannoneer_officer", "itm_pru_torso_infantry6", 1), (troop_add_items, "trp_faction5_heavyhowitzer_cannoneer_officer", "itm_pru_trousers_infantry4", 1),
		(troop_add_items, "trp_faction5_fieldgun_cannoneer_officer", "itm_pru_hat5", 1), (troop_add_items, "trp_faction5_fieldgun_cannoneer_officer", "itm_pru_torso_infantry6", 1), (troop_add_items, "trp_faction5_fieldgun_cannoneer_officer", "itm_pru_trousers_infantry4", 1),
		(troop_add_items, "trp_faction5_howitzer_cannoneer", "itm_pru_hat1", 1), (troop_add_items, "trp_faction5_howitzer_cannoneer", "itm_pru_torso_infantry6", 1), (troop_add_items, "trp_faction5_howitzer_cannoneer", "itm_pru_trousers_infantry4", 1),
		(troop_add_items, "trp_faction5_fieldgun_cannoneer", "itm_pru_hat1", 1), (troop_add_items, "trp_faction5_fieldgun_cannoneer", "itm_pru_torso_infantry6", 1), (troop_add_items, "trp_faction5_fieldgun_cannoneer", "itm_pru_trousers_infantry4", 1),
		(troop_add_items, "trp_faction5_mgoperator", "itm_pru_hat1", 1), (troop_add_items, "trp_faction5_mgoperator", "itm_pru_torso_infantry6", 1), (troop_add_items, "trp_faction5_mgoperator", "itm_pru_trousers_infantry4", 1),
			(try_for_range, ":troop", "trp_faction5_troop1", "trp_faction6_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction5_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction5_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction5_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction5_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction5_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction5_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_5"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_5"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_shocktroops, 10000),
		(troop_has_item_equipped, "trp_faction5_troop1", "itm_pru_torso_infantry5"),
			(try_for_range, ":troop", "trp_faction5_troop1", "trp_faction6_troop1"),
			(neg|is_between, "trp_faction5_troop5", "trp_faction5_troop7"),
			(neg|is_between, "trp_faction5_troop9", "trp_faction5_troop14"),
			(neg|is_between, "trp_faction5_prisonguard", "trp_faction6_troop1"),
				(try_begin),
				(troop_get_inventory_slot, ":item", ":troop", ek_body),
				(troop_set_inventory_slot, ":troop", ek_body, -1),
				(gt, ":item", 1),
				(troop_remove_items, ":troop", ":item", 1),
				(troop_add_items, ":troop", "itm_pru_torso_infantry7", 1),
				(troop_equip_items, ":troop"),
				(try_end),
				(try_begin),
				(troop_get_inventory_slot, ":item", ":troop", ek_foot),
				(troop_set_inventory_slot, ":troop", ek_foot, -1),
				(gt, ":item", 1),
				(troop_remove_items, ":troop", ":item", 1),
				(troop_add_items, ":troop", "itm_pru_trousers_infantry3", 1),
				(troop_equip_items, ":troop"),
				(try_end),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_1"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_1"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_cannonsbreechloading, 10000),
		(troop_has_item_equipped, "trp_faction1_troop1", "itm_fra_torso_infantry1"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_fra_hat3", "itm_fra_torso_infantry5", "itm_fra_infantry_trousers4"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction1_troop9"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
				(try_for_range, ":troop", "trp_faction1_troop13", "trp_faction2_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction1_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction1_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction1_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction1_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction1_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction1_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction2_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction1_troop5"),
			(troop_add_items, ":troop", "itm_fra_hat1", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry4", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop5", "trp_faction1_troop7"),
			(troop_add_items, ":troop", "itm_fra_hat5", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry7", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers6", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop7", "trp_faction1_troop9"),
			(troop_add_items, ":troop", "itm_fra_hat6", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry4", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop13", "trp_faction1_troop14"),
			(troop_add_items, ":troop", "itm_fra_hat5", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry7", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers6", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop14", "trp_faction2_troop1"),
			(troop_add_items, ":troop", "itm_fra_hat1", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry4", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers4", 1),
			(try_end),
		(troop_add_items, "trp_faction1_howitzer_cannoneer_officer", "itm_fra_hat3", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer_officer", "itm_fra_torso_infantry6", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer_officer", "itm_fra_infantry_trousers4", 1),
		(troop_add_items, "trp_faction1_heavyhowitzer_cannoneer_officer", "itm_fra_hat3", 1), (troop_add_items, "trp_faction1_heavyhowitzer_cannoneer_officer", "itm_fra_torso_infantry6", 1), (troop_add_items, "trp_faction1_heavyhowitzer_cannoneer_officer", "itm_fra_infantry_trousers4", 1),
		(troop_add_items, "trp_faction1_fieldgun_cannoneer_officer", "itm_fra_hat3", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer_officer", "itm_fra_torso_infantry6", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer_officer", "itm_fra_infantry_trousers4", 1),
		(troop_add_items, "trp_faction1_howitzer_cannoneer", "itm_fra_hat4", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer", "itm_fra_torso_infantry6", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer", "itm_fra_infantry_trousers4", 1),
		(troop_add_items, "trp_faction1_fieldgun_cannoneer", "itm_fra_hat4", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer", "itm_fra_torso_infantry6", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer", "itm_fra_infantry_trousers4", 1),
		(troop_add_items, "trp_faction1_mgoperator", "itm_fra_hat4", 1), (troop_add_items, "trp_faction1_mgoperator", "itm_fra_torso_infantry6", 1), (troop_add_items, "trp_faction1_mgoperator", "itm_fra_infantry_trousers4", 1),
			(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction2_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction1_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction1_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction1_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction1_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction1_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction1_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_1"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_1"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_gasattacks, 10000),
		(troop_has_item_equipped, "trp_faction1_troop1", "itm_fra_hat1"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_fra_hat2", "itm_fra_torso_infantry9", "itm_fra_infantry_trousers5"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction2_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction1_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction1_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction1_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction1_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction1_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction1_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction1_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction2_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction1_troop5"),
			(troop_add_items, ":troop", "itm_fra_hat2", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry8", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop5", "trp_faction1_troop7"),
			(troop_add_items, ":troop", "itm_fra_hat2", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry9", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop7", "trp_faction1_troop9"),
			(troop_add_items, ":troop", "itm_fra_hat2", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry8", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop9", "trp_faction1_troop14"),
			(troop_add_items, ":troop", "itm_fra_hat2", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry9", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction1_troop14", "trp_faction2_troop1"),
			(troop_add_items, ":troop", "itm_fra_hat2", 1), (troop_add_items, ":troop", "itm_fra_torso_infantry9", 1), (troop_add_items, ":troop", "itm_fra_infantry_trousers5", 1),
			(try_end),
		(troop_add_items, "trp_faction1_howitzer_cannoneer_officer", "itm_fra_hat2", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer_officer", "itm_fra_torso_infantry9", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer_officer", "itm_fra_infantry_trousers5", 1),
		(troop_add_items, "trp_faction1_heavyhowitzer_cannoneer_officer", "itm_fra_hat2", 1), (troop_add_items, "trp_faction1_heavyhowitzer_cannoneer_officer", "itm_fra_torso_infantry9", 1), (troop_add_items, "trp_faction1_heavyhowitzer_cannoneer_officer", "itm_fra_infantry_trousers5", 1),
		(troop_add_items, "trp_faction1_fieldgun_cannoneer_officer", "itm_fra_hat2", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer_officer", "itm_fra_torso_infantry9", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer_officer", "itm_fra_infantry_trousers5", 1),
		(troop_add_items, "trp_faction1_howitzer_cannoneer", "itm_fra_hat2", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer", "itm_fra_torso_infantry9", 1), (troop_add_items, "trp_faction1_howitzer_cannoneer", "itm_fra_infantry_trousers5", 1),
		(troop_add_items, "trp_faction1_fieldgun_cannoneer", "itm_fra_hat2", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer", "itm_fra_torso_infantry9", 1), (troop_add_items, "trp_faction1_fieldgun_cannoneer", "itm_fra_infantry_trousers5", 1),
		(troop_add_items, "trp_faction1_mgoperator", "itm_fra_hat2", 1), (troop_add_items, "trp_faction1_mgoperator", "itm_fra_torso_infantry9", 1), (troop_add_items, "trp_faction1_mgoperator", "itm_fra_infantry_trousers5", 1),
			(try_for_range, ":troop", "trp_faction1_troop1", "trp_faction2_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction1_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction1_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction1_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction1_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction1_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction1_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_1"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_1"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_shocktroops, 10000),
		(troop_has_item_equipped, "trp_faction1_troop2", "itm_fra_hat2"),
			(try_for_range, ":troop", "trp_faction1_troop2", "trp_faction2_troop1"),
			(troop_remove_item, ":troop", "itm_fra_hat2"),
			(troop_add_items, ":troop", "itm_fra_hat7", 1),
			(troop_equip_items, ":troop"),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_3"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_3"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_modernartillery, 10000),
		(troop_has_item_equipped, "trp_faction3_troop1", "itm_lou_infantry8"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_lou_hat6", "itm_lou_infantry16", "itm_lou_infantry_trousers4"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction4_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction3_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction3_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction3_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction3_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction3_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction3_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction4_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction3_troop5"),
			(troop_add_items, ":troop", "itm_lou_hat6", 1), (troop_add_items, ":troop", "itm_lou_infantry18", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop5", "trp_faction3_troop7"),
			(troop_add_items, ":troop", "itm_lou_hat6", 1), (troop_add_items, ":troop", "itm_lou_infantry19", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop7", "trp_faction3_troop9"),
			(troop_add_items, ":troop", "itm_lou_hat6", 1), (troop_add_items, ":troop", "itm_lou_infantry18", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop9", "trp_faction4_troop1"),
			(troop_add_items, ":troop", "itm_lou_hat6", 1), (troop_add_items, ":troop", "itm_lou_infantry17", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers4", 1),
			(try_end),
		(troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_infantry16", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_infantry16", 1), (troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_infantry16", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_infantry17", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_infantry17", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_infantry_trousers4", 1),
		(troop_add_items, "trp_faction3_mgoperator", "itm_lou_hat6", 1), (troop_add_items, "trp_faction3_mgoperator", "itm_lou_infantry17", 1), (troop_add_items, "trp_faction3_mgoperator", "itm_lou_infantry_trousers4", 1),
			(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction4_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction3_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction3_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction3_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_3"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_3"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_shocktroops, 10000),
		(troop_has_item_equipped, "trp_faction3_troop1", "itm_lou_infantry18"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_lou_hat8", "itm_lou_infantry11", "itm_lou_infantry_trousers6"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction4_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction3_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction3_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction3_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction3_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction3_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction3_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction3_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction4_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction3_troop5"),
			(troop_add_items, ":troop", "itm_lou_hat8", 1), (troop_add_items, ":troop", "itm_lou_infantry14", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop5", "trp_faction3_troop7"),
			(troop_add_items, ":troop", "itm_lou_hat8", 1), (troop_add_items, ":troop", "itm_lou_infantry13", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop7", "trp_faction3_troop9"),
			(troop_add_items, ":troop", "itm_lou_hat9", 1), (troop_add_items, ":troop", "itm_lou_infantry14", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop9", "trp_faction3_troop13"),
			(troop_add_items, ":troop", "itm_lou_hat8", 1), (troop_add_items, ":troop", "itm_lou_infantry12", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop13", "trp_faction3_troop14"),
			(troop_add_items, ":troop", "itm_lou_hat8", 1), (troop_add_items, ":troop", "itm_lou_infantry13", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction3_troop14", "trp_faction4_troop1"),
			(troop_add_items, ":troop", "itm_lou_hat8", 1), (troop_add_items, ":troop", "itm_lou_infantry12", 1), (troop_add_items, ":troop", "itm_lou_infantry_trousers5", 1),
			(try_end),
		(troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_hat8", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_infantry11", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer_officer", "itm_lou_infantry_trousers6", 1),
		(troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_hat8", 1), (troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_infantry11", 1), (troop_add_items, "trp_faction3_heavyhowitzer_cannoneer_officer", "itm_lou_infantry_trousers6", 1),
		(troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_hat8", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_infantry11", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer_officer", "itm_lou_infantry_trousers6", 1),
		(troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_hat8", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_infantry12", 1), (troop_add_items, "trp_faction3_howitzer_cannoneer", "itm_lou_infantry_trousers5", 1),
		(troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_hat8", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_infantry12", 1), (troop_add_items, "trp_faction3_fieldgun_cannoneer", "itm_lou_infantry_trousers5", 1),
		(troop_add_items, "trp_faction3_mgoperator", "itm_lou_hat8", 1), (troop_add_items, "trp_faction3_mgoperator", "itm_lou_infantry12", 1), (troop_add_items, "trp_faction3_mgoperator", "itm_lou_infantry_trousers5", 1),
			(try_for_range, ":troop", "trp_faction3_troop1", "trp_faction4_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction3_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction3_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction3_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction3_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_4"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_4"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflesconverted, 10000),
		(troop_has_item_equipped, "trp_faction4_troop1", "itm_res_hat1"),
			(try_for_range, ":troop", "trp_faction4_troop1", "trp_faction5_troop1"),
			(neg|is_between, "trp_faction4_troop5", "trp_faction4_troop8"),
			(neg|is_between, "trp_faction4_troop10", "trp_faction4_prisonguard"),
				(try_begin),
				(troop_get_inventory_slot, ":item", ":troop", ek_head),
				(troop_set_inventory_slot, ":troop", ek_head, -1),
				(gt, ":item", 1),
				(troop_remove_items, ":troop", ":item", 1),
				(troop_add_items, ":troop", "itm_res_hat6", 1),
				(troop_equip_items, ":troop"),
				(try_end),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_4"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_4"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_modernartillery, 10000),
		(troop_has_item_equipped, "trp_faction4_troop1", "itm_res_hat6"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_res_hat11", "itm_res_infantry8", "itm_res_trousers7"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction4_troop1", "trp_faction5_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction4_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction4_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction4_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction4_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction4_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction4_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction4_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction4_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction4_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction4_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction4_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction4_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction4_troop1", "trp_faction5_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction4_troop1", "trp_faction4_troop5"),
			(troop_add_items, ":troop", "itm_res_hat11", 1), (troop_add_items, ":troop", "itm_res_infantry7", 1), (troop_add_items, ":troop", "itm_res_trousers7", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction4_troop5", "trp_faction4_troop8"),
			(troop_add_items, ":troop", "itm_res_hat2", 1), (troop_add_items, ":troop", "itm_res_infantry8", 1), (troop_add_items, ":troop", "itm_res_trousers7", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction4_troop8", "trp_faction4_troop10"),
			(troop_add_items, ":troop", "itm_res_hat8", 1), (troop_add_items, ":troop", "itm_res_infantry7", 1), (troop_add_items, ":troop", "itm_res_trousers7", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction4_troop10", "trp_faction4_prisonguard"),
			(troop_add_items, ":troop", "itm_res_hat4", 1), (troop_add_items, ":troop", "itm_res_infantry8", 1), (troop_add_items, ":troop", "itm_res_trousers7", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction4_prisonguard", "trp_faction5_troop1"),
			(troop_add_items, ":troop", "itm_res_hat11", 1), (troop_add_items, ":troop", "itm_res_infantry8", 1), (troop_add_items, ":troop", "itm_res_trousers7", 1),
			(try_end),
		(troop_add_items, "trp_faction4_howitzer_cannoneer_officer", "itm_res_hat11", 1), (troop_add_items, "trp_faction4_howitzer_cannoneer_officer", "itm_res_infantry8", 1), (troop_add_items, "trp_faction4_howitzer_cannoneer_officer", "itm_res_trousers7", 1),
		(troop_add_items, "trp_faction4_heavyhowitzer_cannoneer_officer", "itm_res_hat11", 1), (troop_add_items, "trp_faction4_heavyhowitzer_cannoneer_officer", "itm_res_infantry8", 1), (troop_add_items, "trp_faction4_heavyhowitzer_cannoneer_officer", "itm_res_trousers7", 1),
		(troop_add_items, "trp_faction4_fieldgun_cannoneer_officer", "itm_res_hat11", 1), (troop_add_items, "trp_faction4_fieldgun_cannoneer_officer", "itm_res_infantry8", 1), (troop_add_items, "trp_faction4_fieldgun_cannoneer_officer", "itm_res_trousers7", 1),
		(troop_add_items, "trp_faction4_howitzer_cannoneer", "itm_res_hat11", 1), (troop_add_items, "trp_faction4_howitzer_cannoneer", "itm_res_infantry8", 1), (troop_add_items, "trp_faction4_howitzer_cannoneer", "itm_res_trousers7", 1),
		(troop_add_items, "trp_faction4_fieldgun_cannoneer", "itm_res_hat11", 1), (troop_add_items, "trp_faction4_fieldgun_cannoneer", "itm_res_infantry8", 1), (troop_add_items, "trp_faction4_fieldgun_cannoneer", "itm_res_trousers7", 1),
		(troop_add_items, "trp_faction4_mgoperator", "itm_res_hat11", 1), (troop_add_items, "trp_faction4_mgoperator", "itm_res_infantry8", 1), (troop_add_items, "trp_faction4_mgoperator", "itm_res_trousers7", 1),
			(try_for_range, ":troop", "trp_faction4_troop1", "trp_faction5_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction4_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction4_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction4_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction4_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction4_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction4_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_6"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_6"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_modernartillery, 10000),
		(troop_has_item_equipped, "trp_faction6_troop1", "itm_tur_fez4"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_tur_fez2b", "itm_tur_infantry6", "itm_tur_trousers_infantry3"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction6_troop1", "trp_faction7_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction6_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction6_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction6_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction6_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction6_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction6_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction6_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction6_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction6_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction6_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction6_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction6_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction6_troop1", "trp_faction7_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction6_troop1", "trp_faction6_troop5"),
			(troop_add_items, ":troop", "itm_tur_fez2b", 1), (troop_add_items, ":troop", "itm_tur_infantry5", 1), (troop_add_items, ":troop", "itm_tur_trousers_infantry3", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction6_troop5", "trp_faction6_troop7"),
			(troop_add_items, ":troop", "itm_tur_fez2b", 1), (troop_add_items, ":troop", "itm_tur_infantry6", 1), (troop_add_items, ":troop", "itm_tur_trousers_infantry3", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction6_troop7", "trp_faction6_troop9"),
			(troop_add_items, ":troop", "itm_tur_fez2b", 1), (troop_add_items, ":troop", "itm_tur_infantry5", 1), (troop_add_items, ":troop", "itm_tur_trousers_infantry3", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction6_troop9", "trp_faction7_troop1"),
			(troop_add_items, ":troop", "itm_tur_fez2b", 1), (troop_add_items, ":troop", "itm_tur_infantry6", 1), (troop_add_items, ":troop", "itm_tur_trousers_infantry3", 1),
			(try_end),
		(troop_add_items, "trp_faction6_howitzer_cannoneer_officer", "itm_tur_fez2b", 1), (troop_add_items, "trp_faction6_howitzer_cannoneer_officer", "itm_tur_infantry6", 1), (troop_add_items, "trp_faction6_howitzer_cannoneer_officer", "itm_tur_trousers_infantry3", 1),
		(troop_add_items, "trp_faction6_heavyhowitzer_cannoneer_officer", "itm_tur_fez2b", 1), (troop_add_items, "trp_faction6_heavyhowitzer_cannoneer_officer", "itm_tur_infantry6", 1), (troop_add_items, "trp_faction6_heavyhowitzer_cannoneer_officer", "itm_tur_trousers_infantry3", 1),
		(troop_add_items, "trp_faction6_fieldgun_cannoneer_officer", "itm_tur_fez2b", 1), (troop_add_items, "trp_faction6_fieldgun_cannoneer_officer", "itm_tur_infantry6", 1), (troop_add_items, "trp_faction6_fieldgun_cannoneer_officer", "itm_tur_trousers_infantry3", 1),
		(troop_add_items, "trp_faction6_howitzer_cannoneer", "itm_tur_fez2b", 1), (troop_add_items, "trp_faction6_howitzer_cannoneer", "itm_tur_infantry6", 1), (troop_add_items, "trp_faction6_howitzer_cannoneer", "itm_tur_trousers_infantry3", 1),
		(troop_add_items, "trp_faction6_fieldgun_cannoneer", "itm_tur_fez2b", 1), (troop_add_items, "trp_faction6_fieldgun_cannoneer", "itm_tur_infantry6", 1), (troop_add_items, "trp_faction6_fieldgun_cannoneer", "itm_tur_trousers_infantry3", 1),
		(troop_add_items, "trp_faction6_mgoperator", "itm_tur_fez2b", 1), (troop_add_items, "trp_faction6_mgoperator", "itm_tur_infantry6", 1), (troop_add_items, "trp_faction6_mgoperator", "itm_tur_trousers_infantry3", 1),
			(try_for_range, ":troop", "trp_faction6_troop1", "trp_faction7_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction6_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction6_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction6_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction6_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction6_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction6_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_6"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_6"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_lmgs, 10000),
		(troop_has_item_equipped, "trp_faction6_troop1", "itm_tur_fez2b"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_tur_hat1", "itm_tur_infantry6", "itm_tur_trousers_infantry3"),
			(try_for_range, ":troop", "trp_faction6_troop1", "trp_faction7_troop1"),
				(try_begin),
				(troop_get_inventory_slot, ":item", ":troop", ek_head),
				(troop_set_inventory_slot, ":troop", ek_head, -1),
				(gt, ":item", 1),
				(troop_remove_items, ":troop", ":item", 1),
				(troop_add_items, ":troop", "itm_tur_hat1", 1),
				(troop_equip_items, ":troop"),
				(try_end),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_6"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_6"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_shocktroops, 10000),
		(troop_has_item_equipped, "trp_faction6_troop7", "itm_tur_hat1"),
			(try_for_range, ":troop", "trp_faction6_troop7", "trp_faction6_troop9"),
				(try_begin),
				(troop_get_inventory_slot, ":item", ":troop", ek_head),
				(troop_set_inventory_slot, ":troop", ek_head, -1),
				(gt, ":item", 1),
				(troop_remove_items, ":troop", ":item", 1),
				(troop_add_items, ":troop", "itm_pru_hat2", 1),
				(troop_equip_items, ":troop"),
				(try_end),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_26"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_26"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_riflessmallcaliber, 10000),
		(troop_has_item_equipped, "trp_faction26_troop1", "itm_def_hat1"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_def_hat5", "itm_def_infantry8", "itm_def_trousers4"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction27_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction26_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction26_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction26_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction26_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction26_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction26_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction27_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction26_troop5"),
			(troop_add_items, ":troop", "itm_def_hat3", 1), (troop_add_items, ":troop", "itm_def_infantry6", 1), (troop_add_items, ":troop", "itm_def_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop5", "trp_faction26_troop8"),
			(troop_add_items, ":troop", "itm_def_hat4", 1), (troop_add_items, ":troop", "itm_def_infantry6", 1), (troop_add_items, ":troop", "itm_def_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop8", "trp_faction26_troop10"),
			(troop_add_items, ":troop", "itm_def_hat2", 1), (troop_add_items, ":troop", "itm_def_infantry6", 1), (troop_add_items, ":troop", "itm_def_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop10", "trp_faction26_troop14"),
			(troop_add_items, ":troop", "itm_def_hat9", 1), (troop_add_items, ":troop", "itm_def_infantry8", 1), (troop_add_items, ":troop", "itm_def_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop14", "trp_faction27_troop1"),
			(troop_add_items, ":troop", "itm_def_hat3", 1), (troop_add_items, ":troop", "itm_def_infantry8", 1), (troop_add_items, ":troop", "itm_def_trousers4", 1),
			(try_end),
		(troop_add_items, "trp_faction26_howitzer_cannoneer_officer", "itm_def_hat3", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer_officer", "itm_def_infantry8", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer_officer", "itm_def_trousers4", 1),
		(troop_add_items, "trp_faction26_heavyhowitzer_cannoneer_officer", "itm_def_hat3", 1), (troop_add_items, "trp_faction26_heavyhowitzer_cannoneer_officer", "itm_def_infantry8", 1), (troop_add_items, "trp_faction26_heavyhowitzer_cannoneer_officer", "itm_def_trousers4", 1),
		(troop_add_items, "trp_faction26_fieldgun_cannoneer_officer", "itm_def_hat3", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer_officer", "itm_def_infantry8", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer_officer", "itm_def_trousers4", 1),
		(troop_add_items, "trp_faction26_howitzer_cannoneer", "itm_def_hat3", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer", "itm_def_infantry8", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer", "itm_def_trousers4", 1),
		(troop_add_items, "trp_faction26_fieldgun_cannoneer", "itm_def_hat3", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer", "itm_def_infantry8", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer", "itm_def_trousers4", 1),
		(troop_add_items, "trp_faction26_mgoperator", "itm_def_hat3", 1), (troop_add_items, "trp_faction26_mgoperator", "itm_def_infantry8", 1), (troop_add_items, "trp_faction26_mgoperator", "itm_def_trousers4", 1),
			(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction27_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction26_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction26_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction26_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction26_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction26_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction26_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_26"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_26"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_lmgs, 10000),
		(troop_has_item_equipped, "trp_faction26_troop1", "itm_def_hat3"),
			(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction27_troop1"),
			(neg|is_between, ":troop", "trp_faction26_troop5", "trp_faction26_troop7"),
			(neg|is_between, ":troop", "trp_faction26_troop10", "trp_faction26_troop14"),
				(try_begin),
				(troop_get_inventory_slot, ":item", ":troop", ek_head),
				(troop_set_inventory_slot, ":troop", ek_head, -1),
				(gt, ":item", 1),
				(troop_remove_items, ":troop", ":item", 1),
				(troop_add_items, ":troop", "itm_def_hat8", 1),
				(troop_equip_items, ":troop"),
				(try_end),
			(try_end),
		(else_try),
		(eq, ":faction", "fac_kingdom_26"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_26"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_shocktroops, 10000),
		(troop_has_item_equipped, "trp_faction26_troop1", "itm_def_hat8"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_def_hat6", "itm_def_infantry7", "itm_def_trousers5"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction27_troop1"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction26_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction26_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction26_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction26_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction26_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction26_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction26_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction27_troop1"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction26_troop5"),
			(troop_add_items, ":troop", "itm_def_hat6", 1), (troop_add_items, ":troop", "itm_def_infantry7", 1), (troop_add_items, ":troop", "itm_def_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop5", "trp_faction26_troop8"),
			(troop_add_items, ":troop", "itm_def_hat7", 1), (troop_add_items, ":troop", "itm_def_infantry7", 1), (troop_add_items, ":troop", "itm_def_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop8", "trp_faction26_troop10"),
			(troop_add_items, ":troop", "itm_def_hat6", 1), (troop_add_items, ":troop", "itm_def_infantry7", 1), (troop_add_items, ":troop", "itm_def_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop10", "trp_faction26_troop14"),
			(troop_add_items, ":troop", "itm_def_hat6", 1), (troop_add_items, ":troop", "itm_def_infantry7", 1), (troop_add_items, ":troop", "itm_def_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_faction26_troop14", "trp_faction27_troop1"),
			(troop_add_items, ":troop", "itm_def_hat6", 1), (troop_add_items, ":troop", "itm_def_infantry7", 1), (troop_add_items, ":troop", "itm_def_trousers5", 1),
			(try_end),
		(troop_add_items, "trp_faction26_howitzer_cannoneer_officer", "itm_def_hat6", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer_officer", "itm_def_infantry7", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer_officer", "itm_def_trousers5", 1),
		(troop_add_items, "trp_faction26_heavyhowitzer_cannoneer_officer", "itm_def_hat6", 1), (troop_add_items, "trp_faction26_heavyhowitzer_cannoneer_officer", "itm_def_infantry7", 1), (troop_add_items, "trp_faction26_heavyhowitzer_cannoneer_officer", "itm_def_trousers5", 1),
		(troop_add_items, "trp_faction26_fieldgun_cannoneer_officer", "itm_def_hat6", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer_officer", "itm_def_infantry7", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer_officer", "itm_def_trousers5", 1),
		(troop_add_items, "trp_faction26_howitzer_cannoneer", "itm_def_hat7", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer", "itm_def_infantry7", 1), (troop_add_items, "trp_faction26_howitzer_cannoneer", "itm_def_trousers5", 1),
		(troop_add_items, "trp_faction26_fieldgun_cannoneer", "itm_def_hat7", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer", "itm_def_infantry7", 1), (troop_add_items, "trp_faction26_fieldgun_cannoneer", "itm_def_trousers5", 1),
		(troop_add_items, "trp_faction26_mgoperator", "itm_def_hat7", 1), (troop_add_items, "trp_faction26_mgoperator", "itm_def_infantry7", 1), (troop_add_items, "trp_faction26_mgoperator", "itm_def_trousers5", 1),
			(try_for_range, ":troop", "trp_faction26_troop1", "trp_faction27_troop1"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction26_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction26_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction26_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction26_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction26_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction26_mgoperator"),
		(else_try),
		(eq, ":faction", "fac_kingdom_27"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_27"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_eq, ":faction", slot_faction_flag_material, "str_flag1_40"),
		(neg|troop_has_item_equipped, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_hat3"),
		(neg|troop_has_item_equipped, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_hat5"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_bul_hat3", "itm_bul_infantry6", "itm_bul_trousers3"),
			(try_for_range, ":item_slot", 4, 8),
			(troop_set_inventory_slot, "trp_faction27_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction27_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction27_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction27_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction27_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction27_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_mgoperator"),
			(try_end),
		(troop_add_items, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_hat3", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_infantry2", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_trousers3", 1),
		(troop_add_items, "trp_faction27_heavyhowitzer_cannoneer_officer", "itm_bul_hat3", 1), (troop_add_items, "trp_faction27_heavyhowitzer_cannoneer_officer", "itm_bul_infantry2", 1), (troop_add_items, "trp_faction27_heavyhowitzer_cannoneer_officer", "itm_bul_trousers3", 1),
		(troop_add_items, "trp_faction27_fieldgun_cannoneer_officer", "itm_bul_hat3", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer_officer", "itm_bul_infantry2", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer_officer", "itm_bul_trousers3", 1),
		(troop_add_items, "trp_faction27_howitzer_cannoneer", "itm_bul_hat1", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer", "itm_bul_infantry2", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer", "itm_bul_trousers2", 1),
		(troop_add_items, "trp_faction27_fieldgun_cannoneer", "itm_bul_hat1", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer", "itm_bul_infantry2", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer", "itm_bul_trousers2", 1),
		(troop_add_items, "trp_faction27_mgoperator", "itm_bul_hat1", 1), (troop_add_items, "trp_faction27_mgoperator", "itm_bul_infantry2", 1), (troop_add_items, "trp_faction27_mgoperator", "itm_bul_trousers2", 1),
		(troop_equip_items, "trp_faction27_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction27_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction27_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction27_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction27_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction27_mgoperator"),
		(str_store_string, s1, "@Bulgarian Howitzer Crew Officer"), (str_store_string, s2, "@Bulgarian Howitzer Crew Officers"),
		(str_store_string, s3, "@Bulgarian Heavy Howitzer Crew Officer"), (str_store_string, s4, "@Bulgarian Heavy Howitzer Crew Officers"), 
		(str_store_string, s5, "@Bulgarian Field Gun Crew Officer"), (str_store_string, s6, "@Bulgarian Field Gun Crew Officers"),
		(str_store_string, s7, "@Bulgarian Howitzer Crew Cannoneer"), (str_store_string, s8, "@Bulgarian Howitzer Crew Cannoneers"),
		(str_store_string, s9, "@Bulgarian Field Gun Crew Cannoneer"), (str_store_string, s10, "@Bulgarian Field Gun Crew Cannoneers"),
		(str_store_string, s11, "@Bulgarian MG Operator"), (str_store_string, s12, "@Bulgarian MG Operator"),
		(troop_set_name, "trp_faction27_howitzer_cannoneer_officer", s1), (troop_set_plural_name, "trp_faction27_howitzer_cannoneer_officer", s2),
		(troop_set_name, "trp_faction27_heavyhowitzer_cannoneer_officer", s3), (troop_set_plural_name, "trp_faction27_heavyhowitzer_cannoneer_officer", s4),
		(troop_set_name, "trp_faction27_fieldgun_cannoneer_officer", s5), (troop_set_plural_name, "trp_faction27_fieldgun_cannoneer_officer", s6),
		(troop_set_name, "trp_faction27_howitzer_cannoneer", s7), (troop_set_plural_name, "trp_faction27_howitzer_cannoneer", s8),
		(troop_set_name, "trp_faction27_fieldgun_cannoneer", s9), (troop_set_plural_name, "trp_faction27_fieldgun_cannoneer", s10),
		(troop_set_name, "trp_faction27_mgoperator", s11), (troop_set_plural_name, "trp_faction27_mgoperator", s12),
		(else_try),
		(eq, ":faction", "fac_kingdom_27"),
			(try_begin),
			(eq, "$player_faction_preset", "fac_kingdom_27"),
			(assign, ":tech_faction", "fac_player_faction"),
			(try_end),
		(faction_slot_ge, ":tech_faction", slot_faction_technology_modernartillery, 10000),
		(troop_has_item_equipped, "trp_factionbulgaria_troop1", "itm_bul_hat4"),
			(try_begin),
			(eq, ":tech_faction", "fac_player_faction"),
			(assign, ":tech_faction", "fac_player_supporters_faction"),
			(try_end),
		(call_script, "script_uniform_progression_change_officer_clothes", ":tech_faction", "itm_bul_hat5", "itm_bul_infantry7", "itm_bul_trousers5"),
			(try_for_range, ":item_slot", 4, 8),
				(try_for_range, ":troop", "trp_factionbulgaria_troop1", "trp_looter"),
				(troop_set_inventory_slot, ":troop", ":item_slot", -1),
				(try_end),
			(troop_set_inventory_slot, "trp_faction27_howitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_howitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction27_heavyhowitzer_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_heavyhowitzer_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction27_fieldgun_cannoneer_officer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_fieldgun_cannoneer_officer"),
			(troop_set_inventory_slot, "trp_faction27_howitzer_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_howitzer_cannoneer"),
			(troop_set_inventory_slot, "trp_faction27_fieldgun_cannoneer", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_fieldgun_cannoneer"),
			(troop_set_inventory_slot, "trp_faction27_mgoperator", ":item_slot", -1), (troop_clear_inventory, "trp_faction27_mgoperator"),
			(try_end),
			(try_for_range, ":troop", "trp_factionbulgaria_troop1", "trp_looter"),
			(troop_clear_inventory, ":troop"),
			(try_end),
			(try_for_range, ":troop", "trp_factionbulgaria_troop1", "trp_factionbulgaria_troop5"),
			(troop_add_items, ":troop", "itm_bul_hat5", 1), (troop_add_items, ":troop", "itm_bul_infantry7", 1), (troop_add_items, ":troop", "itm_bul_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_factionbulgaria_troop5", "trp_factionbulgaria_troop7"),
			(troop_add_items, ":troop", "itm_bul_hat5", 1), (troop_add_items, ":troop", "itm_bul_infantry8", 1), (troop_add_items, ":troop", "itm_bul_trousers4", 1),
			(try_end),
			(try_for_range, ":troop", "trp_factionbulgaria_troop7", "trp_factionbulgaria_troop9"),
			(troop_add_items, ":troop", "itm_bul_hat6", 1), (troop_add_items, ":troop", "itm_bul_infantry9", 1), (troop_add_items, ":troop", "itm_bul_trousers5", 1),
			(try_end),
			(try_for_range, ":troop", "trp_factionbulgaria_troop9", "trp_looter"),
			(troop_add_items, ":troop", "itm_bul_hat5", 1), (troop_add_items, ":troop", "itm_bul_infantry7", 1), (troop_add_items, ":troop", "itm_bul_trousers5", 1),
			(try_end),
		(troop_add_items, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_hat5", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_infantry7", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer_officer", "itm_bul_trousers5", 1),
		(troop_add_items, "trp_faction27_heavyhowitzer_cannoneer_officer", "itm_bul_hat5", 1), (troop_add_items, "trp_faction27_heavyhowitzer_cannoneer_officer", "itm_bul_infantry7", 1), (troop_add_items, "trp_faction27_heavyhowitzer_cannoneer_officer", "itm_bul_trousers5", 1),
		(troop_add_items, "trp_faction27_fieldgun_cannoneer_officer", "itm_bul_hat5", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer_officer", "itm_bul_infantry7", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer_officer", "itm_bul_trousers5", 1),
		(troop_add_items, "trp_faction27_howitzer_cannoneer", "itm_bul_hat5", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer", "itm_bul_infantry7", 1), (troop_add_items, "trp_faction27_howitzer_cannoneer", "itm_bul_trousers4", 1),
		(troop_add_items, "trp_faction27_fieldgun_cannoneer", "itm_bul_hat5", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer", "itm_bul_infantry7", 1), (troop_add_items, "trp_faction27_fieldgun_cannoneer", "itm_bul_trousers4", 1),
		(troop_add_items, "trp_faction27_mgoperator", "itm_bul_hat5", 1), (troop_add_items, "trp_faction27_mgoperator", "itm_bul_infantry7", 1), (troop_add_items, "trp_faction27_mgoperator", "itm_bul_trousers4", 1),
			(try_for_range, ":troop", "trp_factionbulgaria_troop1", "trp_looter"),
			(troop_equip_items, ":troop"),
			(try_end),
		(troop_equip_items, "trp_faction27_howitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction27_heavyhowitzer_cannoneer_officer"),
		(troop_equip_items, "trp_faction27_fieldgun_cannoneer_officer"),
		(troop_equip_items, "trp_faction27_howitzer_cannoneer"),
		(troop_equip_items, "trp_faction27_fieldgun_cannoneer"),
		(troop_equip_items, "trp_faction27_mgoperator"),
		(try_end),
	(try_end),
    ]),

  (0,
   [
	(try_begin),	
	(le, "$async_simple_trigger32", kingdoms_end),
	(val_add, "$async_simple_trigger32", 1),
	(try_end),
(val_max, "$async_simple_trigger32", kingdoms_begin),
	(try_begin),	
	(eq, "$pps_start_new_iteration_cycle", 1),
	(assign, "$async_simple_trigger32", kingdoms_begin),
	(assign, "$pps_start_new_iteration_cycle", 0),
	(try_end),
	(try_begin),	
	(le, "$async_simple_trigger32", kingdoms_end),
	(faction_slot_eq, "$async_simple_trigger32", slot_faction_state, sfs_active),
	(call_script, "script_pps_faction_iteration", "$async_simple_trigger32"),
	(try_end),
    ]),
  (24,
   [
	(assign, "$pps_start_new_iteration_cycle", 1),
    ]),
  (0,
   [
	(try_begin),	
	(le, "$async_simple_trigger33", walled_centers_end),
	(val_add, "$async_simple_trigger33", 1),
	(try_end),
	(try_begin),	
	(eq, "$pes_start_new_iteration_cycle", 1),
	(call_script, "script_pes_iteration_start"),
	(try_end),
	(try_begin),	
	(le, "$async_simple_trigger33", walled_centers_end),
	(troop_get_slot, ":center", "trp_pes_centers", "$async_simple_trigger33"),
	(val_clamp, ":center", walled_centers_begin, walled_centers_end),
	(call_script, "script_pes_center_iteration", ":center"),
	(try_end),
    ]),
  (24,
   [
	(assign, "$pes_start_new_iteration_cycle", 1),
    ]),
	
  (0,
   [
	(val_clamp, "$async_simple_trigger34", kingdoms_begin, kingdoms_end),
	(val_add, "$async_simple_trigger34", 1),
	(try_begin),	
	(ge, "$async_simple_trigger34", kingdoms_end),
	(assign, "$async_simple_trigger34", kingdoms_begin),
	(try_end),
	(try_begin),
	(assign, ":faction", "$async_simple_trigger34"),
	(faction_slot_eq, "$async_simple_trigger34", slot_faction_state, sfs_active),
	(call_script, "script_faction_get_machineguns", ":faction"),
	(try_end),
    ]),
  (0,
   [
	(try_begin),
	(le, "$player_faction_preset", 0),
	(assign, ":finished", 0),
	(faction_set_slot, "fac_player_faction", slot_faction_troop_lineinf, "trp_kingdom_recruit"),
	(faction_set_slot, "fac_player_faction", slot_faction_troop_lightinf, "trp_kingdom_recruit"),
	(faction_set_slot, "fac_player_faction", slot_faction_troop_guardinf, "trp_kingdom_recruit"),
	(faction_set_slot, "fac_player_faction", slot_faction_troop_cav, "trp_kingdom_recruit"),
	(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_lineinf, "trp_kingdom_recruit"),
	(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_lightinf, "trp_kingdom_recruit"),
	(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_guardinf, "trp_kingdom_recruit"),
	(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_cav, "trp_kingdom_recruit"),
		(try_for_range, ":troop", "trp_kingdom_recruit", "trp_array_a"),
		(eq, ":finished", 0),
		(troop_get_slot, ":pbs_troop_type", ":troop", slot_troop_pbs_type),
		(eq, ":pbs_troop_type", pbs_troop_type_line),
		(faction_set_slot, "fac_player_faction", slot_faction_troop_lineinf, ":troop"),
		(faction_set_slot, "fac_player_faction", slot_faction_troop_lightinf, ":troop"),
		(faction_set_slot, "fac_player_faction", slot_faction_troop_guardinf, ":troop"),
		(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_lineinf, ":troop"),
		(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_lightinf, ":troop"),
		(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_guardinf, ":troop"),
		(assign, ":finished", 1),
		(try_end),
	(assign, ":finished", 0),
		(try_for_range, ":troop", "trp_kingdom_recruit", "trp_array_a"),
		(eq, ":finished", 0),
		(troop_get_slot, ":pbs_troop_type", ":troop", slot_troop_pbs_type),
		(eq, ":pbs_troop_type", pbs_troop_type_light),
		(faction_set_slot, "fac_player_faction", slot_faction_troop_lightinf, ":troop"),
		(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_lightinf, ":troop"),
		(assign, ":finished", 1),
		(try_end),
	(assign, ":finished", 0),
		(try_for_range, ":troop", "trp_kingdom_recruit", "trp_array_a"),
		(eq, ":finished", 0),
		(troop_get_slot, ":pbs_troop_type", ":troop", slot_troop_pbs_type),
		(eq, ":pbs_troop_type", pbs_troop_type_guard),
		(faction_set_slot, "fac_player_faction", slot_faction_troop_guardinf, ":troop"),
		(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_guardinf, ":troop"),
		(assign, ":finished", 1),
		(try_end),
	(assign, ":finished", 0),
		(try_for_range, ":troop", "trp_kingdom_recruit", "trp_array_a"),
		(eq, ":finished", 0),
		(troop_get_slot, ":pbs_troop_type", ":troop", slot_troop_pbs_type),
		(this_or_next|eq, ":pbs_troop_type", pbs_troop_type_cavmelee),
		(this_or_next|eq, ":pbs_troop_type", pbs_troop_type_cavranged),
		(eq, ":pbs_troop_type", pbs_troop_type_cavguard),
		(faction_set_slot, "fac_player_faction", slot_faction_troop_cav, ":troop"),
		(faction_set_slot, "fac_player_supporters_faction", slot_faction_troop_cav, ":troop"),
		(assign, ":finished", 1),
		(try_end),
	(try_end),
]),

(0.001,
[
(val_clamp, "$async_simple_trigger35", active_npcs_begin, active_npcs_end),
(val_add, "$async_simple_trigger35", 1),
	(try_begin),	
	(ge, "$async_simple_trigger35", active_npcs_end),
	(assign, "$async_simple_trigger35", active_npcs_begin),
	(try_end),
(call_script, "script_pas_ai_lord_decide", "$async_simple_trigger35"),
]),

(0.1,
[
(gt, "$pas_enlistment_lord", 0),
	(try_begin),
	(troop_get_slot, ":party", "$pas_enlistment_lord", slot_troop_leaded_party),
	(gt, ":party", 0),
	(party_is_active, ":party"),
	(set_camera_follow_party, ":party"),
	(party_relocate_near_party, "p_main_party", ":party", 0),
		(try_begin),
		(party_get_battle_opponent, ":opponent", ":party"),
		(gt, ":opponent", 0),
		(neg|troop_is_wounded, "trp_player"),
		(this_or_next|neq, "$pas_enlistment_opponent_to_ignore", ":opponent"),
		(eq, "$pas_enlistment_opponent_to_ignore_timer", 0),
		(jump_to_menu, "mnu_pas_enlistment_menu"),
		(try_end),
	(else_try),
	(jump_to_menu, "mnu_pas_enlistment_reassign"),
	(try_end),
	(try_begin),
	(gt, "$pas_enlistment_opponent_to_ignore_timer", 1),
	(val_sub, "$pas_enlistment_opponent_to_ignore_timer", 1),
	(try_end),
(set_show_messages, 0),
	(try_for_range, ":slot", 0, 10),
		(try_begin),
		(troop_get_inventory_slot, ":player_item", "trp_player", ":slot"),
		(gt, ":player_item", 1),
		(troop_remove_item, "trp_player", ":player_item"),
		(try_end),
	(troop_get_inventory_slot, ":item", "$pas_enlistment_player_troop", ":slot"),
		(try_begin),
		(ge, "$pas_enlistment_rank", 4),
		(troop_get_inventory_slot, ":item", "$pas_enlistment_lord", ":slot"),
		(try_end),
	(gt, ":item", 1),
		(try_begin),
		(call_script, "script_cf_get_faction_rifle_type", "$players_kingdom"), (assign, ":rifle_type", reg0),
		(gt, ":rifle_type", rifle_type_smoothbore),
		(store_add, ":slot_item_analog", slot_item_rifled_analog-1, ":rifle_type"),
		(item_get_slot, ":analog", ":item", ":slot_item_analog"),
		(gt, ":analog", 1),
		(assign, ":item", ":analog"),
		(try_end),
	(troop_get_inventory_slot, ":player_item", "trp_player", ":slot"),
	(troop_remove_item, "trp_player", ":player_item"),
	(troop_set_inventory_slot, "trp_player", ":slot", ":item"),
	(try_end),
(set_show_messages, 1),
]),

(0,
[
	(try_begin),
	(ge, "$g_current_year", 1914),
	(troop_set_name, "trp_kingdom_1_lord", "@President Raymond Poincare"),
	(troop_set_name, "trp_kingdom_2_lord", "@Tsar Nicholas II"),
	(troop_set_name, "trp_kingdom_3_lord", "@Kaiser Franz Joseph I"),
	(troop_set_name, "trp_kingdom_4_lord", "@King Victor Emmanuel III"),
	(troop_set_name, "trp_kingdom_5_lord", "@Kaiser Wilhelm II"),
	(troop_set_name, "trp_kingdom_6_lord", "@Sultan Mehmed V"),
	(troop_set_name, "trp_kingdom_7_lord", "@King Edward VII"),
	(troop_set_type, "trp_kingdom_7_lord", 0),
	(troop_set_name, "trp_kingdom_8_lord", "@Queen Wilhelmina"),
	(troop_set_type, "trp_kingdom_8_lord", 1),
	(else_try),
	(ge, "$g_current_year", 1907),
	(troop_set_name, "trp_kingdom_1_lord", "@President Armand Fallires"),
	(troop_set_name, "trp_kingdom_2_lord", "@Tsar Nicholas II"),
	(troop_set_name, "trp_kingdom_3_lord", "@Kaiser Franz Joseph I"),
	(troop_set_name, "trp_kingdom_4_lord", "@King Victor Emmanuel III"),
	(troop_set_name, "trp_kingdom_5_lord", "@Kaiser Wilhelm II"),
	(troop_set_name, "trp_kingdom_6_lord", "@Sultan Abdulhamid II"),
	(troop_set_name, "trp_kingdom_7_lord", "@King Edward VII"),
	(troop_set_type, "trp_kingdom_7_lord", 0),
	(troop_set_name, "trp_kingdom_8_lord", "@Queen Wilhelmina"),
	(troop_set_type, "trp_kingdom_8_lord", 1),
	(else_try),
	(ge, "$g_current_year", 1891),
	(troop_set_name, "trp_kingdom_1_lord", "@President Sadi Carnot"),
	(troop_set_name, "trp_kingdom_2_lord", "@Tsar Alexander III"),
	(troop_set_name, "trp_kingdom_3_lord", "@Kaiser Franz Joseph I"),
	(troop_set_name, "trp_kingdom_4_lord", "@King Umberto I"),
	(troop_set_name, "trp_kingdom_5_lord", "@Kaiser Wilhelm II"),
	(troop_set_name, "trp_kingdom_6_lord", "@Sultan Abdulhamid II"),
	(troop_set_name, "trp_kingdom_7_lord", "@Queen Victoria"),
	(troop_set_name, "trp_kingdom_8_lord", "@Queen Wilhelmina"),
	(troop_set_type, "trp_kingdom_8_lord", 1),
	(else_try),
	(ge, "$g_current_year", 1878),
	(troop_set_name, "trp_kingdom_1_lord", "@President Patrice de MacMahon"),
	(troop_set_name, "trp_kingdom_2_lord", "@Tsar Alexander III"),
	(troop_set_name, "trp_kingdom_3_lord", "@Kaiser Franz Joseph I"),
	(troop_set_name, "trp_kingdom_4_lord", "@King Umberto I"),
	(troop_set_name, "trp_kingdom_5_lord", "@Kaiser Wilhelm I"),
	(troop_set_name, "trp_kingdom_6_lord", "@Sultan Abdulhamid II"),
	(troop_set_name, "trp_kingdom_7_lord", "@Queen Victoria"),
	(troop_set_name, "trp_kingdom_8_lord", "@King Wilhelm III"),
	(try_end),

(gt, "$pas_enlistment_lord", 0),
(key_clicked, key_left_mouse_button),
(set_fixed_point_multiplier, 1000),
(mouse_get_position, pos1),
(position_get_y, ":mouse_y", pos1),
(gt, ":mouse_y", 50),
(jump_to_menu, "mnu_pas_enlistment_menu"),
]),

(0.1,
[
(gt, "$players_kingdom", "fac_player_supporters_faction"),
(val_add, "$pas_enlistment_points", 1),
(call_script, "script_pas_enlistment_get_promotion"),
	(try_begin),
	(eq, "$pas_enlistment_rank", 9),
	(faction_set_slot, slot_faction_marshall, "trp_player"),
	(try_end),
]),
	
]


# modmerger_start version=201 type=2
try:
    component_name = "simple_triggers"
    var_set = { "simple_triggers" : simple_triggers }
    from modmerger import modmerge
    modmerge(var_set)
except:
    raise
# modmerger_end
